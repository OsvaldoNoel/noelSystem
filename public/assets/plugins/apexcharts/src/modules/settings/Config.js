import Defaults from"./Defaults";import Utils from"./../../utils/Utils";import Options from"./Options";export default class Config{constructor(t){this.opts=t}init({responsiveOverride:t}){let e=this.opts,a=new Options,i=new Defaults(e);this.chartType=e.chart.type,e=this.extendYAxis(e),e=this.extendAnnotations(e);let n=a.init(),s={};if(e&&"object"==typeof e){let a={};a=-1!==["line","area","bar","candlestick","boxPlot","rangeBar","rangeArea","bubble","scatter","heatmap","treemap","pie","polarArea","donut","radar","radialBar"].indexOf(e.chart.type)?i[e.chart.type]():i.line(),e.plotOptions?.bar?.isFunnel&&(a=i.funnel()),e.chart.stacked&&"bar"===e.chart.type&&(a=i.stackedBars()),e.chart.brush?.enabled&&(a=i.brush(a)),e.plotOptions?.line?.isSlopeChart&&(a=i.slope()),e.chart.stacked&&"100%"===e.chart.stackType&&(e=i.stacked100(e)),e.plotOptions?.bar?.isDumbbell&&(e=i.dumbbell(e)),this.checkForDarkTheme(window.Apex),this.checkForDarkTheme(e),e.xaxis=e.xaxis||window.Apex.xaxis||{},t||(e.xaxis.convertedCatToNumeric=!1),e=this.checkForCatToNumericXAxis(this.chartType,a,e),(e.chart.sparkline?.enabled||window.Apex.chart?.sparkline?.enabled)&&(a=i.sparkline(a)),s=Utils.extend(n,a)}let o=Utils.extend(s,window.Apex);return n=Utils.extend(o,e),n=this.handleUserInputErrors(n),n}checkForCatToNumericXAxis(t,e,a){let i=new Defaults(a);const n=("bar"===t||"boxPlot"===t)&&a.plotOptions?.bar?.horizontal,s="pie"===t||"polarArea"===t||"donut"===t||"radar"===t||"radialBar"===t||"heatmap"===t,o="datetime"!==a.xaxis.type&&"numeric"!==a.xaxis.type;let r=a.xaxis.tickPlacement?a.xaxis.tickPlacement:e.xaxis&&e.xaxis.tickPlacement;return n||s||!o||"between"===r||(a=i.convertCatToNumeric(a)),a}extendYAxis(t,e){let a=new Options;(void 0===t.yaxis||!t.yaxis||Array.isArray(t.yaxis)&&0===t.yaxis.length)&&(t.yaxis={}),t.yaxis.constructor!==Array&&window.Apex.yaxis&&window.Apex.yaxis.constructor!==Array&&(t.yaxis=Utils.extend(t.yaxis,window.Apex.yaxis)),t.yaxis.constructor!==Array?t.yaxis=[Utils.extend(a.yAxis,t.yaxis)]:t.yaxis=Utils.extendArray(t.yaxis,a.yAxis);let i=!1;t.yaxis.forEach((t=>{t.logarithmic&&(i=!0)}));let n=t.series;return e&&!n&&(n=e.config.series),i&&n.length!==t.yaxis.length&&n.length&&(t.yaxis=n.map(((e,i)=>{if(e.name||(n[i].name=`series-${i+1}`),t.yaxis[i])return t.yaxis[i].seriesName=n[i].name,t.yaxis[i];{const e=Utils.extend(a.yAxis,t.yaxis[0]);return e.show=!1,e}}))),i&&n.length>1&&n.length!==t.yaxis.length&&console.warn("A multi-series logarithmic chart should have equal number of series and y-axes"),t}extendAnnotations(t){return void 0===t.annotations&&(t.annotations={},t.annotations.yaxis=[],t.annotations.xaxis=[],t.annotations.points=[]),t=this.extendYAxisAnnotations(t),t=this.extendXAxisAnnotations(t),t=this.extendPointAnnotations(t)}extendYAxisAnnotations(t){let e=new Options;return t.annotations.yaxis=Utils.extendArray(void 0!==t.annotations.yaxis?t.annotations.yaxis:[],e.yAxisAnnotation),t}extendXAxisAnnotations(t){let e=new Options;return t.annotations.xaxis=Utils.extendArray(void 0!==t.annotations.xaxis?t.annotations.xaxis:[],e.xAxisAnnotation),t}extendPointAnnotations(t){let e=new Options;return t.annotations.points=Utils.extendArray(void 0!==t.annotations.points?t.annotations.points:[],e.pointAnnotation),t}checkForDarkTheme(t){t.theme&&"dark"===t.theme.mode&&(t.tooltip||(t.tooltip={}),"light"!==t.tooltip.theme&&(t.tooltip.theme="dark"),t.chart.foreColor||(t.chart.foreColor="#f6f7f8"),t.chart.background||(t.chart.background="#424242"),t.theme.palette||(t.theme.palette="palette4"))}handleUserInputErrors(t){let e=t;if(e.tooltip.shared&&e.tooltip.intersect)throw new Error("tooltip.shared cannot be enabled when tooltip.intersect is true. Turn off any other option by setting it to false.");if("bar"===e.chart.type&&e.plotOptions.bar.horizontal){if(e.yaxis.length>1)throw new Error("Multiple Y Axis for bars are not supported. Switch to column chart by setting plotOptions.bar.horizontal=false");e.yaxis[0].reversed&&(e.yaxis[0].opposite=!0),e.xaxis.tooltip.enabled=!1,e.yaxis[0].tooltip.enabled=!1,e.chart.zoom.enabled=!1}return"bar"!==e.chart.type&&"rangeBar"!==e.chart.type||e.tooltip.shared&&"barWidth"===e.xaxis.crosshairs.width&&e.series.length>1&&(e.xaxis.crosshairs.width="tickWidth"),"candlestick"!==e.chart.type&&"boxPlot"!==e.chart.type||e.yaxis[0].reversed&&(console.warn(`Reversed y-axis in ${e.chart.type} chart is not supported.`),e.yaxis[0].reversed=!1),e}}