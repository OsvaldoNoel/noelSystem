import Graphics from"../Graphics";import Utils from"../../utils/Utils";import AxesUtils from"./AxesUtils";export default class YAxis{constructor(t,s){this.ctx=t,this.elgrid=s,this.w=t.w;const i=this.w;this.xaxisFontSize=i.config.xaxis.labels.style.fontSize,this.axisFontFamily=i.config.xaxis.labels.style.fontFamily,this.xaxisForeColors=i.config.xaxis.labels.style.colors,this.isCategoryBarHorizontal="bar"===i.config.chart.type&&i.config.plotOptions.bar.horizontal,this.xAxisoffX=0,"bottom"===i.config.xaxis.position&&(this.xAxisoffX=i.globals.gridHeight),this.drawnLabels=[],this.axesUtils=new AxesUtils(t)}drawYaxis(t){let s=this.w,i=new Graphics(this.ctx);const e=s.config.yaxis[t].labels.style;let l=e.fontSize,a=e.fontFamily,o=e.fontWeight,r=i.group({class:"apexcharts-yaxis",rel:t,transform:"translate("+s.globals.translateYAxisX[t]+", 0)"});if(this.axesUtils.isYAxisHidden(t))return r;let x=i.group({class:"apexcharts-yaxis-texts-g"});r.add(x);let n=s.globals.yAxisScale[t].result.length-1,g=s.globals.gridHeight/n,c=s.globals.yLabelFormatters[t],f=s.globals.yAxisScale[t].result.slice();f=this.axesUtils.checkForReversedLabels(t,f);let h="";if(s.config.yaxis[t].labels.show){let r=s.globals.translateY+s.config.yaxis[t].labels.offsetY;s.globals.isBarHorizontal?r=0:"heatmap"===s.config.chart.type&&(r-=g/2),r+=parseInt(s.config.yaxis[t].labels.style.fontSize,10)/3;for(let d=n;d>=0;d--){let y=f[d];y=c(y,d,s);let b=s.config.yaxis[t].labels.padding;s.config.yaxis[t].opposite&&0!==s.config.yaxis.length&&(b*=-1);let p="end";s.config.yaxis[t].opposite&&(p="start"),"left"===s.config.yaxis[t].labels.align?p="start":"center"===s.config.yaxis[t].labels.align?p="middle":"right"===s.config.yaxis[t].labels.align&&(p="end");const A=this.axesUtils.getYAxisForeColor(e.colors,t),m=()=>Array.isArray(A)?A[d]:A;let w=i.drawText({x:b,y:r,text:y,textAnchor:p,fontSize:l,fontFamily:a,fontWeight:o,maxWidth:s.config.yaxis[t].labels.maxWidth,foreColor:m(),isPlainText:!1,cssClass:"apexcharts-yaxis-label "+e.cssClass});d===n&&(h=w),x.add(w);let u=document.createElementNS(s.globals.SVGNS,"title");if(u.textContent=Array.isArray(y)?y.join(" "):y,w.node.appendChild(u),0!==s.config.yaxis[t].labels.rotate){let e=i.rotateAroundCenter(h.node),l=i.rotateAroundCenter(w.node);w.node.setAttribute("transform",`rotate(${s.config.yaxis[t].labels.rotate} ${e.x} ${l.y})`)}r+=g}}if(void 0!==s.config.yaxis[t].title.text){let e=i.group({class:"apexcharts-yaxis-title"}),l=0;s.config.yaxis[t].opposite&&(l=s.globals.translateYAxisX[t]);let a=i.drawText({x:l,y:s.globals.gridHeight/2+s.globals.translateY+s.config.yaxis[t].title.offsetY,text:s.config.yaxis[t].title.text,textAnchor:"end",foreColor:s.config.yaxis[t].title.style.color,fontSize:s.config.yaxis[t].title.style.fontSize,fontWeight:s.config.yaxis[t].title.style.fontWeight,fontFamily:s.config.yaxis[t].title.style.fontFamily,cssClass:"apexcharts-yaxis-title-text "+s.config.yaxis[t].title.style.cssClass});e.add(a),r.add(e)}let d=s.config.yaxis[t].axisBorder,y=31+d.offsetX;if(s.config.yaxis[t].opposite&&(y=-31-d.offsetX),d.show){let t=i.drawLine(y,s.globals.translateY+d.offsetY-2,y,s.globals.gridHeight+s.globals.translateY+d.offsetY+2,d.color,0,d.width);r.add(t)}return s.config.yaxis[t].axisTicks.show&&this.axesUtils.drawYAxisTicks(y,n,d,s.config.yaxis[t].axisTicks,t,g,r),r}drawYaxisInversed(t){let s=this.w,i=new Graphics(this.ctx),e=i.group({class:"apexcharts-xaxis apexcharts-yaxis-inversed"}),l=i.group({class:"apexcharts-xaxis-texts-g",transform:`translate(${s.globals.translateXAxisX}, ${s.globals.translateXAxisY})`});e.add(l);let a=s.globals.yAxisScale[t].result.length-1,o=s.globals.gridWidth/a+.1,r=o+s.config.xaxis.labels.offsetX,x=s.globals.xLabelFormatter,n=s.globals.yAxisScale[t].result.slice(),g=s.globals.timescaleLabels;g.length>0&&(this.xaxisLabels=g.slice(),n=g.slice(),a=n.length),n=this.axesUtils.checkForReversedLabels(t,n);const c=g.length;if(s.config.xaxis.labels.show)for(let e=c?0:a;c?e<c:e>=0;c?e++:e--){let a=n[e];a=x(a,e,s);let c=s.globals.gridWidth+s.globals.padHorizontal-(r-o+s.config.xaxis.labels.offsetX);if(g.length){let t=this.axesUtils.getLabel(n,g,c,e,this.drawnLabels,this.xaxisFontSize);c=t.x,a=t.text,this.drawnLabels.push(t.text),0===e&&s.globals.skipFirstTimelinelabel&&(a=""),e===n.length-1&&s.globals.skipLastTimelinelabel&&(a="")}let f=i.drawText({x:c,y:this.xAxisoffX+s.config.xaxis.labels.offsetY+30-("top"===s.config.xaxis.position?s.globals.xAxisHeight+s.config.xaxis.axisTicks.height-2:0),text:a,textAnchor:"middle",foreColor:Array.isArray(this.xaxisForeColors)?this.xaxisForeColors[t]:this.xaxisForeColors,fontSize:this.xaxisFontSize,fontFamily:this.xaxisFontFamily,fontWeight:s.config.xaxis.labels.style.fontWeight,isPlainText:!1,cssClass:"apexcharts-xaxis-label "+s.config.xaxis.labels.style.cssClass});l.add(f),f.tspan(a);let h=document.createElementNS(s.globals.SVGNS,"title");h.textContent=a,f.node.appendChild(h),r+=o}return this.inversedYAxisTitleText(e),this.inversedYAxisBorder(e),e}inversedYAxisBorder(t){const s=this.w,i=new Graphics(this.ctx);let e=s.config.xaxis.axisBorder;if(e.show){let l=0;"bar"===s.config.chart.type&&s.globals.isXNumeric&&(l-=15);let a=i.drawLine(s.globals.padHorizontal+l+e.offsetX,this.xAxisoffX,s.globals.gridWidth,this.xAxisoffX,e.color,0,e.height);this.elgrid&&this.elgrid.elGridBorders&&s.config.grid.show?this.elgrid.elGridBorders.add(a):t.add(a)}}inversedYAxisTitleText(t){const s=this.w,i=new Graphics(this.ctx);if(void 0!==s.config.xaxis.title.text){let e=i.group({class:"apexcharts-xaxis-title apexcharts-yaxis-title-inversed"}),l=i.drawText({x:s.globals.gridWidth/2+s.config.xaxis.title.offsetX,y:this.xAxisoffX+parseFloat(this.xaxisFontSize)+parseFloat(s.config.xaxis.title.style.fontSize)+s.config.xaxis.title.offsetY+20,text:s.config.xaxis.title.text,textAnchor:"middle",fontSize:s.config.xaxis.title.style.fontSize,fontFamily:s.config.xaxis.title.style.fontFamily,fontWeight:s.config.xaxis.title.style.fontWeight,foreColor:s.config.xaxis.title.style.color,cssClass:"apexcharts-xaxis-title-text "+s.config.xaxis.title.style.cssClass});e.add(l),t.add(e)}}yAxisTitleRotate(t,s){let i=this.w,e=new Graphics(this.ctx),l={width:0,height:0},a={width:0,height:0},o=i.globals.dom.baseEl.querySelector(` .apexcharts-yaxis[rel='${t}'] .apexcharts-yaxis-texts-g`);null!==o&&(l=o.getBoundingClientRect());let r=i.globals.dom.baseEl.querySelector(`.apexcharts-yaxis[rel='${t}'] .apexcharts-yaxis-title text`);if(null!==r&&(a=r.getBoundingClientRect()),null!==r){let i=this.xPaddingForYAxisTitle(t,l,a,s);r.setAttribute("x",i.xPos-(s?10:0))}if(null!==r){let l=e.rotateAroundCenter(r);r.setAttribute("transform",`rotate(${s?-1*i.config.yaxis[t].title.rotate:i.config.yaxis[t].title.rotate} ${l.x} ${l.y})`)}}xPaddingForYAxisTitle(t,s,i,e){let l=this.w,a=0,o=0,r=10;return void 0===l.config.yaxis[t].title.text||t<0?{xPos:o,padd:0}:(e?(o=s.width+l.config.yaxis[t].title.offsetX+i.width/2+r/2,a+=1,0===a&&(o-=r/2)):(o=-1*s.width+l.config.yaxis[t].title.offsetX+r/2+i.width/2,l.globals.isBarHorizontal&&(r=25,o=-1*s.width-l.config.yaxis[t].title.offsetX-r)),{xPos:o,padd:r})}setYAxisXPosition(t,s){let i=this.w,e=0,l=0,a=18,o=1;i.config.yaxis.length>1&&(this.multipleYs=!0),i.config.yaxis.map(((r,x)=>{let n=i.globals.ignoreYAxisIndexes.indexOf(x)>-1||!r.show||r.floating||0===t[x].width,g=t[x].width+s[x].width;r.opposite?i.globals.isBarHorizontal?(l=i.globals.gridWidth+i.globals.translateX-1,i.globals.translateYAxisX[x]=l-r.labels.offsetX):(l=i.globals.gridWidth+i.globals.translateX+o,n||(o=o+g+20),i.globals.translateYAxisX[x]=l-r.labels.offsetX+20):(e=i.globals.translateX-a,n||(a=a+g+20),i.globals.translateYAxisX[x]=e+r.labels.offsetX)}))}setYAxisTextAlignments(){const t=this.w;let s=t.globals.dom.baseEl.getElementsByClassName("apexcharts-yaxis");s=Utils.listToArray(s),s.forEach(((s,i)=>{const e=t.config.yaxis[i];if(e&&!e.floating&&void 0!==e.labels.align){const s=t.globals.dom.baseEl.querySelector(`.apexcharts-yaxis[rel='${i}'] .apexcharts-yaxis-texts-g`);let l=t.globals.dom.baseEl.querySelectorAll(`.apexcharts-yaxis[rel='${i}'] .apexcharts-yaxis-label`);l=Utils.listToArray(l);const a=s.getBoundingClientRect();"left"===e.labels.align?(l.forEach(((t,s)=>{t.setAttribute("text-anchor","start")})),e.opposite||s.setAttribute("transform",`translate(-${a.width}, 0)`)):"center"===e.labels.align?(l.forEach(((t,s)=>{t.setAttribute("text-anchor","middle")})),s.setAttribute("transform",`translate(${a.width/2*(e.opposite?1:-1)}, 0)`)):"right"===e.labels.align&&(l.forEach(((t,s)=>{t.setAttribute("text-anchor","end")})),e.opposite&&s.setAttribute("transform",`translate(${a.width}, 0)`))}}))}}