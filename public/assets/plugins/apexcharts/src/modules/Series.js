import Graphics from"./Graphics";import Utils from"../utils/Utils";export default class Series{constructor(e){this.ctx=e,this.w=e.w,this.legendInactiveClass="legend-mouseover-inactive"}getAllSeriesEls(){return this.w.globals.dom.baseEl.getElementsByClassName("apexcharts-series")}getSeriesByName(e){return this.w.globals.dom.baseEl.querySelector(`.apexcharts-inner .apexcharts-series[seriesName='${Utils.escapeString(e)}']`)}isSeriesHidden(e){const s=this.getSeriesByName(e);let t=parseInt(s.getAttribute("data:realIndex"),10);return{isHidden:s.classList.contains("apexcharts-series-collapsed"),realIndex:t}}addCollapsedClassToSeries(e,s){const t=this.w;function l(t){for(let l=0;l<t.length;l++)t[l].index===s&&e.node.classList.add("apexcharts-series-collapsed")}l(t.globals.collapsedSeries),l(t.globals.ancillaryCollapsedSeries)}toggleSeries(e){let s=this.isSeriesHidden(e);return this.ctx.legend.legendHelpers.toggleDataSeries(s.realIndex,s.isHidden),s.isHidden}showSeries(e){let s=this.isSeriesHidden(e);s.isHidden&&this.ctx.legend.legendHelpers.toggleDataSeries(s.realIndex,!0)}hideSeries(e){let s=this.isSeriesHidden(e);s.isHidden||this.ctx.legend.legendHelpers.toggleDataSeries(s.realIndex,!1)}resetSeries(e=!0,s=!0,t=!0){const l=this.w;let a=Utils.clone(l.globals.initialSeries);l.globals.previousPaths=[],t?(l.globals.collapsedSeries=[],l.globals.ancillaryCollapsedSeries=[],l.globals.collapsedSeriesIndices=[],l.globals.ancillaryCollapsedSeriesIndices=[]):a=this.emptyCollapsedSeries(a),l.config.series=a,e&&(s&&(l.globals.zoomed=!1,this.ctx.updateHelpers.revertDefaultAxisMinMax()),this.ctx.updateHelpers._updateSeries(a,l.config.chart.animations.dynamicAnimation.enabled))}emptyCollapsedSeries(e){const s=this.w;for(let t=0;t<e.length;t++)s.globals.collapsedSeriesIndices.indexOf(t)>-1&&(e[t].data=[]);return e}toggleSeriesOnHover(e,s){const t=this.w;s||(s=e.target);let l=t.globals.dom.baseEl.querySelectorAll(".apexcharts-series, .apexcharts-datalabels, .apexcharts-yaxis");if("mousemove"===e.type){let e=parseInt(s.getAttribute("rel"),10)-1,a=null,r=null,i=null;if(t.globals.axisCharts||"radialBar"===t.config.chart.type)if(t.globals.axisCharts){a=t.globals.dom.baseEl.querySelector(`.apexcharts-series[data\\:realIndex='${e}']`),r=t.globals.dom.baseEl.querySelector(`.apexcharts-datalabels[data\\:realIndex='${e}']`);let s=t.globals.seriesYAxisReverseMap[e];i=t.globals.dom.baseEl.querySelector(`.apexcharts-yaxis[rel='${s}']`)}else a=t.globals.dom.baseEl.querySelector(`.apexcharts-series[rel='${e+1}']`);else a=t.globals.dom.baseEl.querySelector(`.apexcharts-series[rel='${e+1}'] path`);for(let e=0;e<l.length;e++)l[e].classList.add(this.legendInactiveClass);null!==a&&(t.globals.axisCharts||a.parentNode.classList.remove(this.legendInactiveClass),a.classList.remove(this.legendInactiveClass),null!==r&&r.classList.remove(this.legendInactiveClass),null!==i&&i.classList.remove(this.legendInactiveClass))}else if("mouseout"===e.type)for(let e=0;e<l.length;e++)l[e].classList.remove(this.legendInactiveClass)}highlightRangeInSeries(e,s){const t=this.w,l=t.globals.dom.baseEl.getElementsByClassName("apexcharts-heatmap-rect"),a=e=>{for(let s=0;s<l.length;s++)l[s].classList[e](this.legendInactiveClass)},r=e=>{for(let s=0;s<l.length;s++){const t=parseInt(l[s].getAttribute("val"),10);t>=e.from&&t<=e.to&&l[s].classList.remove(this.legendInactiveClass)}};if("mousemove"===e.type){let e=parseInt(s.getAttribute("rel"),10)-1;a("add");r(t.config.plotOptions.heatmap.colorScale.ranges[e])}else"mouseout"===e.type&&a("remove")}getActiveConfigSeriesIndex(e="asc",s=[]){const t=this.w;let l=0;if(t.config.series.length>1){let a=t.config.series.map(((e,l)=>e.data&&e.data.length>0&&-1===t.globals.collapsedSeriesIndices.indexOf(l)&&(!t.globals.comboCharts||0===s.length||s.length&&s.indexOf(t.config.series[l].type)>-1)?l:-1));for(let s="asc"===e?0:a.length-1;"asc"===e?s<a.length:s>=0;"asc"===e?s++:s--)if(-1!==a[s]){l=a[s];break}}return l}getBarSeriesIndices(){return this.w.globals.comboCharts?this.w.config.series.map(((e,s)=>"bar"===e.type||"column"===e.type?s:-1)).filter((e=>-1!==e)):this.w.config.series.map(((e,s)=>s))}getPreviousPaths(){let e=this.w;function s(s,t,l){let a=s[t].childNodes,r={type:l,paths:[],realIndex:s[t].getAttribute("data:realIndex")};for(let e=0;e<a.length;e++)if(a[e].hasAttribute("pathTo")){let s=a[e].getAttribute("pathTo");r.paths.push({d:s})}e.globals.previousPaths.push(r)}e.globals.previousPaths=[];["line","area","bar","rangebar","rangeArea","candlestick","radar"].forEach((t=>{const l=(a=t,e.globals.dom.baseEl.querySelectorAll(`.apexcharts-${a}-series .apexcharts-series`));var a;for(let e=0;e<l.length;e++)s(l,e,t)})),this.handlePrevBubbleScatterPaths("bubble"),this.handlePrevBubbleScatterPaths("scatter");let t=e.globals.dom.baseEl.querySelectorAll(`.apexcharts-${e.config.chart.type} .apexcharts-series`);if(t.length>0)for(let s=0;s<t.length;s++){let t=e.globals.dom.baseEl.querySelectorAll(`.apexcharts-${e.config.chart.type} .apexcharts-series[data\\:realIndex='${s}'] rect`),l=[];for(let e=0;e<t.length;e++){const s=s=>t[e].getAttribute(s),a={x:parseFloat(s("x")),y:parseFloat(s("y")),width:parseFloat(s("width")),height:parseFloat(s("height"))};l.push({rect:a,color:t[e].getAttribute("color")})}e.globals.previousPaths.push(l)}e.globals.axisCharts||(e.globals.previousPaths=e.globals.series)}handlePrevBubbleScatterPaths(e){const s=this.w;let t=s.globals.dom.baseEl.querySelectorAll(`.apexcharts-${e}-series .apexcharts-series`);if(t.length>0)for(let l=0;l<t.length;l++){let t=s.globals.dom.baseEl.querySelectorAll(`.apexcharts-${e}-series .apexcharts-series[data\\:realIndex='${l}'] circle`),a=[];for(let e=0;e<t.length;e++)a.push({x:t[e].getAttribute("cx"),y:t[e].getAttribute("cy"),r:t[e].getAttribute("r")});s.globals.previousPaths.push(a)}}clearPreviousPaths(){const e=this.w;e.globals.previousPaths=[],e.globals.allSeriesCollapsed=!1}handleNoData(){const e=this.w,s=e.config.noData,t=new Graphics(this.ctx);let l=e.globals.svgWidth/2,a=e.globals.svgHeight/2,r="middle";if(e.globals.noData=!0,e.globals.animationEnded=!0,"left"===s.align?(l=10,r="start"):"right"===s.align&&(l=e.globals.svgWidth-10,r="end"),"top"===s.verticalAlign?a=50:"bottom"===s.verticalAlign&&(a=e.globals.svgHeight-50),l+=s.offsetX,a=a+parseInt(s.style.fontSize,10)+2+s.offsetY,void 0!==s.text&&""!==s.text){let i=t.drawText({x:l,y:a,text:s.text,textAnchor:r,fontSize:s.style.fontSize,fontFamily:s.style.fontFamily,foreColor:s.style.color,opacity:1,class:"apexcharts-text-nodata"});e.globals.dom.Paper.add(i)}}setNullSeriesToZeroValues(e){let s=this.w;for(let t=0;t<e.length;t++)if(0===e[t].length)for(let l=0;l<e[s.globals.maxValsInArrayIndex].length;l++)e[t].push(0);return e}hasAllSeriesEqualX(){let e=!0;const s=this.w,t=this.filteredSeriesX();for(let s=0;s<t.length-1;s++)if(t[s][0]!==t[s+1][0]){e=!1;break}return s.globals.allSeriesHasEqualX=e,e}filteredSeriesX(){return this.w.globals.seriesX.map((e=>e.length>0?e:[]))}}