import Animations from"../modules/Animations";import Fill from"../modules/Fill";import Filters from"../modules/Filters";import Graphics from"../modules/Graphics";import Markers from"../modules/Markers";export default class Scatter{constructor(i){this.ctx=i,this.w=i.w,this.initialAnim=this.w.config.chart.animations.enabled,this.dynamicAnim=this.initialAnim&&this.w.config.chart.animations.dynamicAnimation.enabled}draw(i,t,e){let a=this.w,s=new Graphics(this.ctx),r=e.realIndex,o=e.pointsPos,l=e.zRatio,n=e.elParent,c=s.group({class:`apexcharts-series-markers apexcharts-series-${a.config.chart.type}`});if(c.attr("clip-path",`url(#gridRectMarkerMask${a.globals.cuid})`),Array.isArray(o.x))for(let i=0;i<o.x.length;i++){let e=t+1,s=!0;0===t&&0===i&&(e=0),0===t&&1===i&&(e=1);let d=0,h=a.globals.markers.size[r];if(l!==1/0){const i=a.config.plotOptions.bubble;h=a.globals.seriesZ[r][e],i.zScaling&&(h/=l),i.minBubbleRadius&&h<i.minBubbleRadius&&(h=i.minBubbleRadius),i.maxBubbleRadius&&h>i.maxBubbleRadius&&(h=i.maxBubbleRadius)}a.config.chart.animations.enabled||(d=h);let p=o.x[i],m=o.y[i];if(d=d||0,null!==m&&void 0!==a.globals.series[r][e]||(s=!1),s){const i=this.drawPoint(p,m,d,h,r,e,t);c.add(i)}n.add(c)}}drawPoint(i,t,e,a,s,r,o){const l=this.w;let n=s,c=new Animations(this.ctx),d=new Filters(this.ctx),h=new Fill(this.ctx),p=new Markers(this.ctx);const m=new Graphics(this.ctx),g=p.getMarkerConfig({cssClass:"apexcharts-marker",seriesIndex:n,dataPointIndex:r,finishRadius:"bubble"===l.config.chart.type||l.globals.comboCharts&&l.config.series[s]&&"bubble"===l.config.series[s].type?a:null});a=g.pSize;let b,u=h.fillPath({seriesNumber:s,dataPointIndex:r,color:g.pointFillColor,patternUnits:"objectBoundingBox",value:l.globals.series[s][o]});if("circle"===g.shape?b=m.drawCircle(e):"square"!==g.shape&&"rect"!==g.shape||(b=m.drawRect(0,0,g.width-g.pointStrokeWidth/2,g.height-g.pointStrokeWidth/2,g.pRadius)),l.config.series[n].data[r]&&l.config.series[n].data[r].fillColor&&(u=l.config.series[n].data[r].fillColor),b.attr({x:i-g.width/2-g.pointStrokeWidth/2,y:t-g.height/2-g.pointStrokeWidth/2,cx:i,cy:t,fill:u,"fill-opacity":g.pointFillOpacity,stroke:g.pointStrokeColor,r:a,"stroke-width":g.pointStrokeWidth,"stroke-dasharray":g.pointStrokeDashArray,"stroke-opacity":g.pointStrokeOpacity}),l.config.chart.dropShadow.enabled){const i=l.config.chart.dropShadow;d.dropShadow(b,i,s)}if(!this.initialAnim||l.globals.dataChanged||l.globals.resized)l.globals.animationEnded=!0;else{let i=l.config.chart.animations.speed;c.animateMarker(b,0,"circle"===g.shape?a:{width:g.width,height:g.height},i,l.globals.easing,(()=>{window.setTimeout((()=>{c.animationCompleted(b)}),100)}))}if(l.globals.dataChanged&&"circle"===g.shape)if(this.dynamicAnim){let e,r,n,d=l.config.chart.animations.dynamicAnimation.speed,h=null;h=l.globals.previousPaths[s]&&l.globals.previousPaths[s][o],null!=h&&(e=h.x,r=h.y,n=void 0!==h.r?h.r:a);for(let i=0;i<l.globals.collapsedSeries.length;i++)l.globals.collapsedSeries[i].index===s&&(d=1,a=0);0===i&&0===t&&(a=0),c.animateCircle(b,{cx:e,cy:r,r:n},{cx:i,cy:t,r:a},d,l.globals.easing)}else b.attr({r:a});return b.attr({rel:r,j:r,index:s,"default-marker-size":a}),d.setSelectionFilter(b,s,r),p.addEvents(b),b.node.classList.add("apexcharts-marker"),b}centerTextInBubble(i){let t=this.w;return{y:i+=parseInt(t.config.dataLabels.style.fontSize,10)/4}}}