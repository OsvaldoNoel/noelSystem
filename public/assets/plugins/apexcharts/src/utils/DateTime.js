import Utils from"./Utils";class DateTime{constructor(e){this.ctx=e,this.w=e.w,this.months31=[1,3,5,7,8,10,12],this.months30=[2,4,6,9,11],this.daysCntOfYear=[0,31,59,90,120,151,181,212,243,273,304,334]}isValidDate(e){return"number"!=typeof e&&!isNaN(this.parseDate(e))}getTimeStamp(e){if(!Date.parse(e))return e;return this.w.config.xaxis.labels.datetimeUTC?new Date(new Date(e).toISOString().substr(0,25)).getTime():new Date(e).getTime()}getDate(e){return this.w.config.xaxis.labels.datetimeUTC?new Date(new Date(e).toUTCString()):new Date(e)}parseDate(e){const t=Date.parse(e);if(!isNaN(t))return this.getTimeStamp(e);let a=Date.parse(e.replace(/-/g,"/").replace(/[a-z]+/gi," "));return a=this.getTimeStamp(a),a}parseDateWithTimezone(e){return Date.parse(e.replace(/-/g,"/").replace(/[a-z]+/gi," "))}formatDate(e,t){const a=this.w.globals.locale,r=this.w.config.xaxis.labels.datetimeUTC;let s=["\0",...a.months],i=["",...a.shortMonths],n=["",...a.days],l=["",...a.shortDays];function g(e,t){let a=e+"";for(t=t||2;a.length<t;)a="0"+a;return a}let p=r?e.getUTCFullYear():e.getFullYear();t=(t=(t=t.replace(/(^|[^\\])yyyy+/g,"$1"+p)).replace(/(^|[^\\])yy/g,"$1"+p.toString().substr(2,2))).replace(/(^|[^\\])y/g,"$1"+p);let c=(r?e.getUTCMonth():e.getMonth())+1;t=(t=(t=(t=t.replace(/(^|[^\\])MMMM+/g,"$1"+s[0])).replace(/(^|[^\\])MMM/g,"$1"+i[0])).replace(/(^|[^\\])MM/g,"$1"+g(c))).replace(/(^|[^\\])M/g,"$1"+c);let o=r?e.getUTCDate():e.getDate();t=(t=(t=(t=t.replace(/(^|[^\\])dddd+/g,"$1"+n[0])).replace(/(^|[^\\])ddd/g,"$1"+l[0])).replace(/(^|[^\\])dd/g,"$1"+g(o))).replace(/(^|[^\\])d/g,"$1"+o);let m=r?e.getUTCHours():e.getHours(),h=m>12?m-12:0===m?12:m;t=(t=(t=(t=t.replace(/(^|[^\\])HH+/g,"$1"+g(m))).replace(/(^|[^\\])H/g,"$1"+m)).replace(/(^|[^\\])hh+/g,"$1"+g(h))).replace(/(^|[^\\])h/g,"$1"+h);let f=r?e.getUTCMinutes():e.getMinutes();t=(t=t.replace(/(^|[^\\])mm+/g,"$1"+g(f))).replace(/(^|[^\\])m/g,"$1"+f);let d=r?e.getUTCSeconds():e.getSeconds();t=(t=t.replace(/(^|[^\\])ss+/g,"$1"+g(d))).replace(/(^|[^\\])s/g,"$1"+d);let M=r?e.getUTCMilliseconds():e.getMilliseconds();t=t.replace(/(^|[^\\])fff+/g,"$1"+g(M,3)),M=Math.round(M/10),t=t.replace(/(^|[^\\])ff/g,"$1"+g(M)),M=Math.round(M/10);let u=m<12?"AM":"PM";t=(t=(t=t.replace(/(^|[^\\])f/g,"$1"+M)).replace(/(^|[^\\])TT+/g,"$1"+u)).replace(/(^|[^\\])T/g,"$1"+u.charAt(0));let D=u.toLowerCase();t=(t=t.replace(/(^|[^\\])tt+/g,"$1"+D)).replace(/(^|[^\\])t/g,"$1"+D.charAt(0));let x=-e.getTimezoneOffset(),$=r||!x?"Z":x>0?"+":"-";if(!r){x=Math.abs(x);let e=x%60;$+=g(Math.floor(x/60))+":"+g(e)}t=t.replace(/(^|[^\\])K/g,"$1"+$);let y=(r?e.getUTCDay():e.getDay())+1;return t=(t=(t=(t=(t=t.replace(new RegExp(n[0],"g"),n[y])).replace(new RegExp(l[0],"g"),l[y])).replace(new RegExp(s[0],"g"),s[c])).replace(new RegExp(i[0],"g"),i[c])).replace(/\\(.)/g,"$1")}getTimeUnitsfromTimestamp(e,t,a){let r=this.w;void 0!==r.config.xaxis.min&&(e=r.config.xaxis.min),void 0!==r.config.xaxis.max&&(t=r.config.xaxis.max);const s=this.getDate(e),i=this.getDate(t),n=this.formatDate(s,"yyyy MM dd HH mm ss fff").split(" "),l=this.formatDate(i,"yyyy MM dd HH mm ss fff").split(" ");return{minMillisecond:parseInt(n[6],10),maxMillisecond:parseInt(l[6],10),minSecond:parseInt(n[5],10),maxSecond:parseInt(l[5],10),minMinute:parseInt(n[4],10),maxMinute:parseInt(l[4],10),minHour:parseInt(n[3],10),maxHour:parseInt(l[3],10),minDate:parseInt(n[2],10),maxDate:parseInt(l[2],10),minMonth:parseInt(n[1],10)-1,maxMonth:parseInt(l[1],10)-1,minYear:parseInt(n[0],10),maxYear:parseInt(l[0],10)}}isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}calculcateLastDaysOfMonth(e,t,a){return this.determineDaysOfMonths(e,t)-a}determineDaysOfYear(e){let t=365;return this.isLeapYear(e)&&(t=366),t}determineRemainingDaysOfYear(e,t,a){let r=this.daysCntOfYear[t]+a;return t>1&&this.isLeapYear()&&r++,r}determineDaysOfMonths(e,t){let a=30;switch(e=Utils.monthMod(e),!0){case this.months30.indexOf(e)>-1:2===e&&(a=this.isLeapYear(t)?29:28);break;case this.months31.indexOf(e)>-1:default:a=31}return a}}export default DateTime;