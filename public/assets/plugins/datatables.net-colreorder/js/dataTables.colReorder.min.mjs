/*! For license information please see dataTables.colReorder.min.mjs.LICENSE.txt */
import t from"jquery";import e from"datatables.net";let r=t;function o(t,e,r,o){var n=t.splice(e,r);n.unshift(0),n.unshift(o<e?o:o-r+1),t.splice.apply(t,n)}function n(t){t.rows().invalidate("data"),t.column(0).visible(t.column(0).visible()),t.columns.adjust();var e=t.colReorder.order();t.trigger("columns-reordered",[{order:e,mapping:a(e)}])}function s(t){return t.settings()[0].aoColumns.map((function(t){return t._crOriginalIdx}))}function i(t,e,r,n){for(var s=[],i=0;i<t.length;i++){var l=t[i];o(l,r[0],r.length,n);for(var a=0;a<l.length;a++){var c,u=l[a].cell;s.includes(u)||(c=u.getAttribute("data-dt-column").split(",").map((function(t){return e[t]})).join(","),u.setAttribute("data-dt-column",c),s.push(u))}}}function l(t){t.columns().iterator("column",(function(t,e){void 0===(t=t.aoColumns)[e]._crOriginalIdx&&(t[e]._crOriginalIdx=e)}))}function a(t){for(var e=[],r=0;r<t.length;r++)e[t[r]]=r;return e}function c(t,e,r){var n,s=t.settings()[0],l=s.aoColumns,c=l.map((function(t,e){return e}));if(!e.includes(r)){o(c,e[0],e.length,r);var d=a(c);for(o(l,e[0],e.length,r),n=0;n<s.aoData.length;n++){var h=s.aoData[n];if(h){var f=h.anCells;if(f)for(o(f,e[0],e.length,r),g=0;g<f.length;g++)h.nTr&&f[g]&&l[g].bVisible&&h.nTr.appendChild(f[g]),f[g]&&f[g]._DT_CellIndex&&(f[g]._DT_CellIndex.column=g)}}for(n=0;n<l.length;n++){for(var p=l[n],g=0;g<p.aDataSort.length;g++)p.aDataSort[g]=d[p.aDataSort[g]];p.idx=d[p.idx],p.bVisible&&s.colgroup.append(p.colEl)}i(s.aoHeader,d,e,r),i(s.aoFooter,d,e,r),o(s.aoPreSearchCols,e[0],e.length,r),u(d,s.aaSorting),Array.isArray(s.aaSortingFixed)?u(d,s.aaSortingFixed):(s.aaSortingFixed.pre||s.aaSortingFixed.post)&&u(d,s.aaSortingFixed.pre),s.aLastSort.forEach((function(t){t.src=d[t.src]})),t.trigger("column-reorder",[t.settings()[0],{from:e,to:r,mapping:d}])}}function u(t,e){if(e)for(var o=0;o<e.length;o++){var n=e[o];"number"==typeof n?e[o]=t[n]:r.isPlainObject(n)&&void 0!==n.idx?n.idx=t[n.idx]:Array.isArray(n)&&"number"==typeof n[0]&&(n[0]=t[n[0]])}}function d(t,e,r){var s=!1;if(e.length!==t.columns().count())t.error("ColReorder - column count mismatch");else{for(var i=a(e=r?h(t,e,"toCurrent"):e),l=0;l<i.length;l++){var u=i.indexOf(l);l!==u&&(o(i,u,1,l),c(t,[u],l),s=!0)}s&&n(t)}}function h(t,e,r){var o=t.colReorder.order(),n=t.settings()[0].aoColumns;return"toCurrent"===r||"fromOriginal"===r?Array.isArray(e)?e.map((function(t){return o.indexOf(t)})):o.indexOf(e):Array.isArray(e)?e.map((function(t){return n[t]._crOriginalIdx})):n[e]._crOriginalIdx}function f(t,e,r){var o=t.columns().count();return!(e[0]<r&&r<e[e.length]||e[0]<0&&e[e.length-1]>o||r<0&&o<r||!e.includes(r)&&(!p(t.table().header.structure(),e,r)||!p(t.table().footer.structure(),e,r)))}function p(t,e,r){for(var n=function(t){for(var e=[],r=0;r<t.length;r++){e.push([]);for(var o=0;o<t[r].length;o++){var n=t[r][o];if(n)for(var s=0;s<n.rowspan;s++){e[r+s]||(e[r+s]=[]);for(var i=0;i<n.colspan;i++)e[r+s][o+i]=n.cell}}}return e}(t),s=0;s<n.length;s++)o(n[s],e[0],e.length,r);for(s=0;s<n.length;s++)for(var i=[],l=0;l<n[s].length;l++){var a=n[s][l];if(i.includes(a)){if(i[i.length-1]!==a)return!1}else i.push(a)}return!0}var g=function(){function t(e,o){this.dom={drag:null},this.c={columns:null,enable:null,order:null},this.s={dropZones:[],mouse:{absLeft:-1,offset:{x:-1,y:-1},start:{x:-1,y:-1},target:null,targets:[]},scrollInterval:null};var n,i=this;e.settings()[0]._colReorder||((e.settings()[0]._colReorder=this).dt=e,r.extend(this.c,t.defaults,o),l(e),e.on("stateSaveParams",(function(t,r,o){o.colReorder=s(e)})),e.on("destroy",(function(){e.off(".colReorder"),e.colReorder.reset()})),o=e.state.loaded(),n=this.c.order,(n=o&&o.colReorder?o.colReorder:n)&&e.ready((function(){d(e,n,!0)})),e.table().header.structure().forEach((function(t){for(var e=0;e<t.length;e++)t[e]&&t[e].cell&&i._addListener(t[e].cell)})))}return t.prototype.disable=function(){return this.c.enable=!1,this},t.prototype.enable=function(t){return!1===(t=void 0===t||t)?this.disable():(this.c.enable=!0,this)},t.prototype._addListener=function(t){var e=this;r(t).on("selectstart.colReorder",(function(){return!1})).on("mousedown.colReorder touchstart.colReorder",(function(t){"mousedown"===t.type&&1!==t.which||e.c.enable&&e._mouseDown(t,this)}))},t.prototype._createDragNode=function(){var t=this.s.mouse.target,e=t.parent(),o=e.parent(),n=o.parent(),s=t.clone();this.dom.drag=r(n[0].cloneNode(!1)).addClass("dtcr-cloned").append(r(o[0].cloneNode(!1)).append(r(e[0].cloneNode(!1)).append(s[0]))).css({position:"absolute",top:0,left:0,width:r(t).outerWidth(),height:r(t).outerHeight()}).appendTo("body")},t.prototype._cursorPosition=function(t,e){return(-1!==t.type.indexOf("touch")?t.originalEvent.touches[0]:t)[e]},t.prototype._mouseDown=function(t,e){for(var o=this,n=r(t.target).closest("th, td"),s=n.offset(),i=this.dt.columns(this.c.columns).indexes().toArray(),l=r(e).attr("data-dt-column").split(",").map((function(t){return parseInt(t,10)})),a=0;a<l.length;a++)if(!i.includes(l[a]))return!1;this.s.mouse.start.x=this._cursorPosition(t,"pageX"),this.s.mouse.start.y=this._cursorPosition(t,"pageY"),this.s.mouse.offset.x=this._cursorPosition(t,"pageX")-s.left,this.s.mouse.offset.y=this._cursorPosition(t,"pageY")-s.top,this.s.mouse.target=n,this.s.mouse.targets=l;for(var c=0;c<l.length;c++){var u=this.dt.cells(null,l[c],{page:"current"}).nodes().to$(),d="dtcr-moving";0===c&&(d+=" dtcr-moving-first"),c===l.length-1&&(d+=" dtcr-moving-last"),u.addClass(d)}this._regions(l),this._scrollRegions(),r(document).on("mousemove.colReorder touchmove.colReorder",(function(t){o._mouseMove(t)})).on("mouseup.colReorder touchend.colReorder",(function(t){o._mouseUp(t)}))},t.prototype._mouseMove=function(t){if(null===this.dom.drag){if(Math.pow(Math.pow(this._cursorPosition(t,"pageX")-this.s.mouse.start.x,2)+Math.pow(this._cursorPosition(t,"pageY")-this.s.mouse.start.y,2),.5)<5)return;r(document.body).addClass("dtcr-dragging"),this._createDragNode()}this.dom.drag.css({left:this._cursorPosition(t,"pageX")-this.s.mouse.offset.x,top:this._cursorPosition(t,"pageY")-this.s.mouse.offset.y});var e=r(this.dt.table().node()).offset().left,o=this._cursorPosition(t,"pageX")-e;e=this.s.dropZones.find((function(t){return t.left<=o&&o<=t.left+t.width}));this.s.mouse.absLeft=this._cursorPosition(t,"pageX"),e&&!e.self&&this._move(e,o)},t.prototype._mouseUp=function(t){r(document).off(".colReorder"),r(document.body).removeClass("dtcr-dragging"),this.dom.drag&&(this.dom.drag.remove(),this.dom.drag=null),this.s.scrollInterval&&clearInterval(this.s.scrollInterval),this.dt.cells(".dtcr-moving").nodes().to$().removeClass("dtcr-moving dtcr-moving-first dtcr-moving-last")},t.prototype._move=function(t,e){var o,n,s=this,i=(this.dt.colReorder.move(this.s.mouse.targets,t.colIdx),this.s.mouse.targets=r(this.s.mouse.target).attr("data-dt-column").split(",").map((function(t){return parseInt(t,10)})),this._regions(this.s.mouse.targets),this.s.mouse.targets.filter((function(t){return s.dt.column(t).visible()}))),l=(t=this.s.dropZones.find((function(t){return t.colIdx===i[0]})),this.s.dropZones.indexOf(t));t.left>e&&(n=t.left-e,o=this.s.dropZones[l-1],t.left-=n,t.width+=n,o)&&(o.width-=n),(t=this.s.dropZones.find((function(t){return t.colIdx===i[i.length-1]}))).left+t.width<e&&(o=e-(t.left+t.width),n=this.s.dropZones[l+1],t.width+=o,n)&&(n.left+=o,n.width-=o)},t.prototype._regions=function(t){var e=this,r=[],o=0,n=0,s=this.dt.columns(this.c.columns).indexes().toArray(),i=this.dt.columns().widths();this.dt.columns().every((function(l,a,c){var u;this.visible()&&(u=i[l],s.includes(l)&&(f(e.dt,t,l)?r.push({colIdx:l,left:o-n,self:t[0]<=l&&l<=t[t.length-1],width:u+n}):l<t[0]?r.length&&(r[r.length-1].width+=u):l>t[t.length-1]&&(n+=u)),o+=u)})),this.s.dropZones=r},t.prototype._isScrolling=function(){return this.dt.table().body().parentNode!==this.dt.table().header().parentNode},t.prototype._scrollRegions=function(){var t,e,o,n;this._isScrolling()&&(t=this,e=r(this.dt.table().container()).position().left,o=r(this.dt.table().container()).outerWidth(),n=this.dt.table().body().parentElement.parentElement,this.s.scrollInterval=setInterval((function(){var r=t.s.mouse.absLeft;r<e+75&&n.scrollLeft?n.scrollLeft-=5:e+o-75<r&&n.scrollLeft<n.scrollWidth&&(n.scrollLeft+=5)}),25))},t.defaults={columns:"",enable:!0,order:null},t.version="2.0.3",t}();e.Api.register("colReorder.enable()",(function(t){return this.iterator("table",(function(e){e._colReorder&&e._colReorder.enable(t)}))})),e.Api.register("colReorder.disable()",(function(){return this.iterator("table",(function(t){t._colReorder&&t._colReorder.disable()}))})),e.Api.register("colReorder.move()",(function(t,e){return l(this),f(this,t=Array.isArray(t)?t:[t],e)?this.tables().every((function(){c(this,t,e),n(this)})):(this.error("ColReorder - invalid move"),this)})),e.Api.register("colReorder.order()",(function(t,e){return l(this),t?this.tables().every((function(){d(this,t,e)})):this.context.length?s(this):null})),e.Api.register("colReorder.reset()",(function(){return l(this),this.tables().every((function(){d(this,this.columns().every((function(t){return t})).flatten().toArray(),!0)}))})),e.Api.register("colReorder.transpose()",(function(t,e){return l(this),h(this,t,e=e||"toCurrent")})),e.ColReorder=g,r(document).on("stateLoadInit.dt",(function(t,r,o){if("dt"===t.namespace&&(t=new e.Api(r),o.colReorder))if(t.ready())d(t,o.colReorder,!0);else{u(a(o.colReorder),o.order);for(var n=0;n<o.columns.length;n++)o.columns[n]._cr_sort=o.colReorder[n];o.columns.sort((function(t,e){return t._cr_sort-e._cr_sort}))}})),r(document).on("preInit.dt",(function(t,o){var n,s;"dt"===t.namespace&&(t=o.oInit.colReorder,s=e.defaults.colReorder,t||s)&&(n=r.extend({},s,t),!1!==t)&&(s=new e.Api(o),new g(s,n))}));export default e;