import Constants from"./constants/index.js";import Utils from"./utils/index.js";import VirtualScroll from"./virtual-scroll/index.js";class BootstrapTable{constructor(t,i){this.options=i,this.$el=$(t),this.$el_=this.$el.clone(),this.timeoutId_=0,this.timeoutFooter_=0}init(){this.initConstants(),this.initLocale(),this.initContainer(),this.initTable(),this.initHeader(),this.initData(),this.initHiddenRows(),this.initToolbar(),this.initPagination(),this.initBody(),this.initSearchText(),this.initServer()}initConstants(){const t=this.options;this.constants=Constants.CONSTANTS,this.constants.theme=$.fn.bootstrapTable.theme,this.constants.dataToggle=this.constants.html.dataToggle||"data-toggle";const i=Utils.getIconsPrefix($.fn.bootstrapTable.theme);"string"==typeof t.icons&&(t.icons=Utils.calculateObjectValue(null,t.icons)),t.iconsPrefix=t.iconsPrefix||$.fn.bootstrapTable.defaults.iconsPrefix||i,t.icons=Object.assign(Utils.getIcons(t.iconsPrefix),$.fn.bootstrapTable.defaults.icons,t.icons);const s=t.buttonsPrefix?`${t.buttonsPrefix}-`:"";this.constants.buttonsClass=[t.buttonsPrefix,s+t.buttonsClass,Utils.sprintf(`${s}%s`,t.iconSize)].join(" ").trim(),this.buttons=Utils.calculateObjectValue(this,t.buttons,[],{}),"object"!=typeof this.buttons&&(this.buttons={})}initLocale(){if(this.options.locale){const t=$.fn.bootstrapTable.locales,i=this.options.locale.split(/-|_/);i[0]=i[0].toLowerCase(),i[1]&&(i[1]=i[1].toUpperCase());let s={};t[this.options.locale]?s=t[this.options.locale]:t[i.join("-")]?s=t[i.join("-")]:t[i[0]]&&(s=t[i[0]]),this._defaultLocales=this._defaultLocales||{};for(const[t,i]of Object.entries(s)){const s=this._defaultLocales.hasOwnProperty(t)?this._defaultLocales[t]:BootstrapTable.DEFAULTS[t];this.options[t]===s&&(this.options[t]=i,this._defaultLocales[t]=i)}}}initContainer(){const t=["top","both"].includes(this.options.paginationVAlign)?'<div class="fixed-table-pagination clearfix"></div>':"",i=["bottom","both"].includes(this.options.paginationVAlign)?'<div class="fixed-table-pagination"></div>':"",s=Utils.calculateObjectValue(this.options,this.options.loadingTemplate,[this.options.formatLoadingMessage()]);this.$container=$(`\n      <div class="bootstrap-table ${this.constants.theme}">\n      <div class="fixed-table-toolbar"></div>\n      ${t}\n      <div class="fixed-table-container">\n      <div class="fixed-table-header"><table></table></div>\n      <div class="fixed-table-body">\n      <div class="fixed-table-loading">\n      ${s}\n      </div>\n      </div>\n      <div class="fixed-table-footer"></div>\n      </div>\n      ${i}\n      </div>\n    `),this.$container.insertAfter(this.$el),this.$tableContainer=this.$container.find(".fixed-table-container"),this.$tableHeader=this.$container.find(".fixed-table-header"),this.$tableBody=this.$container.find(".fixed-table-body"),this.$tableLoading=this.$container.find(".fixed-table-loading"),this.$tableFooter=this.$el.find("tfoot"),this.options.buttonsToolbar?this.$toolbar=$("body").find(this.options.buttonsToolbar):this.$toolbar=this.$container.find(".fixed-table-toolbar"),this.$pagination=this.$container.find(".fixed-table-pagination"),this.$tableBody.append(this.$el),this.$container.after('<div class="clearfix"></div>'),this.$el.addClass(this.options.classes),this.$tableLoading.addClass(this.options.classes),this.options.height&&(this.$tableContainer.addClass("fixed-height"),this.options.showFooter&&this.$tableContainer.addClass("has-footer"),this.options.classes.split(" ").includes("table-bordered")&&(this.$tableBody.append('<div class="fixed-table-border"></div>'),this.$tableBorder=this.$tableBody.find(".fixed-table-border"),this.$tableLoading.addClass("fixed-table-border")),this.$tableFooter=this.$container.find(".fixed-table-footer"))}initTable(){const t=[];if(this.$header=this.$el.find(">thead"),this.$header.length?this.options.theadClasses&&this.$header.addClass(this.options.theadClasses):this.$header=$(`<thead class="${this.options.theadClasses}"></thead>`).appendTo(this.$el),this._headerTrClasses=[],this._headerTrStyles=[],this.$header.find("tr").each(((i,s)=>{const e=$(s),o=[];e.find("th").each(((t,i)=>{const s=$(i);void 0!==s.data("field")&&s.data("field",`${s.data("field")}`);const e=Object.assign({},s.data());for(const t in e)$.fn.bootstrapTable.columnDefaults.hasOwnProperty(t)&&delete e[t];o.push(Utils.extend({},{_data:Utils.getRealDataAttr(e),title:s.html(),class:s.attr("class"),titleTooltip:s.attr("title"),rowspan:s.attr("rowspan")?+s.attr("rowspan"):void 0,colspan:s.attr("colspan")?+s.attr("colspan"):void 0},s.data()))})),t.push(o),e.attr("class")&&this._headerTrClasses.push(e.attr("class")),e.attr("style")&&this._headerTrStyles.push(e.attr("style"))})),Array.isArray(this.options.columns[0])||(this.options.columns=[this.options.columns]),this.options.columns=Utils.extend(!0,[],t,this.options.columns),this.columns=[],this.fieldsColumnsIndex=[],Utils.setFieldIndex(this.options.columns),this.options.columns.forEach(((t,i)=>{t.forEach(((t,s)=>{const e=Utils.extend({},BootstrapTable.COLUMN_DEFAULTS,t,{passed:t});void 0!==e.fieldIndex&&(this.columns[e.fieldIndex]=e,this.fieldsColumnsIndex[e.field]=e.fieldIndex),this.options.columns[i][s]=e}))})),!this.options.data.length){const t=Utils.trToData(this.columns,this.$el.find(">tbody>tr"));t.length&&(this.options.data=t,this.fromHtml=!0)}this.options.pagination&&"server"!==this.options.sidePagination||(this.footerData=Utils.trToData(this.columns,this.$el.find(">tfoot>tr"))),this.footerData&&this.$el.find("tfoot").html("<tr></tr>"),!this.options.showFooter||this.options.cardView?this.$tableFooter.hide():this.$tableFooter.show()}initHeader(){const t={},i=[];this.header={fields:[],styles:[],classes:[],formatters:[],detailFormatters:[],events:[],sorters:[],sortNames:[],cellStyles:[],searchables:[]},Utils.updateFieldGroup(this.options.columns,this.columns),this.options.columns.forEach(((s,e)=>{const o=[];o.push(`<tr${Utils.sprintf(' class="%s"',this._headerTrClasses[e])} ${Utils.sprintf(' style="%s"',this._headerTrStyles[e])}>`);let n="";if(0===e&&Utils.hasDetailViewIcon(this.options)){n=`<th class="detail"${this.options.columns.length>1?` rowspan="${this.options.columns.length}"`:""}>\n          <div class="fht-cell"></div>\n          </th>`}n&&"right"!==this.options.detailViewAlign&&o.push(n),s.forEach(((i,s)=>{const n=Utils.sprintf(' class="%s"',i.class),a=i.widthUnit,l=parseFloat(i.width),h=i.halign?i.halign:i.align,r=Utils.sprintf("text-align: %s; ",h),d=Utils.sprintf("text-align: %s; ",i.align);let c=Utils.sprintf("vertical-align: %s; ",i.valign);if(c+=Utils.sprintf("width: %s; ",!i.checkbox&&!i.radio||l?l?l+a:void 0:i.showSelectTitle?void 0:"36px"),void 0===i.fieldIndex&&!i.visible)return;const p=Utils.calculateObjectValue(null,this.options.headerStyle,[i]),f=[],g=[];let u="";if(p&&p.css)for(const[t,i]of Object.entries(p.css))f.push(`${t}: ${i}`);if(p&&p.classes&&(u=Utils.sprintf(' class="%s"',i.class?[i.class,p.classes].join(" "):p.classes)),void 0!==i.fieldIndex){if(this.header.fields[i.fieldIndex]=i.field,this.header.styles[i.fieldIndex]=d+c,this.header.classes[i.fieldIndex]=n,this.header.formatters[i.fieldIndex]=i.formatter,this.header.detailFormatters[i.fieldIndex]=i.detailFormatter,this.header.events[i.fieldIndex]=i.events,this.header.sorters[i.fieldIndex]=i.sorter,this.header.sortNames[i.fieldIndex]=i.sortName,this.header.cellStyles[i.fieldIndex]=i.cellStyle,this.header.searchables[i.fieldIndex]=i.searchable,!i.visible)return;if(this.options.cardView&&!i.cardVisible)return;t[i.field]=i}if(Object.keys(i._data||{}).length>0)for(const[t,s]of Object.entries(i._data))g.push(`data-${t}='${"object"==typeof s?JSON.stringify(s):s}'`);o.push(`<th${Utils.sprintf(' title="%s"',i.titleTooltip)}`,i.checkbox||i.radio?Utils.sprintf(' class="bs-checkbox %s"',i.class||""):u||n,Utils.sprintf(' style="%s"',r+c+f.join("; ")||void 0),Utils.sprintf(' rowspan="%s"',i.rowspan),Utils.sprintf(' colspan="%s"',i.colspan),Utils.sprintf(' data-field="%s"',i.field),0===s&&e>0?" data-not-first-th":"",g.length>0?g.join(" "):"",">"),o.push(Utils.sprintf('<div class="th-inner %s">',this.options.sortable&&i.sortable?`sortable${"center"===h?" sortable-center":""} both`:""));let b=this.options.escape&&this.options.escapeTitle?Utils.escapeHTML(i.title):i.title;const m=b;i.checkbox&&(b="",!this.options.singleSelect&&this.options.checkboxHeader&&(b='<label><input name="btSelectAll" type="checkbox" /><span></span></label>'),this.header.stateField=i.field),i.radio&&(b="",this.header.stateField=i.field),!b&&i.showSelectTitle&&(b+=m),o.push(b),o.push("</div>"),o.push('<div class="fht-cell"></div>'),o.push("</div>"),o.push("</th>")})),n&&"right"===this.options.detailViewAlign&&o.push(n),o.push("</tr>"),o.length>3&&i.push(o.join(""))})),this.$header.html(i.join("")),this.$header.find("th[data-field]").each(((i,s)=>{$(s).data(t[$(s).data("field")])})),this.$container.off("click",".th-inner").on("click",".th-inner",(t=>{const i=$(t.currentTarget);if(this.options.detailView&&!i.parent().hasClass("bs-checkbox")&&i.closest(".bootstrap-table")[0]!==this.$container[0])return!1;this.options.sortable&&i.parent().data().sortable&&this.onSort(t)}));const s=Utils.getEventName("resize.bootstrap-table",this.$el.attr("id"));$(window).off(s),!this.options.showHeader||this.options.cardView?(this.$header.hide(),this.$tableHeader.hide(),this.$tableLoading.css("top",0)):(this.$header.show(),this.$tableHeader.show(),this.$tableLoading.css("top",this.$header.outerHeight()+1),this.getCaret(),$(window).on(s,(()=>this.resetView()))),this.$selectAll=this.$header.find('[name="btSelectAll"]'),this.$selectAll.off("click").on("click",(t=>{t.stopPropagation();this[$(t.currentTarget).prop("checked")?"checkAll":"uncheckAll"](),this.updateSelected()}))}initData(t,i){"append"===i?this.options.data=this.options.data.concat(t):"prepend"===i?this.options.data=[].concat(t).concat(this.options.data):(t=t||Utils.deepCopy(this.options.data),this.options.data=Array.isArray(t)?t:t[this.options.dataField]),this.data=[...this.options.data],this.options.sortReset&&(this.unsortedData=[...this.data]),"server"!==this.options.sidePagination&&this.initSort()}initSort(){let t=this.options.sortName;const i="desc"===this.options.sortOrder?-1:1,s=this.header.fields.indexOf(this.options.sortName);let e=0;-1!==s?(this.options.sortStable&&this.data.forEach(((t,i)=>{t.hasOwnProperty("_position")||(t._position=i)})),this.options.customSort?Utils.calculateObjectValue(this.options,this.options.customSort,[this.options.sortName,this.options.sortOrder,this.data]):this.data.sort(((e,o)=>{this.header.sortNames[s]&&(t=this.header.sortNames[s]);const n=Utils.getItemField(e,t,this.options.escape),a=Utils.getItemField(o,t,this.options.escape),l=Utils.calculateObjectValue(this.header,this.header.sorters[s],[n,a,e,o]);return void 0!==l?this.options.sortStable&&0===l?i*(e._position-o._position):i*l:Utils.sort(n,a,i,this.options,e._position,o._position)})),void 0!==this.options.sortClass&&(clearTimeout(e),e=setTimeout((()=>{this.$el.removeClass(this.options.sortClass);const t=this.$header.find(`[data-field="${this.options.sortName}"]`).index();this.$el.find(`tr td:nth-child(${t+1})`).addClass(this.options.sortClass)}),250))):this.options.sortReset&&(this.data=[...this.unsortedData])}sortBy(t){this.options.sortName=t.field,this.options.sortOrder=t.hasOwnProperty("sortOrder")?t.sortOrder:"asc",this._sort()}onSort({type:t,currentTarget:i}){const s="keypress"===t?$(i):$(i).parent(),e=this.$header.find("th").eq(s.index());if(this.$header.add(this.$header_).find("span.order").remove(),this.options.sortName===s.data("field")){const t=this.options.sortOrder,i=this.columns[this.fieldsColumnsIndex[s.data("field")]].sortOrder||this.columns[this.fieldsColumnsIndex[s.data("field")]].order;void 0===t?this.options.sortOrder="asc":"asc"===t?this.options.sortOrder=this.options.sortReset?"asc"===i?"desc":void 0:"desc":"desc"===this.options.sortOrder&&(this.options.sortOrder=this.options.sortReset?"desc"===i?"asc":void 0:"asc"),void 0===this.options.sortOrder&&(this.options.sortName=void 0)}else this.options.sortName=s.data("field"),this.options.rememberOrder?this.options.sortOrder="asc"===s.data("order")?"desc":"asc":this.options.sortOrder=this.columns[this.fieldsColumnsIndex[s.data("field")]].sortOrder||this.columns[this.fieldsColumnsIndex[s.data("field")]].order;s.add(e).data("order",this.options.sortOrder),this.getCaret(),this._sort()}_sort(){if("server"===this.options.sidePagination&&this.options.serverSort)return this.options.pageNumber=1,this.trigger("sort",this.options.sortName,this.options.sortOrder),void this.initServer(this.options.silentSort);this.options.pagination&&this.options.sortResetPage&&(this.options.pageNumber=1,this.initPagination()),this.trigger("sort",this.options.sortName,this.options.sortOrder),this.initSort(),this.initBody()}initToolbar(){const t=this.options;let i,s=[],e=0,o=0;this.$toolbar.find(".bs-bars").children().length&&$("body").append($(t.toolbar)),this.$toolbar.html(""),"string"!=typeof t.toolbar&&"object"!=typeof t.toolbar||$(Utils.sprintf('<div class="bs-bars %s-%s"></div>',this.constants.classes.pull,t.toolbarAlign)).appendTo(this.$toolbar).append($(t.toolbar)),s=[`<div class="${["columns",`columns-${t.buttonsAlign}`,this.constants.classes.buttonsGroup,`${this.constants.classes.pull}-${t.buttonsAlign}`].join(" ")}">`],"string"==typeof t.buttonsOrder&&(t.buttonsOrder=t.buttonsOrder.replace(/\[|\]| |'/g,"").split(",")),this.buttons=Object.assign(this.buttons,{paginationSwitch:{text:t.pagination?t.formatPaginationSwitchUp():t.formatPaginationSwitchDown(),icon:t.pagination?t.icons.paginationSwitchDown:t.icons.paginationSwitchUp,render:!1,event:this.togglePagination,attributes:{"aria-label":t.formatPaginationSwitch(),title:t.formatPaginationSwitch()}},refresh:{text:t.formatRefresh(),icon:t.icons.refresh,render:!1,event:this.refresh,attributes:{"aria-label":t.formatRefresh(),title:t.formatRefresh()}},toggle:{text:t.formatToggleOn(),icon:t.icons.toggleOff,render:!1,event:this.toggleView,attributes:{"aria-label":t.formatToggleOn(),title:t.formatToggleOn()}},fullscreen:{text:t.formatFullscreen(),icon:t.icons.fullscreen,render:!1,event:this.toggleFullscreen,attributes:{"aria-label":t.formatFullscreen(),title:t.formatFullscreen()}},columns:{render:!1,html:()=>{const i=[];if(i.push(`<div class="keep-open ${this.constants.classes.buttonsDropdown}">\n            <button class="${this.constants.buttonsClass} dropdown-toggle" type="button" ${this.constants.dataToggle}="dropdown"\n            aria-label="${t.formatColumns()}" title="${t.formatColumns()}">\n            ${t.showButtonIcons?Utils.sprintf(this.constants.html.icon,t.iconsPrefix,t.icons.columns):""}\n            ${t.showButtonText?t.formatColumns():""}\n            ${this.constants.html.dropdownCaret}\n            </button>\n            ${this.constants.html.toolbarDropdown[0]}`),t.showColumnsSearch&&(i.push(Utils.sprintf(this.constants.html.toolbarDropdownItem,Utils.sprintf('<input type="text" class="%s" name="columnsSearch" placeholder="%s" autocomplete="off">',this.constants.classes.input,t.formatSearch()))),i.push(this.constants.html.toolbarDropdownSeparator)),t.showColumnsToggleAll){const s=this.getVisibleColumns().length===this.columns.filter((t=>!this.isSelectionColumn(t))).length;i.push(Utils.sprintf(this.constants.html.toolbarDropdownItem,Utils.sprintf('<input type="checkbox" class="toggle-all" %s> <span>%s</span>',s?'checked="checked"':"",t.formatColumnsToggleAll()))),i.push(this.constants.html.toolbarDropdownSeparator)}let s=0;return this.columns.forEach((t=>{t.visible&&s++})),this.columns.forEach(((e,n)=>{if(this.isSelectionColumn(e))return;if(t.cardView&&!e.cardVisible)return;const a=e.visible?' checked="checked"':"",l=s<=t.minimumCountColumns&&a?' disabled="disabled"':"";e.switchable&&(i.push(Utils.sprintf(this.constants.html.toolbarDropdownItem,Utils.sprintf('<input type="checkbox" data-field="%s" value="%s"%s%s> <span>%s</span>',e.field,n,a,l,e.switchableLabel||e.title))),o++)})),i.push(this.constants.html.toolbarDropdown[1],"</div>"),i.join("")}}});const n={};for(const[i,s]of Object.entries(this.buttons)){let e;if(s.hasOwnProperty("html"))"function"==typeof s.html?e=s.html():"string"==typeof s.html&&(e=s.html);else{let o=this.constants.buttonsClass;if(s.hasOwnProperty("attributes")&&s.attributes.class&&(o+=` ${s.attributes.class}`),e=`<button class="${o}" type="button" name="${i}"`,s.hasOwnProperty("attributes"))for(const[t,i]of Object.entries(s.attributes))"class"!==t&&(e+=` ${t}="${i}"`);e+=">",t.showButtonIcons&&s.hasOwnProperty("icon")&&(e+=`${Utils.sprintf(this.constants.html.icon,t.iconsPrefix,s.icon)} `),t.showButtonText&&s.hasOwnProperty("text")&&(e+=s.text),e+="</button>"}n[i]=e;const o=`show${i.charAt(0).toUpperCase()}${i.substring(1)}`,a=t[o];!(!s.hasOwnProperty("render")||s.hasOwnProperty("render")&&s.render)||void 0!==a&&!0!==a||(t[o]=!0),t.buttonsOrder.includes(i)||t.buttonsOrder.push(i)}for(const i of t.buttonsOrder){t[`show${i.charAt(0).toUpperCase()}${i.substring(1)}`]&&s.push(n[i])}s.push("</div>"),(this.showToolbar||s.length>2)&&this.$toolbar.append(s.join(""));for(const[t,i]of Object.entries(this.buttons))if(i.hasOwnProperty("event")){if("function"==typeof i.event||"string"==typeof i.event){const s="string"==typeof i.event?window[i.event]:i.event;this.$toolbar.find(`button[name="${t}"]`).off("click").on("click",(()=>s.call(this)));continue}for(const[s,e]of Object.entries(i.event)){const i="string"==typeof e?window[e]:e;this.$toolbar.find(`button[name="${t}"]`).off(s).on(s,(()=>i.call(this)))}}if(t.showColumns){i=this.$toolbar.find(".keep-open");const s=i.find('input[type="checkbox"]:not(".toggle-all")'),e=i.find('input[type="checkbox"].toggle-all');if(o<=t.minimumCountColumns&&i.find("input").prop("disabled",!0),i.find("li, label").off("click").on("click",(t=>{t.stopImmediatePropagation()})),s.off("click").on("click",(({currentTarget:t})=>{const i=$(t);this._toggleColumn(i.val(),i.prop("checked"),!1),this.trigger("column-switch",i.data("field"),i.prop("checked")),e.prop("checked",s.filter(":checked").length===this.columns.filter((t=>!this.isSelectionColumn(t))).length)})),e.off("click").on("click",(({currentTarget:t})=>{this._toggleAllColumns($(t).prop("checked")),this.trigger("column-switch-all",$(t).prop("checked"))})),t.showColumnsSearch){const t=i.find('[name="columnsSearch"]'),e=i.find(".dropdown-item-marker");t.on("keyup paste change",(({currentTarget:t})=>{const i=$(t).val().toLowerCase();e.show(),s.each(((t,s)=>{const e=$(s).parents(".dropdown-item-marker");e.text().toLowerCase().includes(i)||e.hide()}))}))}}const a=i=>{const s=i.is("select")?"change":"keyup drop blur mouseup";i.off(s).on(s,(i=>{t.searchOnEnterKey&&13!==i.keyCode||[37,38,39,40].includes(i.keyCode)||(clearTimeout(e),e=setTimeout((()=>{this.onSearch({currentTarget:i.currentTarget})}),t.searchTimeOut))}))};if((t.search||this.showSearchClearButton)&&"string"!=typeof t.searchSelector){s=[];const i=Utils.sprintf(this.constants.html.searchButton,this.constants.buttonsClass,t.formatSearch(),t.showButtonIcons?Utils.sprintf(this.constants.html.icon,t.iconsPrefix,t.icons.search):"",t.showButtonText?t.formatSearch():""),o=Utils.sprintf(this.constants.html.searchClearButton,this.constants.buttonsClass,t.formatClearSearch(),t.showButtonIcons?Utils.sprintf(this.constants.html.icon,t.iconsPrefix,t.icons.clearSearch):"",t.showButtonText?t.formatClearSearch():""),n=`<input class="${this.constants.classes.input}\n        ${Utils.sprintf(" %s%s",this.constants.classes.inputPrefix,t.iconSize)}\n        search-input" type="search" aria-label="${t.formatSearch()}" placeholder="${t.formatSearch()}" autocomplete="off">`;let l=n;if(t.showSearchButton||t.showSearchClearButton){const s=(t.showSearchButton?i:"")+(t.showSearchClearButton?o:"");l=t.search?Utils.sprintf(this.constants.html.inputGroup,n,s):s}s.push(Utils.sprintf(`\n        <div class="${this.constants.classes.pull}-${t.searchAlign} search ${this.constants.classes.inputGroup}">\n          %s\n        </div>\n      `,l)),this.$toolbar.append(s.join(""));const h=Utils.getSearchInput(this);t.showSearchButton?(this.$toolbar.find(".search button[name=search]").off("click").on("click",(()=>{clearTimeout(e),e=setTimeout((()=>{this.onSearch({currentTarget:h})}),t.searchTimeOut)})),t.searchOnEnterKey&&a(h)):a(h),t.showSearchClearButton&&this.$toolbar.find(".search button[name=clearSearch]").click((()=>{this.resetSearch()}))}else"string"==typeof t.searchSelector&&a(Utils.getSearchInput(this))}onSearch({currentTarget:t,firedByInitSearchText:i}={},s=!0){if(void 0!==t&&$(t).length&&s){const i=$(t).val().trim();if(this.options.trimOnSearch&&$(t).val()!==i&&$(t).val(i),this.searchText===i)return;const s=Utils.getSearchInput(this),e=t instanceof jQuery?t:$(t);(e.is(s)||e.hasClass("search-input"))&&(this.searchText=i,this.options.searchText=i)}i||(this.options.pageNumber=1),this.initSearch(),i?"client"===this.options.sidePagination&&this.updatePagination():this.updatePagination(),this.trigger("search",this.searchText)}initSearch(){if(this.filterOptions=this.filterOptions||this.options.filterOptions,"server"!==this.options.sidePagination){if(this.options.customSearch)return this.data=Utils.calculateObjectValue(this.options,this.options.customSearch,[this.options.data,this.searchText,this.filterColumns]),this.options.sortReset&&(this.unsortedData=[...this.data]),void this.initSort();const t=this.searchText&&(this.fromHtml?Utils.escapeHTML(this.searchText):this.searchText);let i=t?t.toLowerCase():"";const s=Utils.isEmptyObject(this.filterColumns)?null:this.filterColumns;this.options.searchAccentNeutralise&&(i=Utils.normalizeAccent(i)),"function"==typeof this.filterOptions.filterAlgorithm?this.data=this.options.data.filter((t=>this.filterOptions.filterAlgorithm.apply(null,[t,s]))):"string"==typeof this.filterOptions.filterAlgorithm&&(this.data=s?this.options.data.filter((t=>{const i=this.filterOptions.filterAlgorithm;if("and"===i){for(const i in s)if(Array.isArray(s[i])&&!s[i].includes(t[i])||!Array.isArray(s[i])&&t[i]!==s[i])return!1}else if("or"===i){let i=!1;for(const e in s)(Array.isArray(s[e])&&s[e].includes(t[e])||!Array.isArray(s[e])&&t[e]===s[e])&&(i=!0);return i}return!0})):[...this.options.data]);const e=this.getVisibleFields();this.data=i?this.data.filter(((s,o)=>{for(let n=0;n<this.header.fields.length;n++){if(!this.header.searchables[n]||this.options.visibleSearch&&-1===e.indexOf(this.header.fields[n]))continue;const a=Utils.isNumeric(this.header.fields[n])?parseInt(this.header.fields[n],10):this.header.fields[n],l=this.columns[this.fieldsColumnsIndex[a]];let h;if("string"!=typeof a||s.hasOwnProperty(a))h=s[a];else{h=s;const t=a.split(".");for(let i=0;i<t.length;i++){if(null===h[t[i]]){h=null;break}h=h[t[i]]}}if(this.options.searchAccentNeutralise&&(h=Utils.normalizeAccent(h)),l&&l.searchFormatter&&(h=Utils.calculateObjectValue(l,this.header.formatters[n],[h,s,o,l.field],h)),"string"==typeof h||"number"==typeof h){if(this.options.strictSearch&&`${h}`.toLowerCase()===i||this.options.regexSearch&&Utils.regexCompare(h,t))return!0;const s=/(?:(<=|=>|=<|>=|>|<)(?:\s+)?(-?\d+)?|(-?\d+)?(\s+)?(<=|=>|=<|>=|>|<))/gm.exec(this.searchText);let e=!1;if(s){const t=s[1]||`${s[5]}l`,i=s[2]||s[3],o=parseInt(h,10),n=parseInt(i,10);switch(t){case">":case"<l":e=o>n;break;case"<":case">l":e=o<n;break;case"<=":case"=<":case">=l":case"=>l":e=o<=n;break;case">=":case"=>":case"<=l":case"=<l":e=o>=n}}if(e||`${h}`.toLowerCase().includes(i))return!0}}return!1})):this.data,this.options.sortReset&&(this.unsortedData=[...this.data]),this.initSort()}}initPagination(){const t=this.options;if(!t.pagination)return void this.$pagination.hide();this.$pagination.show();const i=[];let s,e,o,n,a,l,h,r=!1;const d=this.getData({includeHiddenRows:!1});let c=t.pageList;if("string"==typeof c&&(c=c.replace(/\[|\]| /g,"").toLowerCase().split(",")),c=c.map((i=>"string"==typeof i?i.toLowerCase()===t.formatAllRows().toLowerCase()||["all","unlimited"].includes(i.toLowerCase())?t.formatAllRows():+i:i)),this.paginationParts=t.paginationParts,"string"==typeof this.paginationParts&&(this.paginationParts=this.paginationParts.replace(/\[|\]| |'/g,"").split(",")),"server"!==t.sidePagination&&(t.totalRows=d.length),this.totalPages=0,t.totalRows&&(t.pageSize===t.formatAllRows()&&(t.pageSize=t.totalRows,r=!0),this.totalPages=1+~~((t.totalRows-1)/t.pageSize),t.totalPages=this.totalPages),this.totalPages>0&&t.pageNumber>this.totalPages&&(t.pageNumber=this.totalPages),this.pageFrom=(t.pageNumber-1)*t.pageSize+1,this.pageTo=t.pageNumber*t.pageSize,this.pageTo>t.totalRows&&(this.pageTo=t.totalRows),this.options.pagination&&"server"!==this.options.sidePagination&&(this.options.totalNotFiltered=this.options.data.length),this.options.showExtendedPagination||(this.options.totalNotFiltered=void 0),(this.paginationParts.includes("pageInfo")||this.paginationParts.includes("pageInfoShort")||this.paginationParts.includes("pageSize"))&&i.push(`<div class="${this.constants.classes.pull}-${t.paginationDetailHAlign} pagination-detail">`),this.paginationParts.includes("pageInfo")||this.paginationParts.includes("pageInfoShort")){const s=this.options.totalRows+("client"===this.options.sidePagination&&this.options.paginationLoadMore&&!this._paginationLoaded?" +":""),e=this.paginationParts.includes("pageInfoShort")?t.formatDetailPagination(s):t.formatShowingRows(this.pageFrom,this.pageTo,s,t.totalNotFiltered);i.push(`<span class="pagination-info">\n      ${e}\n      </span>`)}if(this.paginationParts.includes("pageSize")){i.push('<div class="page-list">');const s=[`<div class="${this.constants.classes.paginationDropdown}">\n        <button class="${this.constants.buttonsClass} dropdown-toggle" type="button" ${this.constants.dataToggle}="dropdown">\n        <span class="page-size">\n        ${r?t.formatAllRows():t.pageSize}\n        </span>\n        ${this.constants.html.dropdownCaret}\n        </button>\n        ${this.constants.html.pageDropdown[0]}`];c.forEach(((i,e)=>{if(!t.smartDisplay||0===e||c[e-1]<t.totalRows||i===t.formatAllRows()){let e;e=r?i===t.formatAllRows()?this.constants.classes.dropdownActive:"":i===t.pageSize?this.constants.classes.dropdownActive:"",s.push(Utils.sprintf(this.constants.html.pageDropdownItem,e,i))}})),s.push(`${this.constants.html.pageDropdown[1]}</div>`),i.push(t.formatRecordsPerPage(s.join("")))}if((this.paginationParts.includes("pageInfo")||this.paginationParts.includes("pageInfoShort")||this.paginationParts.includes("pageSize"))&&i.push("</div></div>"),this.paginationParts.includes("pageList")){i.push(`<div class="${this.constants.classes.pull}-${t.paginationHAlign} pagination">`,Utils.sprintf(this.constants.html.pagination[0],Utils.sprintf(" pagination-%s",t.iconSize)),Utils.sprintf(this.constants.html.paginationItem," page-pre",t.formatSRPaginationPreText(),t.paginationPreText)),this.totalPages<t.paginationSuccessivelySize?(e=1,o=this.totalPages):(e=t.pageNumber-t.paginationPagesBySide,o=e+2*t.paginationPagesBySide),t.pageNumber<t.paginationSuccessivelySize-1&&(o=t.paginationSuccessivelySize),t.paginationSuccessivelySize>this.totalPages-e&&(e=e-(t.paginationSuccessivelySize-(this.totalPages-e))+1),e<1&&(e=1),o>this.totalPages&&(o=this.totalPages);const n=Math.round(t.paginationPagesBySide/2),a=(i,s="")=>Utils.sprintf(this.constants.html.paginationItem,s+(i===t.pageNumber?` ${this.constants.classes.paginationActive}`:""),t.formatSRPaginationPageText(i),i);if(e>1){let o=t.paginationPagesBySide;for(o>=e&&(o=e-1),s=1;s<=o;s++)i.push(a(s));e-1===o+1?(s=e-1,i.push(a(s))):e-1>o&&(e-2*t.paginationPagesBySide>t.paginationPagesBySide&&t.paginationUseIntermediate?(s=Math.round((e-n)/2+n),i.push(a(s," page-intermediate"))):i.push(Utils.sprintf(this.constants.html.paginationItem," page-first-separator disabled","","...")))}for(s=e;s<=o;s++)i.push(a(s));if(this.totalPages>o){let e=this.totalPages-(t.paginationPagesBySide-1);for(o>=e&&(e=o+1),o+1===e-1?(s=o+1,i.push(a(s))):e>o+1&&(this.totalPages-o>2*t.paginationPagesBySide&&t.paginationUseIntermediate?(s=Math.round((this.totalPages-n-o)/2+o),i.push(a(s," page-intermediate"))):i.push(Utils.sprintf(this.constants.html.paginationItem," page-last-separator disabled","","..."))),s=e;s<=this.totalPages;s++)i.push(a(s))}i.push(Utils.sprintf(this.constants.html.paginationItem," page-next",t.formatSRPaginationNextText(),t.paginationNextText)),i.push(this.constants.html.pagination[1],"</div>")}this.$pagination.html(i.join(""));const p=["bottom","both"].includes(t.paginationVAlign)?` ${this.constants.classes.dropup}`:"";this.$pagination.last().find(".page-list > div").addClass(p),t.onlyInfoPagination||(n=this.$pagination.find(".page-list a"),a=this.$pagination.find(".page-pre"),l=this.$pagination.find(".page-next"),h=this.$pagination.find(".page-item").not(".page-next, .page-pre, .page-last-separator, .page-first-separator"),this.totalPages<=1&&this.$pagination.find("div.pagination").hide(),t.smartDisplay&&(c.length<2||t.totalRows<=c[0])&&this.$pagination.find("div.page-list").hide(),this.$pagination[this.getData().length?"show":"hide"](),t.paginationLoop||(1===t.pageNumber&&a.addClass("disabled"),t.pageNumber===this.totalPages&&l.addClass("disabled")),r&&(t.pageSize=t.formatAllRows()),n.off("click").on("click",(t=>this.onPageListChange(t))),a.off("click").on("click",(t=>this.onPagePre(t))),l.off("click").on("click",(t=>this.onPageNext(t))),h.off("click").on("click",(t=>this.onPageNumber(t))))}updatePagination(t){t&&$(t.currentTarget).hasClass("disabled")||(this.options.maintainMetaData||this.resetRows(),this.initPagination(),this.trigger("page-change",this.options.pageNumber,this.options.pageSize),"server"===this.options.sidePagination||"client"===this.options.sidePagination&&this.options.paginationLoadMore&&!this._paginationLoaded&&this.options.pageNumber===this.totalPages?this.initServer():this.initBody())}onPageListChange(t){t.preventDefault();const i=$(t.currentTarget);return i.parent().addClass(this.constants.classes.dropdownActive).siblings().removeClass(this.constants.classes.dropdownActive),this.options.pageSize=i.text().toUpperCase()===this.options.formatAllRows().toUpperCase()?this.options.formatAllRows():+i.text(),this.$toolbar.find(".page-size").text(this.options.pageSize),this.updatePagination(t),!1}onPagePre(t){if(!$(t.target).hasClass("disabled"))return t.preventDefault(),this.options.pageNumber-1==0?this.options.pageNumber=this.options.totalPages:this.options.pageNumber--,this.updatePagination(t),!1}onPageNext(t){if(!$(t.target).hasClass("disabled"))return t.preventDefault(),this.options.pageNumber+1>this.options.totalPages?this.options.pageNumber=1:this.options.pageNumber++,this.updatePagination(t),!1}onPageNumber(t){if(t.preventDefault(),this.options.pageNumber!==+$(t.currentTarget).text())return this.options.pageNumber=+$(t.currentTarget).text(),this.updatePagination(t),!1}initRow(t,i,s,e){const o=[];let n={};const a=[];let l="",h={};const r=[];if(Utils.findIndex(this.hiddenRows,t)>-1)return;if(n=Utils.calculateObjectValue(this.options,this.options.rowStyle,[t,i],n),n&&n.css)for(const[t,i]of Object.entries(n.css))a.push(`${t}: ${i}`);if(h=Utils.calculateObjectValue(this.options,this.options.rowAttributes,[t,i],h),h)for(const[t,i]of Object.entries(h))r.push(`${t}="${Utils.escapeHTML(i)}"`);if(t._data&&!Utils.isEmptyObject(t._data))for(const[i,s]of Object.entries(t._data)){if("index"===i)return;l+=` data-${i}='${"object"==typeof s?JSON.stringify(s):s}'`}o.push("<tr",Utils.sprintf(" %s",r.length?r.join(" "):void 0),Utils.sprintf(' id="%s"',Array.isArray(t)?void 0:t._id),Utils.sprintf(' class="%s"',n.classes||(Array.isArray(t)?void 0:t._class)),Utils.sprintf(' style="%s"',Array.isArray(t)?void 0:t._style),` data-index="${i}"`,Utils.sprintf(' data-uniqueid="%s"',Utils.getItemField(t,this.options.uniqueId,!1)),Utils.sprintf(' data-has-detail-view="%s"',this.options.detailView&&Utils.calculateObjectValue(null,this.options.detailFilter,[i,t])?"true":void 0),Utils.sprintf("%s",l),">"),this.options.cardView&&o.push(`<td colspan="${this.header.fields.length}"><div class="card-views">`);let d="";return Utils.hasDetailViewIcon(this.options)&&(d="<td>",Utils.calculateObjectValue(null,this.options.detailFilter,[i,t])&&(d+=`\n          <a class="detail-icon" href="#">\n          ${Utils.sprintf(this.constants.html.icon,this.options.iconsPrefix,this.options.icons.detailOpen)}\n          </a>\n        `),d+="</td>"),d&&"right"!==this.options.detailViewAlign&&o.push(d),this.header.fields.forEach(((s,e)=>{const n=this.columns[e];let l="";const h=Utils.getItemField(t,s,this.options.escape,n.escape);let r="",d="",c={},p="",f=this.header.classes[e],g="",u="",b="",m="",$="",w="";if((!this.fromHtml&&!this.autoMergeCells||void 0!==h||n.checkbox||n.radio)&&n.visible&&(!this.options.cardView||n.cardVisible)){if(a.concat([this.header.styles[e]]).length&&(u+=`${a.concat([this.header.styles[e]]).join("; ")}`),t[`_${s}_style`]&&(u+=`${t[`_${s}_style`]}`),u&&(g=` style="${u}"`),t[`_${s}_id`]&&(p=Utils.sprintf(' id="%s"',t[`_${s}_id`])),t[`_${s}_class`]&&(f=Utils.sprintf(' class="%s"',t[`_${s}_class`])),t[`_${s}_rowspan`]&&(m=Utils.sprintf(' rowspan="%s"',t[`_${s}_rowspan`])),t[`_${s}_colspan`]&&($=Utils.sprintf(' colspan="%s"',t[`_${s}_colspan`])),t[`_${s}_title`]&&(w=Utils.sprintf(' title="%s"',t[`_${s}_title`])),c=Utils.calculateObjectValue(this.header,this.header.cellStyles[e],[h,t,i,s],c),c.classes&&(f=` class="${c.classes}"`),c.css){const t=[];for(const[i,s]of Object.entries(c.css))t.push(`${i}: ${s}`);g=` style="${t.concat(this.header.styles[e]).join("; ")}"`}if(r=Utils.calculateObjectValue(n,this.header.formatters[e],[h,t,i,s],h),n.checkbox||n.radio||(r=null==r?this.options.undefinedText:r),n.searchable&&this.searchText&&this.options.searchHighlight&&!n.checkbox&&!n.radio){let t="",i=this.searchText.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(this.options.searchAccentNeutralise){const t=new RegExp(`${Utils.normalizeAccent(i)}`,"gmi").exec(Utils.normalizeAccent(r));t&&(i=r.substring(t.index,t.index+i.length))}const s=new RegExp(`(${i})`,"gim"),e="<mark>$1</mark>";if(r&&/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i.test(r)){let i=(new DOMParser).parseFromString(r.toString(),"text/html").documentElement.textContent;const o=i.replace(s,e);i=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t=r.replace(new RegExp(`(>\\s*)(${i})(\\s*)`,"gm"),`$1${o}$3`)}else t=r.toString().replace(s,e);r=Utils.calculateObjectValue(n,n.searchHighlightFormatter,[r,this.searchText],t)}if(t[`_${s}_data`]&&!Utils.isEmptyObject(t[`_${s}_data`]))for(const[i,e]of Object.entries(t[`_${s}_data`])){if("index"===i)return;b+=` data-${i}="${e}"`}if(n.checkbox||n.radio){d=n.checkbox?"checkbox":d,d=n.radio?"radio":d;const s=n.class||"",o=Utils.isObject(r)&&r.hasOwnProperty("checked")?r.checked:(!0===r||h)&&!1!==r,a=!n.checkboxEnabled||r&&r.disabled;l=[this.options.cardView?`<div class="card-view ${s}">`:`<td class="bs-checkbox ${s}"${f}${g}>`,`<label>\n            <input\n            data-index="${i}"\n            name="${this.options.selectItemName}"\n            type="${d}"\n            ${Utils.sprintf('value="%s"',t[this.options.idField])}\n            ${Utils.sprintf('checked="%s"',o?"checked":void 0)}\n            ${Utils.sprintf('disabled="%s"',a?"disabled":void 0)} />\n            <span></span>\n            </label>`,this.header.formatters[e]&&"string"==typeof r?r:"",this.options.cardView?"</div>":"</td>"].join(""),t[this.header.stateField]=!0===r||!!h||r&&r.checked}else if(this.options.cardView){l=`<div class="card-view">${this.options.showHeader?`<span class="card-view-title ${c.classes||""}"${g}>${Utils.getFieldTitle(this.columns,s)}</span>`:""}<span class="card-view-value ${c.classes||""}"${g}>${r}</span></div>`,this.options.smartDisplay&&""===r&&(l='<div class="card-view"></div>')}else l=`<td${p}${f}${g}${b}${m}${$}${w}>${r}</td>`;o.push(l)}})),d&&"right"===this.options.detailViewAlign&&o.push(d),this.options.cardView&&o.push("</div></td>"),o.push("</tr>"),o.join("")}initBody(t,i){const s=this.getData();this.trigger("pre-body",s),this.$body=this.$el.find(">tbody"),this.$body.length||(this.$body=$("<tbody></tbody>").appendTo(this.$el)),this.options.pagination&&"server"!==this.options.sidePagination||(this.pageFrom=1,this.pageTo=s.length);const e=[],o=$(document.createDocumentFragment());let n=!1;const a=[];this.autoMergeCells=Utils.checkAutoMergeCells(s.slice(this.pageFrom-1,this.pageTo));for(let t=this.pageFrom-1;t<this.pageTo;t++){const l=s[t];let h=this.initRow(l,t,s,o);if(n=n||!!h,h&&"string"==typeof h){const s=this.options.uniqueId;if(s&&l.hasOwnProperty(s)){const e=l[s],o=this.$body.find(Utils.sprintf('> tr[data-uniqueid="%s"][data-has-detail-view]',e)).next();o.is("tr.detail-view")&&(a.push(t),i&&e===i||(h+=o[0].outerHTML))}this.options.virtualScroll?e.push(h):o.append(h)}}n?this.options.virtualScroll?(this.virtualScroll&&this.virtualScroll.destroy(),this.virtualScroll=new VirtualScroll({rows:e,fixedScroll:t,scrollEl:this.$tableBody[0],contentEl:this.$body[0],itemHeight:this.options.virtualScrollItemHeight,callback:(t,i)=>{this.fitHeader(),this.initBodyEvent(),this.trigger("virtual-scroll",t,i)}})):this.$body.html(o):this.$body.html(`<tr class="no-records-found">${Utils.sprintf('<td colspan="%s">%s</td>',this.getVisibleFields().length+Utils.getDetailViewIndexOffset(this.options),this.options.formatNoMatches())}</tr>`),a.forEach((t=>{this.expandRow(t)})),t||this.scrollTo(0),this.initBodyEvent(),this.initFooter(),this.resetView(),this.updateSelected(),"server"!==this.options.sidePagination&&(this.options.totalRows=s.length),this.trigger("post-body",s)}initBodyEvent(){this.$body.find("> tr[data-index] > td").off("click dblclick").on("click dblclick",(t=>{const i=$(t.currentTarget);if(i.find(".detail-icon").length||i.index()-Utils.getDetailViewIndexOffset(this.options)<0)return;const s=i.parent(),e=$(t.target).parents(".card-views").children(),o=$(t.target).parents(".card-view"),n=s.data("index"),a=this.data[n],l=this.options.cardView?e.index(o):i[0].cellIndex,h=this.getVisibleFields()[l-Utils.getDetailViewIndexOffset(this.options)],r=this.columns[this.fieldsColumnsIndex[h]],d=Utils.getItemField(a,h,this.options.escape,r.escape);if(this.trigger("click"===t.type?"click-cell":"dbl-click-cell",h,d,a,i),this.trigger("click"===t.type?"click-row":"dbl-click-row",a,s,h),"click"===t.type&&this.options.clickToSelect&&r.clickToSelect&&!Utils.calculateObjectValue(this.options,this.options.ignoreClickToSelectOn,[t.target])){const t=s.find(Utils.sprintf('[name="%s"]',this.options.selectItemName));t.length&&t[0].click()}"click"===t.type&&this.options.detailViewByClick&&this.toggleDetailView(n,this.header.detailFormatters[this.fieldsColumnsIndex[h]])})).off("mousedown").on("mousedown",(t=>{this.multipleSelectRowCtrlKey=t.ctrlKey||t.metaKey,this.multipleSelectRowShiftKey=t.shiftKey})),this.$body.find("> tr[data-index] > td > .detail-icon").off("click").on("click",(t=>(t.preventDefault(),this.toggleDetailView($(t.currentTarget).parent().parent().data("index")),!1))),this.$selectItem=this.$body.find(Utils.sprintf('[name="%s"]',this.options.selectItemName)),this.$selectItem.off("click").on("click",(t=>{t.stopImmediatePropagation();const i=$(t.currentTarget);this._toggleCheck(i.prop("checked"),i.data("index"))})),this.header.events.forEach(((t,i)=>{let s=t;if(!s)return;if("string"==typeof s&&(s=Utils.calculateObjectValue(null,s)),!s)throw new Error(`Unknown event in the scope: ${t}`);const e=this.header.fields[i];let o=this.getVisibleFields().indexOf(e);if(-1!==o){o+=Utils.getDetailViewIndexOffset(this.options);for(const t in s){if(!s.hasOwnProperty(t))continue;const i=s[t];this.$body.find(">tr:not(.no-records-found)").each(((s,n)=>{const a=$(n),l=a.find(this.options.cardView?".card-views>.card-view":">td").eq(o),h=t.indexOf(" "),r=t.substring(0,h),d=t.substring(h+1);l.find(d).off(r).on(r,(t=>{const s=a.data("index"),o=this.data[s],n=o[e];i.apply(this,[t,n,o,s])}))}))}}}))}initServer(t,i,s){let e={};const o=this.header.fields.indexOf(this.options.sortName);let n={searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};if(this.header.sortNames[o]&&(n.sortName=this.header.sortNames[o]),this.options.pagination&&"server"===this.options.sidePagination&&(n.pageSize=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,n.pageNumber=this.options.pageNumber),!s&&!this.options.url&&!this.options.ajax)return;if("limit"===this.options.queryParamsType&&(n={search:n.searchText,sort:n.sortName,order:n.sortOrder},this.options.pagination&&"server"===this.options.sidePagination&&(n.offset=this.options.pageSize===this.options.formatAllRows()?0:this.options.pageSize*(this.options.pageNumber-1),n.limit=this.options.pageSize,0!==n.limit&&this.options.pageSize!==this.options.formatAllRows()||delete n.limit)),this.options.search&&"server"===this.options.sidePagination&&this.options.searchable&&this.columns.filter((t=>t.searchable)).length){n.searchable=[];for(const t of this.columns)!t.checkbox&&t.searchable&&(this.options.visibleSearch&&t.visible||!this.options.visibleSearch)&&n.searchable.push(t.field)}if(Utils.isEmptyObject(this.filterColumnsPartial)||(n.filter=JSON.stringify(this.filterColumnsPartial,null)),Utils.extend(n,i||{}),e=Utils.calculateObjectValue(this.options,this.options.queryParams,[n],e),!1===e)return;t||this.showLoading();const a=Utils.extend({},Utils.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:s||this.options.url,data:"application/json"===this.options.contentType&&"post"===this.options.method?JSON.stringify(e):e,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:(i,s,e)=>{const o=Utils.calculateObjectValue(this.options,this.options.responseHandler,[i,e],i);"client"===this.options.sidePagination&&this.options.paginationLoadMore&&(this._paginationLoaded=this.data.length===o.length),this.load(o),this.trigger("load-success",o,e&&e.status,e),t||this.hideLoading(),"server"===this.options.sidePagination&&this.options.pageNumber>1&&o[this.options.totalField]>0&&!o[this.options.dataField].length&&this.updatePagination()},error:i=>{if(i&&0===i.status&&this._xhrAbort)return void(this._xhrAbort=!1);let s=[];"server"===this.options.sidePagination&&(s={},s[this.options.totalField]=0,s[this.options.dataField]=[]),this.load(s),this.trigger("load-error",i&&i.status,i),t||this.hideLoading()}});return this.options.ajax?Utils.calculateObjectValue(this,this.options.ajax,[a],null):(this._xhr&&4!==this._xhr.readyState&&(this._xhrAbort=!0,this._xhr.abort()),this._xhr=$.ajax(a)),e}initSearchText(){if(this.options.search&&(this.searchText="",""!==this.options.searchText)){const t=Utils.getSearchInput(this);t.val(this.options.searchText),this.onSearch({currentTarget:t,firedByInitSearchText:!0})}}getCaret(){this.$header.find("th").each(((t,i)=>{$(i).find(".sortable").removeClass("desc asc").addClass($(i).data("field")===this.options.sortName?this.options.sortOrder:"both")}))}updateSelected(){const t=this.$selectItem.filter(":enabled").length&&this.$selectItem.filter(":enabled").length===this.$selectItem.filter(":enabled").filter(":checked").length;this.$selectAll.add(this.$selectAll_).prop("checked",t),this.$selectItem.each(((t,i)=>{$(i).closest("tr")[$(i).prop("checked")?"addClass":"removeClass"]("selected")}))}updateRows(){this.$selectItem.each(((t,i)=>{this.data[$(i).data("index")][this.header.stateField]=$(i).prop("checked")}))}resetRows(){for(const t of this.data)this.$selectAll.prop("checked",!1),this.$selectItem.prop("checked",!1),this.header.stateField&&(t[this.header.stateField]=!1);this.initHiddenRows()}trigger(t,...i){const s=`${t}.bs.table`;this.options[BootstrapTable.EVENTS[s]](...i,this),this.$el.trigger($.Event(s,{sender:this}),i),this.options.onAll(s,...i,this),this.$el.trigger($.Event("all.bs.table",{sender:this}),[s,i])}resetHeader(){clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout((()=>this.fitHeader()),this.$el.is(":hidden")?100:0)}fitHeader(){if(this.$el.is(":hidden"))return void(this.timeoutId_=setTimeout((()=>this.fitHeader()),100));const t=this.$tableBody.get(0),i=this.hasScrollBar&&t.scrollHeight>t.clientHeight+this.$header.outerHeight()?Utils.getScrollBarWidth():0;this.$el.css("margin-top",-this.$header.outerHeight());const s=this.$tableHeader.find(":focus");if(s.length>0){const t=s.parents("th");if(t.length>0){const i=t.attr("data-field");if(void 0!==i){const t=this.$header.find(`[data-field='${i}']`);t.length>0&&t.find(":input").addClass("focus-temp")}}}this.$header_=this.$header.clone(!0,!0),this.$selectAll_=this.$header_.find('[name="btSelectAll"]'),this.$tableHeader.css("margin-right",i).find("table").css("width",this.$el.outerWidth()).html("").attr("class",this.$el.attr("class")).append(this.$header_),this.$tableLoading.css("width",this.$el.outerWidth());const e=$(".focus-temp:visible:eq(0)");e.length>0&&(e.focus(),this.$header.find(".focus-temp").removeClass("focus-temp")),this.$header.find("th[data-field]").each(((t,i)=>{this.$header_.find(Utils.sprintf('th[data-field="%s"]',$(i).data("field"))).data($(i).data())}));const o=this.getVisibleFields(),n=this.$header_.find("th");let a=this.$body.find(">tr:not(.no-records-found,.virtual-scroll-top)").eq(0);for(;a.length&&a.find('>td[colspan]:not([colspan="1"])').length;)a=a.next();const l=a.find("> *").length;a.find("> *").each(((t,i)=>{const s=$(i);if(Utils.hasDetailViewIcon(this.options)&&(0===t&&"right"!==this.options.detailViewAlign||t===l-1&&"right"===this.options.detailViewAlign)){const t=n.filter(".detail"),i=t.innerWidth()-t.find(".fht-cell").width();return void t.find(".fht-cell").width(s.innerWidth()-i)}const e=t-Utils.getDetailViewIndexOffset(this.options);let a=this.$header_.find(Utils.sprintf('th[data-field="%s"]',o[e]));a.length>1&&(a=$(n[s[0].cellIndex]));const h=a.innerWidth()-a.find(".fht-cell").width();a.find(".fht-cell").width(s.innerWidth()-h)})),this.horizontalScroll(),this.trigger("post-header")}initFooter(){if(!this.options.showFooter||this.options.cardView)return;const t=this.getData(),i=[];let s="";Utils.hasDetailViewIcon(this.options)&&(s='<th class="detail"><div class="th-inner"></div><div class="fht-cell"></div></th>'),s&&"right"!==this.options.detailViewAlign&&i.push(s);for(const s of this.columns){let e="",o="";const n=[];let a={},l=Utils.sprintf(' class="%s"',s.class);if(!s.visible||this.footerData&&this.footerData.length>0&&!(s.field in this.footerData[0]))continue;if(this.options.cardView&&!s.cardVisible)return;if(e=Utils.sprintf("text-align: %s; ",s.falign?s.falign:s.align),o=Utils.sprintf("vertical-align: %s; ",s.valign),a=Utils.calculateObjectValue(null,s.footerStyle||this.options.footerStyle,[s]),a&&a.css)for(const[t,i]of Object.entries(a.css))n.push(`${t}: ${i}`);a&&a.classes&&(l=Utils.sprintf(' class="%s"',s.class?[s.class,a.classes].join(" "):a.classes)),i.push("<th",l,Utils.sprintf(' style="%s"',e+o+n.concat().join("; ")||void 0));let h=0;this.footerData&&this.footerData.length>0&&(h=this.footerData[0][`_${s.field}_colspan`]||0),h&&i.push(` colspan="${h}" `),i.push(">"),i.push('<div class="th-inner">');let r="";this.footerData&&this.footerData.length>0&&(r=this.footerData[0][s.field]||""),i.push(Utils.calculateObjectValue(s,s.footerFormatter,[t,r],r)),i.push("</div>"),i.push('<div class="fht-cell"></div>'),i.push("</div>"),i.push("</th>")}s&&"right"===this.options.detailViewAlign&&i.push(s),this.options.height||this.$tableFooter.length||(this.$el.append("<tfoot><tr></tr></tfoot>"),this.$tableFooter=this.$el.find("tfoot")),this.$tableFooter.find("tr").length||this.$tableFooter.html("<table><thead><tr></tr></thead></table>"),this.$tableFooter.find("tr").html(i.join("")),this.trigger("post-footer",this.$tableFooter)}fitFooter(){if(this.$el.is(":hidden"))return void setTimeout((()=>this.fitFooter()),100);const t=this.$tableBody.get(0),i=this.hasScrollBar&&t.scrollHeight>t.clientHeight+this.$header.outerHeight()?Utils.getScrollBarWidth():0;this.$tableFooter.css("margin-right",i).find("table").css("width",this.$el.outerWidth()).attr("class",this.$el.attr("class"));const s=this.$tableFooter.find("th");let e=this.$body.find(">tr:first-child:not(.no-records-found)");for(s.find(".fht-cell").width("auto");e.length&&e.find('>td[colspan]:not([colspan="1"])').length;)e=e.next();const o=e.find("> *").length;e.find("> *").each(((t,i)=>{const e=$(i);if(Utils.hasDetailViewIcon(this.options)&&(0===t&&"left"===this.options.detailViewAlign||t===o-1&&"right"===this.options.detailViewAlign)){const t=s.filter(".detail"),i=t.innerWidth()-t.find(".fht-cell").width();return void t.find(".fht-cell").width(e.innerWidth()-i)}const n=s.eq(t),a=n.innerWidth()-n.find(".fht-cell").width();n.find(".fht-cell").width(e.innerWidth()-a)})),this.horizontalScroll()}horizontalScroll(){this.$tableBody.off("scroll").on("scroll",(()=>{const t=this.$tableBody.scrollLeft();this.options.showHeader&&this.options.height&&this.$tableHeader.scrollLeft(t),this.options.showFooter&&!this.options.cardView&&this.$tableFooter.scrollLeft(t),this.trigger("scroll-body",this.$tableBody)}))}getVisibleFields(){const t=[];for(const i of this.header.fields){const s=this.columns[this.fieldsColumnsIndex[i]];s&&s.visible&&(!this.options.cardView||s.cardVisible)&&t.push(i)}return t}initHiddenRows(){this.hiddenRows=[]}getOptions(){const t=Utils.extend({},this.options);return delete t.data,Utils.extend(!0,{},t)}refreshOptions(t){Utils.compareObjects(this.options,t,!0)||(this.options=Utils.extend(this.options,t),this.trigger("refresh-options",this.options),this.destroy(),this.init())}getData(t){let i=this.options.data;if(!(this.searchText||this.options.customSearch||void 0!==this.options.sortName||this.enableCustomSort)&&Utils.isEmptyObject(this.filterColumns)&&"function"!=typeof this.options.filterOptions.filterAlgorithm&&Utils.isEmptyObject(this.filterColumnsPartial)||t&&t.unfiltered||(i=this.data),t&&!t.includeHiddenRows){const t=this.getHiddenRows();i=i.filter((i=>-1===Utils.findIndex(t,i)))}return t&&t.useCurrentPage&&(i=i.slice(this.pageFrom-1,this.pageTo)),t&&t.formatted&&i.forEach((t=>{for(const[i,s]of Object.entries(t)){const e=this.columns[this.fieldsColumnsIndex[i]];if(!e)return;t[i]=Utils.calculateObjectValue(e,this.header.formatters[e.fieldIndex],[s,t,t.index,e.field],s)}})),i}getSelections(){return(this.options.maintainMetaData?this.options.data:this.data).filter((t=>!0===t[this.header.stateField]))}load(t){let i=!1,s=t;this.options.pagination&&"server"===this.options.sidePagination&&(this.options.totalRows=s[this.options.totalField],this.options.totalNotFiltered=s[this.options.totalNotFilteredField],this.footerData=s[this.options.footerField]?[s[this.options.footerField]]:void 0),i=this.options.fixedScroll||s.fixedScroll,s=Array.isArray(s)?s:s[this.options.dataField],this.initData(s),this.initSearch(),this.initPagination(),this.initBody(i)}append(t){this.initData(t,"append"),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}prepend(t){this.initData(t,"prepend"),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}remove(t){let i=0;for(let s=this.options.data.length-1;s>=0;s--){const e=this.options.data[s],o=Utils.getItemField(e,t.field,this.options.escape,e.escape);void 0===o&&"$index"!==t.field||(!e.hasOwnProperty(t.field)&&"$index"===t.field&&t.values.includes(s)||t.values.includes(o))&&(i++,this.options.data.splice(s,1))}i&&("server"===this.options.sidePagination&&(this.options.totalRows-=i,this.data=[...this.options.data]),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0))}removeAll(){this.options.data.length>0&&(this.options.data.splice(0,this.options.data.length),this.initSearch(),this.initPagination(),this.initBody(!0))}insertRow(t){t.hasOwnProperty("index")&&t.hasOwnProperty("row")&&(this.options.data.splice(t.index,0,t.row),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0))}updateRow(t){const i=Array.isArray(t)?t:[t];for(const t of i)t.hasOwnProperty("index")&&t.hasOwnProperty("row")&&(t.hasOwnProperty("replace")&&t.replace?this.options.data[t.index]=t.row:Utils.extend(this.options.data[t.index],t.row));this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}getRowByUniqueId(t){const i=this.options.uniqueId;let s,e,o=t,n=null;for(s=this.options.data.length-1;s>=0;s--){e=this.options.data[s];const a=Utils.getItemField(e,i,this.options.escape,e.escape);if(void 0!==a&&("string"==typeof a?o=t.toString():"number"==typeof a&&(Number(a)===a&&a%1==0?o=parseInt(t,10):a===Number(a)&&0!==a&&(o=parseFloat(t))),a===o)){n=e;break}}return n}updateByUniqueId(t){const i=Array.isArray(t)?t:[t];let s=null;for(const t of i){if(!t.hasOwnProperty("id")||!t.hasOwnProperty("row"))continue;const i=this.options.data.indexOf(this.getRowByUniqueId(t.id));-1!==i&&(t.hasOwnProperty("replace")&&t.replace?this.options.data[i]=t.row:Utils.extend(this.options.data[i],t.row),s=t.id)}this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0,s)}removeByUniqueId(t){const i=this.options.data.length,s=this.getRowByUniqueId(t);s&&this.options.data.splice(this.options.data.indexOf(s),1),i!==this.options.data.length&&("server"===this.options.sidePagination&&(this.options.totalRows-=1,this.data=[...this.options.data]),this.initSearch(),this.initPagination(),this.initBody(!0))}_updateCellOnly(t,i){const s=this.initRow(this.options.data[i],i);let e=this.getVisibleFields().indexOf(t);-1!==e&&(e+=Utils.getDetailViewIndexOffset(this.options),this.$body.find(`>tr[data-index=${i}]`).find(`>td:eq(${e})`).replaceWith($(s).find(`>td:eq(${e})`)),this.initBodyEvent(),this.initFooter(),this.resetView(),this.updateSelected())}updateCell(t){t.hasOwnProperty("index")&&t.hasOwnProperty("field")&&t.hasOwnProperty("value")&&(this.options.data[t.index][t.field]=t.value,!1!==t.reinit?(this.initSort(),this.initBody(!0)):this._updateCellOnly(t.field,t.index))}updateCellByUniqueId(t){(Array.isArray(t)?t:[t]).forEach((({id:t,field:i,value:s})=>{const e=this.options.data.indexOf(this.getRowByUniqueId(t));-1!==e&&(this.options.data[e][i]=s)})),!1!==t.reinit?(this.initSort(),this.initBody(!0)):this._updateCellOnly(t.field,this.options.data.indexOf(this.getRowByUniqueId(t.id)))}showRow(t){this._toggleRow(t,!0)}hideRow(t){this._toggleRow(t,!1)}_toggleRow(t,i){let s;if(t.hasOwnProperty("index")?s=this.getData()[t.index]:t.hasOwnProperty("uniqueId")&&(s=this.getRowByUniqueId(t.uniqueId)),!s)return;const e=Utils.findIndex(this.hiddenRows,s);i||-1!==e?i&&e>-1&&this.hiddenRows.splice(e,1):this.hiddenRows.push(s),this.initBody(!0),this.initPagination()}getHiddenRows(t){if(t)return this.initHiddenRows(),this.initBody(!0),void this.initPagination();const i=this.getData(),s=[];for(const t of i)this.hiddenRows.includes(t)&&s.push(t);return this.hiddenRows=s,s}showColumn(t){(Array.isArray(t)?t:[t]).forEach((t=>{this._toggleColumn(this.fieldsColumnsIndex[t],!0,!0)}))}hideColumn(t){(Array.isArray(t)?t:[t]).forEach((t=>{this._toggleColumn(this.fieldsColumnsIndex[t],!1,!0)}))}_toggleColumn(t,i,s){if(-1!==t&&this.columns[t].visible!==i&&(this.columns[t].visible=i,this.initHeader(),this.initSearch(),this.initPagination(),this.initBody(),this.options.showColumns)){const e=this.$toolbar.find('.keep-open input:not(".toggle-all")').prop("disabled",!1);s&&e.filter(Utils.sprintf('[value="%s"]',t)).prop("checked",i),e.filter(":checked").length<=this.options.minimumCountColumns&&e.filter(":checked").prop("disabled",!0)}}getVisibleColumns(){return this.columns.filter((t=>t.visible&&!this.isSelectionColumn(t)))}getHiddenColumns(){return this.columns.filter((({visible:t})=>!t))}isSelectionColumn(t){return t.radio||t.checkbox}showAllColumns(){this._toggleAllColumns(!0)}hideAllColumns(){this._toggleAllColumns(!1)}_toggleAllColumns(t){for(const i of this.columns.slice().reverse())if(i.switchable){if(!t&&this.options.showColumns&&this.getVisibleColumns().filter((t=>t.switchable)).length===this.options.minimumCountColumns)continue;i.visible=t}if(this.initHeader(),this.initSearch(),this.initPagination(),this.initBody(),this.options.showColumns){const i=this.$toolbar.find('.keep-open input[type="checkbox"]:not(".toggle-all")').prop("disabled",!1);t?i.prop("checked",t):i.get().reverse().forEach((s=>{i.filter(":checked").length>this.options.minimumCountColumns&&$(s).prop("checked",t)})),i.filter(":checked").length<=this.options.minimumCountColumns&&i.filter(":checked").prop("disabled",!0)}}mergeCells(t){const i=t.index;let s=this.getVisibleFields().indexOf(t.field);const e=t.rowspan||1,o=t.colspan||1;let n,a;const l=this.$body.find(">tr[data-index]");s+=Utils.getDetailViewIndexOffset(this.options);const h=l.eq(i).find(">td").eq(s);if(!(i<0||s<0||i>=this.data.length)){for(n=i;n<i+e;n++)for(a=s;a<s+o;a++)l.eq(n).find(">td").eq(a).hide();h.attr("rowspan",e).attr("colspan",o).show()}}checkAll(){this._toggleCheckAll(!0)}uncheckAll(){this._toggleCheckAll(!1)}_toggleCheckAll(t){const i=this.getSelections();this.$selectAll.add(this.$selectAll_).prop("checked",t),this.$selectItem.filter(":enabled").prop("checked",t),this.updateRows(),this.updateSelected();const s=this.getSelections();t?this.trigger("check-all",s,i):this.trigger("uncheck-all",s,i)}checkInvert(){const t=this.$selectItem.filter(":enabled");let i=t.filter(":checked");t.each(((t,i)=>{$(i).prop("checked",!$(i).prop("checked"))})),this.updateRows(),this.updateSelected(),this.trigger("uncheck-some",i),i=this.getSelections(),this.trigger("check-some",i)}check(t){this._toggleCheck(!0,t)}uncheck(t){this._toggleCheck(!1,t)}_toggleCheck(t,i){const s=this.$selectItem.filter(`[data-index="${i}"]`),e=this.data[i];if(s.is(":radio")||this.options.singleSelect||this.options.multipleSelectRow&&!this.multipleSelectRowCtrlKey&&!this.multipleSelectRowShiftKey){for(const t of this.options.data)t[this.header.stateField]=!1;this.$selectItem.filter(":checked").not(s).prop("checked",!1)}if(e[this.header.stateField]=t,this.options.multipleSelectRow){if(this.multipleSelectRowShiftKey&&this.multipleSelectRowLastSelectedIndex>=0){const[t,s]=this.multipleSelectRowLastSelectedIndex<i?[this.multipleSelectRowLastSelectedIndex,i]:[i,this.multipleSelectRowLastSelectedIndex];for(let i=t+1;i<s;i++)this.data[i][this.header.stateField]=!0,this.$selectItem.filter(`[data-index="${i}"]`).prop("checked",!0)}this.multipleSelectRowCtrlKey=!1,this.multipleSelectRowShiftKey=!1,this.multipleSelectRowLastSelectedIndex=t?i:-1}s.prop("checked",t),this.updateSelected(),this.trigger(t?"check":"uncheck",this.data[i],s)}checkBy(t){this._toggleCheckBy(!0,t)}uncheckBy(t){this._toggleCheckBy(!1,t)}_toggleCheckBy(t,i){if(!i.hasOwnProperty("field")||!i.hasOwnProperty("values"))return;const s=[];this.data.forEach(((e,o)=>{if(!e.hasOwnProperty(i.field))return!1;if(i.values.includes(e[i.field])){let n=this.$selectItem.filter(":enabled").filter(Utils.sprintf('[data-index="%s"]',o));const a=!!i.hasOwnProperty("onlyCurrentPage")&&i.onlyCurrentPage;if(n=t?n.not(":checked"):n.filter(":checked"),!n.length&&a)return;n.prop("checked",t),e[this.header.stateField]=t,s.push(e),this.trigger(t?"check":"uncheck",e,n)}})),this.updateSelected(),this.trigger(t?"check-some":"uncheck-some",s)}refresh(t){t&&t.url&&(this.options.url=t.url),t&&t.pageNumber&&(this.options.pageNumber=t.pageNumber),t&&t.pageSize&&(this.options.pageSize=t.pageSize),this.trigger("refresh",this.initServer(t&&t.silent,t&&t.query,t&&t.url))}destroy(){this.$el.insertBefore(this.$container),$(this.options.toolbar).insertBefore(this.$el),this.$container.next().remove(),this.$container.remove(),this.$el.html(this.$el_.html()).css("margin-top","0").attr("class",this.$el_.attr("class")||"");const t=Utils.getEventName("resize.bootstrap-table",this.$el.attr("id"));$(window).off(t)}resetView(t){let i=0;if(t&&t.height&&(this.options.height=t.height),this.$tableContainer.toggleClass("has-card-view",this.options.cardView),this.options.height){const t=this.$tableBody.get(0);this.hasScrollBar=t.scrollWidth>t.clientWidth}if(!this.options.cardView&&this.options.showHeader&&this.options.height?(this.$tableHeader.show(),this.resetHeader(),i+=this.$header.outerHeight(!0)+1):(this.$tableHeader.hide(),this.trigger("post-header")),!this.options.cardView&&this.options.showFooter&&(this.$tableFooter.show(),this.fitFooter(),this.options.height&&(i+=this.$tableFooter.outerHeight(!0))),this.$container.hasClass("fullscreen"))this.$tableContainer.css("height",""),this.$tableContainer.css("width","");else if(this.options.height){this.$tableBorder&&(this.$tableBorder.css("width",""),this.$tableBorder.css("height",""));const t=this.$toolbar.outerHeight(!0),i=this.$pagination.outerHeight(!0),s=this.options.height-t-i,e=this.$tableBody.find(">table"),o=e.outerHeight();if(this.$tableContainer.css("height",`${s}px`),this.$tableBorder&&e.is(":visible")){let t=s-o-2;this.hasScrollBar&&(t-=Utils.getScrollBarWidth()),this.$tableBorder.css("width",`${e.outerWidth()}px`),this.$tableBorder.css("height",`${t}px`)}}this.options.cardView?(this.$el.css("margin-top","0"),this.$tableContainer.css("padding-bottom","0"),this.$tableFooter.hide()):(this.getCaret(),this.$tableContainer.css("padding-bottom",`${i}px`)),this.trigger("reset-view")}showLoading(){this.$tableLoading.toggleClass("open",!0);let t=this.options.loadingFontSize;"auto"===this.options.loadingFontSize&&(t=.04*this.$tableLoading.width(),t=Math.max(12,t),t=Math.min(32,t),t=`${t}px`),this.$tableLoading.find(".loading-text").css("font-size",t)}hideLoading(){this.$tableLoading.toggleClass("open",!1)}togglePagination(){this.options.pagination=!this.options.pagination;const t=this.options.showButtonIcons?this.options.pagination?this.options.icons.paginationSwitchDown:this.options.icons.paginationSwitchUp:"",i=this.options.showButtonText?this.options.pagination?this.options.formatPaginationSwitchUp():this.options.formatPaginationSwitchDown():"";this.$toolbar.find('button[name="paginationSwitch"]').html(`${Utils.sprintf(this.constants.html.icon,this.options.iconsPrefix,t)} ${i}`),this.updatePagination(),this.trigger("toggle-pagination",this.options.pagination)}toggleFullscreen(){this.$el.closest(".bootstrap-table").toggleClass("fullscreen"),this.resetView()}toggleView(){this.options.cardView=!this.options.cardView,this.initHeader();const t=this.options.showButtonIcons?this.options.cardView?this.options.icons.toggleOn:this.options.icons.toggleOff:"",i=this.options.showButtonText?this.options.cardView?this.options.formatToggleOff():this.options.formatToggleOn():"";this.$toolbar.find('button[name="toggle"]').html(`${Utils.sprintf(this.constants.html.icon,this.options.iconsPrefix,t)} ${i}`).attr("aria-label",i).attr("title",i),this.initBody(),this.trigger("toggle",this.options.cardView)}resetSearch(t){const i=Utils.getSearchInput(this),s=t||"";i.val(s),this.searchText=s,this.onSearch({currentTarget:i},!1)}filterBy(t,i){this.filterOptions=Utils.isEmptyObject(i)?this.options.filterOptions:Utils.extend(this.options.filterOptions,i),this.filterColumns=Utils.isEmptyObject(t)?{}:t,this.options.pageNumber=1,this.initSearch(),this.updatePagination()}scrollTo(t){let i={unit:"px",value:0};"object"==typeof t?i=Object.assign(i,t):"string"==typeof t&&"bottom"===t?i.value=this.$tableBody[0].scrollHeight:"string"!=typeof t&&"number"!=typeof t||(i.value=t);let s=i.value;"rows"===i.unit&&(s=0,this.$body.find(`> tr:lt(${i.value})`).each(((t,i)=>{s+=$(i).outerHeight(!0)}))),this.$tableBody.scrollTop(s)}getScrollPosition(){return this.$tableBody.scrollTop()}selectPage(t){t>0&&t<=this.options.totalPages&&(this.options.pageNumber=t,this.updatePagination())}prevPage(){this.options.pageNumber>1&&(this.options.pageNumber--,this.updatePagination())}nextPage(){this.options.pageNumber<this.options.totalPages&&(this.options.pageNumber++,this.updatePagination())}toggleDetailView(t,i){this.$body.find(Utils.sprintf('> tr[data-index="%s"]',t)).next().is("tr.detail-view")?this.collapseRow(t):this.expandRow(t,i),this.resetView()}expandRow(t,i){const s=this.data[t],e=this.$body.find(Utils.sprintf('> tr[data-index="%s"][data-has-detail-view]',t));if(this.options.detailViewIcon&&e.find("a.detail-icon").html(Utils.sprintf(this.constants.html.icon,this.options.iconsPrefix,this.options.icons.detailClose)),e.next().is("tr.detail-view"))return;e.after(Utils.sprintf('<tr class="detail-view"><td colspan="%s"></td></tr>',e.children("td").length));const o=e.next().find("td"),n=i||this.options.detailFormatter,a=Utils.calculateObjectValue(this.options,n,[t,s,o],"");1===o.length&&o.append(a),this.trigger("expand-row",t,s,o)}expandRowByUniqueId(t){const i=this.getRowByUniqueId(t);i&&this.expandRow(this.data.indexOf(i))}collapseRow(t){const i=this.data[t],s=this.$body.find(Utils.sprintf('> tr[data-index="%s"][data-has-detail-view]',t));s.next().is("tr.detail-view")&&(this.options.detailViewIcon&&s.find("a.detail-icon").html(Utils.sprintf(this.constants.html.icon,this.options.iconsPrefix,this.options.icons.detailOpen)),this.trigger("collapse-row",t,i,s.next()),s.next().remove())}collapseRowByUniqueId(t){const i=this.getRowByUniqueId(t);i&&this.collapseRow(this.data.indexOf(i))}expandAllRows(){const t=this.$body.find("> tr[data-index][data-has-detail-view]");for(let i=0;i<t.length;i++)this.expandRow($(t[i]).data("index"))}collapseAllRows(){const t=this.$body.find("> tr[data-index][data-has-detail-view]");for(let i=0;i<t.length;i++)this.collapseRow($(t[i]).data("index"))}updateColumnTitle(t){t.hasOwnProperty("field")&&t.hasOwnProperty("title")&&(this.columns[this.fieldsColumnsIndex[t.field]].title=this.options.escape&&this.options.escapeTitle?Utils.escapeHTML(t.title):t.title,this.columns[this.fieldsColumnsIndex[t.field]].visible&&(this.$header.find("th[data-field]").each(((i,s)=>{if($(s).data("field")===t.field)return $($(s).find(".th-inner")[0]).html(t.title),!1})),this.resetView()))}updateFormatText(t,i){/^format/.test(t)&&this.options[t]&&("string"==typeof i?this.options[t]=()=>i:"function"==typeof i&&(this.options[t]=i),this.initToolbar(),this.initPagination(),this.initBody())}}BootstrapTable.VERSION=Constants.VERSION,BootstrapTable.DEFAULTS=Constants.DEFAULTS,BootstrapTable.LOCALES=Constants.LOCALES,BootstrapTable.COLUMN_DEFAULTS=Constants.COLUMN_DEFAULTS,BootstrapTable.METHODS=Constants.METHODS,BootstrapTable.EVENTS=Constants.EVENTS,$.BootstrapTable=BootstrapTable,$.fn.bootstrapTable=function(t,...i){let s;return this.each(((e,o)=>{let n=$(o).data("bootstrap.table");if("string"==typeof t){if(!Constants.METHODS.includes(t))throw new Error(`Unknown method: ${t}`);if(!n)return;return s=n[t](...i),void("destroy"===t&&$(o).removeData("bootstrap.table"))}if(n)return void console.warn("You cannot initialize the table more than once!");const a=Utils.extend(!0,{},BootstrapTable.DEFAULTS,$(o).data(),"object"==typeof t&&t);n=new $.BootstrapTable(o,a),$(o).data("bootstrap.table",n),n.init()})),void 0===s?this:s},$.fn.bootstrapTable.Constructor=BootstrapTable,$.fn.bootstrapTable.theme=Constants.THEME,$.fn.bootstrapTable.VERSION=Constants.VERSION,$.fn.bootstrapTable.defaults=BootstrapTable.DEFAULTS,$.fn.bootstrapTable.columnDefaults=BootstrapTable.COLUMN_DEFAULTS,$.fn.bootstrapTable.events=BootstrapTable.EVENTS,$.fn.bootstrapTable.locales=BootstrapTable.LOCALES,$.fn.bootstrapTable.methods=BootstrapTable.METHODS,$.fn.bootstrapTable.utils=Utils,$((()=>{$('[data-toggle="table"]').bootstrapTable()}));export default BootstrapTable;