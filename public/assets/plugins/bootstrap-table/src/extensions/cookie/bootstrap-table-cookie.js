const Utils=$.fn.bootstrapTable.utils,UtilsCookie={cookieIds:{sortOrder:"bs.table.sortOrder",sortName:"bs.table.sortName",sortPriority:"bs.table.sortPriority",pageNumber:"bs.table.pageNumber",pageList:"bs.table.pageList",hiddenColumns:"bs.table.hiddenColumns",cardView:"bs.table.cardView",customView:"bs.table.customView",searchText:"bs.table.searchText",reorderColumns:"bs.table.reorderColumns",filterControl:"bs.table.filterControl",filterBy:"bs.table.filterBy"},getCurrentHeader:o=>o.options.height?o.$tableHeader:o.$header,getCurrentSearchControls:o=>o.options.height?"table select, table input":"select, input",isCookieSupportedByBrowser:()=>navigator.cookieEnabled,isCookieEnabled:(o,e)=>o.options.cookiesEnabled.includes(e),setCookie(o,e,t){if(o.options.cookie&&UtilsCookie.isCookieEnabled(o,e))return o._storage.setItem(`${o.options.cookieIdTable}.${e}`,t)},getCookie:(o,e)=>e&&UtilsCookie.isCookieEnabled(o,e)?o._storage.getItem(`${o.options.cookieIdTable}.${e}`):null,deleteCookie:(o,e)=>o._storage.removeItem(`${o.options.cookieIdTable}.${e}`),calculateExpiration(o){const e=o.replace(/[0-9]*/,"");switch(o=o.replace(/[A-Za-z]{1,2}/,""),e.toLowerCase()){case"s":o=+o;break;case"mi":o*=60;break;case"h":o=60*o*60;break;case"d":o=24*o*60*60;break;case"m":o=30*o*24*60*60;break;case"y":o=365*o*24*60*60;break;default:o=void 0}if(!o)return"";const t=new Date;return t.setTime(t.getTime()+1e3*o),t.toGMTString()},initCookieFilters(o){setTimeout((()=>{const e=JSON.parse(UtilsCookie.getCookie(o,UtilsCookie.cookieIds.filterControl));if(!o._filterControlValuesLoaded&&e){const t={},i=UtilsCookie.getCurrentHeader(o),s=UtilsCookie.getCurrentSearchControls(o),r=(e,i)=>{i.forEach((i=>{const s=e.value.toString(),r=i.text;if(""!==r&&("radio"!==e.type||s===r))if("INPUT"===e.tagName&&"radio"===e.type&&s===r)e.checked=!0,t[i.field]=r;else if("INPUT"===e.tagName)e.value=r,t[i.field]=r;else if("SELECT"===e.tagName&&o.options.filterControlContainer)e.value=r,t[i.field]=r;else if(""!==r&&"SELECT"===e.tagName){t[i.field]=r;for(const o of e)if(o.value===r)return void(o.selected=!0);const o=document.createElement("option");o.value=r,o.text=r,e.add(o,e[1]),e.selectedIndex=1}}))};let l=i;o.options.filterControlContainer&&(l=$(`${o.options.filterControlContainer}`)),l.find(s).each((function(){const o=$(this).closest("[data-field]").data("field"),t=e.filter((e=>e.field===o));r(this,t)})),o.initColumnSearch(t),o._filterControlValuesLoaded=!0,o.initServer()}}),250)}};Object.assign($.fn.bootstrapTable.defaults,{cookie:!1,cookieExpire:"2h",cookiePath:null,cookieDomain:null,cookieSecure:null,cookieSameSite:"Lax",cookieIdTable:"",cookiesEnabled:["bs.table.sortOrder","bs.table.sortName","bs.table.sortPriority","bs.table.pageNumber","bs.table.pageList","bs.table.hiddenColumns","bs.table.searchText","bs.table.filterControl","bs.table.filterBy","bs.table.reorderColumns","bs.table.cardView","bs.table.customView"],cookieStorage:"cookieStorage",cookieCustomStorageGet:null,cookieCustomStorageSet:null,cookieCustomStorageDelete:null,_filterControls:[],_filterControlValuesLoaded:!1,_storage:{setItem:void 0,getItem:void 0,removeItem:void 0}}),$.fn.bootstrapTable.methods.push("getCookies"),$.fn.bootstrapTable.methods.push("deleteCookie"),Object.assign($.fn.bootstrapTable.utils,{setCookie:UtilsCookie.setCookie,getCookie:UtilsCookie.getCookie}),$.BootstrapTable=class extends $.BootstrapTable{init(){if(this.options.cookie){if("cookieStorage"===this.options.cookieStorage&&!UtilsCookie.isCookieSupportedByBrowser())throw new Error("Cookies are not enabled in this browser.");this.configureStorage();const o=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.filterBy);if("boolean"==typeof o&&!o)throw new Error("The cookie value of filterBy must be a json!");let e={};try{e=JSON.parse(o)}catch(o){throw new Error("Could not parse the json of the filterBy cookie!")}if(this.filterColumns=e||{},this._filterControls=[],this._filterControlValuesLoaded=!1,this.options.cookiesEnabled="string"==typeof this.options.cookiesEnabled?this.options.cookiesEnabled.replace("[","").replace("]","").replace(/'/g,"").replace(/ /g,"").split(","):this.options.cookiesEnabled,this.options.filterControl){const o=this;this.$el.on("column-search.bs.table",((e,t,i)=>{let s=!0;for(let e=0;e<o._filterControls.length;e++)if(o._filterControls[e].field===t){o._filterControls[e].text=i,s=!1;break}s&&o._filterControls.push({field:t,text:i}),UtilsCookie.setCookie(o,UtilsCookie.cookieIds.filterControl,JSON.stringify(o._filterControls))})).on("created-controls.bs.table",UtilsCookie.initCookieFilters(o))}}super.init()}initServer(...o){if(this.options.cookie&&this.options.filterControl&&!this._filterControlValuesLoaded){if(JSON.parse(UtilsCookie.getCookie(this,UtilsCookie.cookieIds.filterControl)))return}super.initServer(...o)}initTable(...o){super.initTable(...o),this.initCookie()}onSort(...o){super.onSort(...o),this.options.cookie&&(void 0===this.options.sortName||void 0===this.options.sortOrder?(UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds.sortName),UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds.sortOrder)):(this.options.sortPriority=null,UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds.sortPriority),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.sortOrder,this.options.sortOrder),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.sortName,this.options.sortName)))}onMultipleSort(...o){super.onMultipleSort(...o),this.options.cookie&&(void 0===this.options.sortPriority?UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds.sortPriority):(this.options.sortName=void 0,this.options.sortOrder=void 0,UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds.sortName),UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds.sortOrder),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.sortPriority,JSON.stringify(this.options.sortPriority))))}onPageNumber(...o){super.onPageNumber(...o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageNumber,this.options.pageNumber)}onPageListChange(...o){super.onPageListChange(...o),this.options.cookie&&(UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageList,this.options.pageSize===this.options.formatAllRows()?"all":this.options.pageSize),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageNumber,this.options.pageNumber))}onPagePre(...o){super.onPagePre(...o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageNumber,this.options.pageNumber)}onPageNext(...o){super.onPageNext(...o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageNumber,this.options.pageNumber)}_toggleColumn(...o){super._toggleColumn(...o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.hiddenColumns,JSON.stringify(this.getHiddenColumns().map((o=>o.field))))}_toggleAllColumns(...o){super._toggleAllColumns(...o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.hiddenColumns,JSON.stringify(this.getHiddenColumns().map((o=>o.field))))}toggleView(){super.toggleView(),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.cardView,this.options.cardView)}toggleCustomView(){super.toggleCustomView(),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.customView,this.customViewDefaultView)}selectPage(o){super.selectPage(o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageNumber,o)}onSearch(o){super.onSearch(o,!(arguments.length>1)||arguments[1]),this.options.cookie&&(this.options.search&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.searchText,this.searchText),UtilsCookie.setCookie(this,UtilsCookie.cookieIds.pageNumber,this.options.pageNumber))}initHeader(...o){this.options.reorderableColumns&&this.options.cookie&&(this.columnsSortOrder=JSON.parse(UtilsCookie.getCookie(this,UtilsCookie.cookieIds.reorderColumns))),super.initHeader(...o)}persistReorderColumnsState(o){UtilsCookie.setCookie(o,UtilsCookie.cookieIds.reorderColumns,JSON.stringify(o.columnsSortOrder))}filterBy(...o){super.filterBy(...o),this.options.cookie&&UtilsCookie.setCookie(this,UtilsCookie.cookieIds.filterBy,JSON.stringify(this.filterColumns))}initCookie(){if(!this.options.cookie)return;if(""===this.options.cookieIdTable||""===this.options.cookieExpire)return console.error("Configuration error. Please review the cookieIdTable and the cookieExpire property. If the properties are correct, then this browser does not support cookies."),void(this.options.cookie=!1);const o=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.sortOrder),e=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.sortName);let t=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.sortPriority);const i=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.pageNumber),s=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.pageList),r=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.searchText),l=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.cardView),n=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.customView),a=UtilsCookie.getCookie(this,UtilsCookie.cookieIds.hiddenColumns);let k={};try{k=JSON.parse(a)}catch(o){throw new Error("Could not parse the json of the hidden columns cookie!",a)}try{t=JSON.parse(t)}catch(o){throw new Error("Could not parse the json of the sortPriority cookie!",t)}if(t?(this.options.sortOrder=void 0,this.options.sortName=void 0):(this.options.sortOrder=o||this.options.sortOrder,this.options.sortName=e||this.options.sortName),this.options.sortPriority=t||this.options.sortPriority,(this.options.sortOrder||this.options.sortName)&&(this.options.sortPriority=null),this.options.pageNumber=i?+i:this.options.pageNumber,this.options.pageSize=s?"all"===s?this.options.formatAllRows():+s:this.options.pageSize,UtilsCookie.isCookieEnabled(this,UtilsCookie.cookieIds.searchText)&&""===this.options.searchText&&(this.options.searchText=r||""),null!==l&&(this.options.cardView="true"===l&&l),this.customViewDefaultView="true"===n,k)for(const o of this.columns)o.switchable&&(o.visible=this.isSelectionColumn(o)||!k.includes(o.field))}getCookies(){const o=this,e={};for(const[t,i]of Object.entries(UtilsCookie.cookieIds))e[t]=UtilsCookie.getCookie(o,i),"columns"!==t&&"hiddenColumns"!==t&&"sortPriority"!==t||(e[t]=JSON.parse(e[t]));return e}deleteCookie(o){o&&UtilsCookie.deleteCookie(this,UtilsCookie.cookieIds[o])}configureStorage(){const o=this;switch(this._storage={},this.options.cookieStorage){case"cookieStorage":this._storage.setItem=function(e,t){document.cookie=[e,"=",encodeURIComponent(t),`; expires=${UtilsCookie.calculateExpiration(o.options.cookieExpire)}`,o.options.cookiePath?`; path=${o.options.cookiePath}`:"",o.options.cookieDomain?`; domain=${o.options.cookieDomain}`:"",o.options.cookieSecure?"; secure":"",`;SameSite=${o.options.cookieSameSite}`].join("")},this._storage.getItem=function(o){const e=`; ${document.cookie}`.split(`; ${o}=`);return 2===e.length?decodeURIComponent(e.pop().split(";").shift()):null},this._storage.removeItem=function(e){document.cookie=[encodeURIComponent(e),"=","; expires=Thu, 01 Jan 1970 00:00:00 GMT",o.options.cookiePath?`; path=${o.options.cookiePath}`:"",o.options.cookieDomain?`; domain=${o.options.cookieDomain}`:"",`;SameSite=${o.options.cookieSameSite}`].join("")};break;case"localStorage":this._storage.setItem=function(o,e){localStorage.setItem(o,e)},this._storage.getItem=function(o){return localStorage.getItem(o)},this._storage.removeItem=function(o){localStorage.removeItem(o)};break;case"sessionStorage":this._storage.setItem=function(o,e){sessionStorage.setItem(o,e)},this._storage.getItem=function(o){return sessionStorage.getItem(o)},this._storage.removeItem=function(o){sessionStorage.removeItem(o)};break;case"customStorage":if(!this.options.cookieCustomStorageSet||!this.options.cookieCustomStorageGet||!this.options.cookieCustomStorageDelete)throw new Error("The following options must be set while using the customStorage: cookieCustomStorageSet, cookieCustomStorageGet and cookieCustomStorageDelete");this._storage.setItem=function(e,t){Utils.calculateObjectValue(o.options,o.options.cookieCustomStorageSet,[e,t],"")},this._storage.getItem=function(e){return Utils.calculateObjectValue(o.options,o.options.cookieCustomStorageGet,[e],"")},this._storage.removeItem=function(e){Utils.calculateObjectValue(o.options,o.options.cookieCustomStorageDelete,[e],"")};break;default:throw new Error("Storage method not supported.")}}};