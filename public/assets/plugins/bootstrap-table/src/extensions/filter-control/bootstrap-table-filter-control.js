import*as UtilsFilterControl from"./utils.js";const Utils=$.fn.bootstrapTable.utils;Object.assign($.fn.bootstrapTable.defaults,{filterControl:!1,filterControlVisible:!0,filterControlMultipleSearch:!1,filterControlMultipleSearchDelimiter:",",onColumnSearch:(t,e)=>!1,onCreatedControls:()=>!1,alignmentSelectControlOptions:void 0,filterTemplate:{input:(t,e,o,i)=>Utils.sprintf('<input type="search" class="%s bootstrap-table-filter-control-%s search-input" style="width: 100%;" placeholder="%s" value="%s">',UtilsFilterControl.getInputClass(t),e.field,void 0===o?"":o,void 0===i?"":i),select:(t,e)=>Utils.sprintf('<select class="%s bootstrap-table-filter-control-%s %s" %s style="width: 100%;" dir="%s"></select>',UtilsFilterControl.getInputClass(t,!0),e.field,"","",UtilsFilterControl.getDirectionOfSelectOptions(t.options.alignmentSelectControlOptions)),datepicker:(t,e,o)=>Utils.sprintf('<input type="date" class="%s date-filter-control bootstrap-table-filter-control-%s" style="width: 100%;" value="%s">',UtilsFilterControl.getInputClass(t),e.field,void 0===o?"":o)},searchOnEnterKey:!1,showFilterControlSwitch:!1,sortSelectOptions:!1,_valuesFilterControl:[],_initialized:!1,_isRendering:!1,_usingMultipleSelect:!1}),Object.assign($.fn.bootstrapTable.columnDefaults,{filterControl:void 0,filterControlMultipleSelect:!1,filterControlMultipleSelectOptions:{},filterDataCollector:void 0,filterData:void 0,filterDatepickerOptions:{},filterStrictSearch:!1,filterStartsWithSearch:!1,filterControlPlaceholder:"",filterDefault:"",filterOrderBy:"asc",filterCustomSearch:void 0}),Object.assign($.fn.bootstrapTable.events,{"column-search.bs.table":"onColumnSearch","created-controls.bs.table":"onCreatedControls"}),Object.assign($.fn.bootstrapTable.defaults.icons,{filterControlSwitchHide:{bootstrap3:"glyphicon-zoom-out icon-zoom-out",bootstrap5:"bi-zoom-out",materialize:"zoom_out"}[$.fn.bootstrapTable.theme]||"fa-search-minus",filterControlSwitchShow:{bootstrap3:"glyphicon-zoom-in icon-zoom-in",bootstrap5:"bi-zoom-in",materialize:"zoom_in"}[$.fn.bootstrapTable.theme]||"fa-search-plus"}),Object.assign($.fn.bootstrapTable.locales,{formatFilterControlSwitch:()=>"Hide/Show controls",formatFilterControlSwitchHide:()=>"Hide controls",formatFilterControlSwitchShow:()=>"Show controls",formatClearSearch:()=>"Clear filters"}),Object.assign($.fn.bootstrapTable.defaults,$.fn.bootstrapTable.locales),$.fn.bootstrapTable.methods.push("triggerSearch"),$.fn.bootstrapTable.methods.push("clearFilterControl"),$.fn.bootstrapTable.methods.push("toggleFilterControl"),$.BootstrapTable=class extends $.BootstrapTable{init(){this.options.filterControl&&(this._valuesFilterControl=[],this._initialized=!1,this._usingMultipleSelect=!1,this._isRendering=!1,this.$el.on("reset-view.bs.table",Utils.debounce((()=>{UtilsFilterControl.initFilterSelectControls(this),UtilsFilterControl.setValues(this)}),3)).on("toggle.bs.table",Utils.debounce(((t,e)=>{this._initialized=!1,e||(UtilsFilterControl.initFilterSelectControls(this),UtilsFilterControl.setValues(this),this._initialized=!0)}),1)).on("post-header.bs.table",Utils.debounce((()=>{UtilsFilterControl.initFilterSelectControls(this),UtilsFilterControl.setValues(this)}),3)).on("column-switch.bs.table",Utils.debounce((()=>{UtilsFilterControl.setValues(this),this.options.height&&this.fitHeader()}),1)).on("post-body.bs.table",Utils.debounce((()=>{this.options.height&&!this.options.filterControlContainer&&this.options.filterControlVisible&&UtilsFilterControl.fixHeaderCSS(this),this.$tableLoading.css("top",this.$header.outerHeight()+1)}),1)).on("all.bs.table",(()=>{UtilsFilterControl.syncHeaders(this)}))),super.init()}initBody(){super.initBody(),this.options.filterControl&&setTimeout((()=>{UtilsFilterControl.initFilterSelectControls(this),UtilsFilterControl.setValues(this)}),3)}load(t){super.load(t),this.options.filterControl&&(UtilsFilterControl.createControls(this,UtilsFilterControl.getControlContainer(this)),UtilsFilterControl.setValues(this))}initHeader(){super.initHeader(),this.options.filterControl&&(UtilsFilterControl.createControls(this,UtilsFilterControl.getControlContainer(this)),this._initialized=!0)}initSearch(){const t=this,e=$.isEmptyObject(t.filterColumnsPartial)?null:t.filterColumnsPartial;super.initSearch(),"server"!==this.options.sidePagination&&null!==e&&(t.data=e?t.data.filter(((o,i)=>{const l=[],s=Object.keys(o),r=Object.keys(e),n=s.concat(r.filter((t=>!s.includes(t))));return n.forEach((s=>{const r=t.columns[t.fieldsColumnsIndex[s]],n=e[s]||"";let a,h=n.toLowerCase(),c=Utils.unescapeHTML(Utils.getItemField(o,s,!1));this.options.searchAccentNeutralise&&(h=Utils.normalizeAccent(h));let C=[h];this.options.filterControlMultipleSearch&&(C=h.split(this.options.filterControlMultipleSearchDelimiter)),C.forEach((e=>{!0!==a&&(""===(e=e.trim())?a=!0:(r&&(r.searchFormatter||r._forceFormatter)&&(c=$.fn.bootstrapTable.utils.calculateObjectValue(r,t.header.formatters[$.inArray(s,t.header.fields)],[c,o,i],c)),-1!==$.inArray(s,t.header.fields)&&(null==c?a=!1:"object"==typeof c&&r.filterCustomSearch?l.push(t.isValueExpected(n,c,r,s)):"object"==typeof c&&Array.isArray(c)?c.forEach((o=>{a||(a=t.isValueExpected(e,o,r,s))})):"object"!=typeof c||Array.isArray(c)?"string"!=typeof c&&"number"!=typeof c&&"boolean"!=typeof c||(a=t.isValueExpected(e,c,r,s)):Object.values(c).forEach((o=>{a||(a=t.isValueExpected(e,o,r,s))})))))})),l.push(a)})),!l.includes(!1)})):t.data,t.unsortedData=[...t.data])}isValueExpected(t,e,o,i){let l;"select"===o.filterControl&&(e=Utils.removeHTML(e.toString().toLowerCase())),this.options.searchAccentNeutralise&&(e=Utils.normalizeAccent(e)),l=o.filterStrictSearch||"select"===o.filterControl&&!1!==o.passed.filterStrictSearch?e.toString().toLowerCase()===t.toString().toLowerCase():o.filterStartsWithSearch?0===`${e}`.toLowerCase().indexOf(t):"datepicker"===o.filterControl?new Date(e).getTime()===new Date(t).getTime():this.options.regexSearch?Utils.regexCompare(e,t):`${e}`.toLowerCase().includes(t);const s=/(?:(<=|=>|=<|>=|>|<)(?:\s+)?(\d+)?|(\d+)?(\s+)?(<=|=>|=<|>=|>|<))/gm.exec(t);if(s){const t=s[1]||`${s[5]}l`,o=s[2]||s[3],i=parseInt(e,10),r=parseInt(o,10);switch(t){case">":case"<l":l=i>r;break;case"<":case">l":l=i<r;break;case"<=":case"=<":case">=l":case"=>l":l=i<=r;break;case">=":case"=>":case"<=l":case"=<l":l=i>=r}}if(o.filterCustomSearch){const s=Utils.calculateObjectValue(o,o.filterCustomSearch,[t,e,i,this.options.data],!0);null!==s&&(l=s)}return l}initColumnSearch(t){if(UtilsFilterControl.cacheValues(this),t){this.filterColumnsPartial=t,this.updatePagination();for(const e in t)this.trigger("column-search",e,t[e])}}initToolbar(){this.showToolbar=this.showToolbar||this.options.showFilterControlSwitch,this.showSearchClearButton=this.options.filterControl&&this.options.showSearchClearButton,this.options.showFilterControlSwitch&&(this.buttons=Object.assign(this.buttons,{filterControlSwitch:{text:this.options.filterControlVisible?this.options.formatFilterControlSwitchHide():this.options.formatFilterControlSwitchShow(),icon:this.options.filterControlVisible?this.options.icons.filterControlSwitchHide:this.options.icons.filterControlSwitchShow,event:this.toggleFilterControl,attributes:{"aria-label":this.options.formatFilterControlSwitch(),title:this.options.formatFilterControlSwitch()}}})),super.initToolbar()}resetSearch(t){this.options.filterControl&&this.options.showSearchClearButton&&this.clearFilterControl(),super.resetSearch(t)}clearFilterControl(){if(!this.options.filterControl)return;const t=this,e=this.$el.closest("table"),o=UtilsFilterControl.collectBootstrapTableFilterCookies(),i=UtilsFilterControl.getSearchControls(t);let l=!1,s=0;if($.each(t._valuesFilterControl,((t,e)=>{l=!!l||""!==e.value,e.value=""})),$.each(i,((t,e)=>{e.value=""})),UtilsFilterControl.setValues(t),clearTimeout(s),s=setTimeout((()=>{o&&o.length>0&&$.each(o,((e,o)=>{void 0!==t.deleteCookie&&t.deleteCookie(o)}))}),t.options.searchTimeOut),l&&i.length>0&&(this.filterColumnsPartial={},i.eq(0).trigger("INPUT"===this.tagName?"keyup":"change",{keyCode:13}),t.options.sortName!==e.data("sortName")||t.options.sortOrder!==e.data("sortOrder"))){const e=this.$header.find(Utils.sprintf('[data-field="%s"]',$(i[0]).closest("table").data("sortName")));e.length>0&&(t.onSort({type:"keypress",currentTarget:e}),$(e).find(".sortable").trigger("click"))}}onColumnSearch({currentTarget:t,keyCode:e}){if(UtilsFilterControl.isKeyAllowed(e))return;UtilsFilterControl.cacheValues(this),this.options.cookie?this._filterControlValuesLoaded=!0:this.options.pageNumber=1,$.isEmptyObject(this.filterColumnsPartial)&&(this.filterColumnsPartial={});(this.options.searchOnEnterKey?UtilsFilterControl.getSearchControls(this).toArray():[t]).forEach((t=>{const e=$(t),o=e.val(),i=o?o.trim():"",l=e.closest("[data-field]").data("field");this.trigger("column-search",l,i),i?this.filterColumnsPartial[l]=i:delete this.filterColumnsPartial[l]})),this.onSearch({currentTarget:t},!1)}toggleFilterControl(){this.options.filterControlVisible=!this.options.filterControlVisible;const t=UtilsFilterControl.getControlContainer(this).find(".filter-control, .no-filter-control");if(this.options.filterControlVisible?t.show():(t.hide(),this.clearFilterControl()),this.options.height){this.$tableContainer.find(".fixed-table-header table thead").find(".filter-control, .no-filter-control").toggle(this.options.filterControlVisible),UtilsFilterControl.fixHeaderCSS(this)}const e=this.options.showButtonIcons?this.options.filterControlVisible?this.options.icons.filterControlSwitchHide:this.options.icons.filterControlSwitchShow:"",o=this.options.showButtonText?this.options.filterControlVisible?this.options.formatFilterControlSwitchHide():this.options.formatFilterControlSwitchShow():"";this.$toolbar.find(">.columns").find(".filter-control-switch").html(`${Utils.sprintf(this.constants.html.icon,this.options.iconsPrefix,e)} ${o}`)}triggerSearch(){UtilsFilterControl.getSearchControls(this).each((function(){const t=$(this);t.is("select")?t.trigger("change"):t.trigger("keyup")}))}_toggleColumn(t,e,o){this._initialized=!1,super._toggleColumn(t,e,o),UtilsFilterControl.syncHeaders(this)}};