"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var internalCommon=require("./internal-common.cjs"),preact=require("preact");require("preact/compat");const globalLocales=[],MINIMAL_RAW_EN_LOCALE={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},RAW_EN_LOCALE=Object.assign(Object.assign({},MINIMAL_RAW_EN_LOCALE),{buttonHints:{prev:"Previous $0",next:"Next $0",today:(e,t)=>"day"===t?"Today":`This ${e}`},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint:e=>`Show ${e} more event${1===e?"":"s"}`});function organizeRawLocales(e){let t=e.length>0?e[0].code:"en",n=globalLocales.concat(e),r={en:RAW_EN_LOCALE};for(let e of n)r[e.code]=e;return{map:r,defaultCode:t}}function buildLocale(e,t){return"object"!=typeof e||Array.isArray(e)?queryLocale(e,t):parseLocale(e.code,[e.code],e)}function queryLocale(e,t){let n=[].concat(e||[]);return parseLocale(e,n,queryRawLocale(n,t)||RAW_EN_LOCALE)}function queryRawLocale(e,t){for(let n=0;n<e.length;n+=1){let r=e[n].toLocaleLowerCase().split("-");for(let e=r.length;e>0;e-=1){let n=r.slice(0,e).join("-");if(t[n])return t[n]}}return null}function parseLocale(e,t,n){let r=internalCommon.mergeProps([MINIMAL_RAW_EN_LOCALE,n],["buttonText"]);delete r.code;let{week:i}=r;return delete r.week,{codeArg:e,codes:t,week:i,simpleNumberFormat:new Intl.NumberFormat(e),options:r}}function createPlugin(e){return{id:internalCommon.guid(),name:e.name,premiumReleaseDate:e.premiumReleaseDate?new Date(e.premiumReleaseDate):void 0,deps:e.deps||[],reducers:e.reducers||[],isLoadingFuncs:e.isLoadingFuncs||[],contextInit:[].concat(e.contextInit||[]),eventRefiners:e.eventRefiners||{},eventDefMemberAdders:e.eventDefMemberAdders||[],eventSourceRefiners:e.eventSourceRefiners||{},isDraggableTransformers:e.isDraggableTransformers||[],eventDragMutationMassagers:e.eventDragMutationMassagers||[],eventDefMutationAppliers:e.eventDefMutationAppliers||[],dateSelectionTransformers:e.dateSelectionTransformers||[],datePointTransforms:e.datePointTransforms||[],dateSpanTransforms:e.dateSpanTransforms||[],views:e.views||{},viewPropsTransformers:e.viewPropsTransformers||[],isPropsValid:e.isPropsValid||null,externalDefTransforms:e.externalDefTransforms||[],viewContainerAppends:e.viewContainerAppends||[],eventDropTransformers:e.eventDropTransformers||[],componentInteractions:e.componentInteractions||[],calendarInteractions:e.calendarInteractions||[],themeClasses:e.themeClasses||{},eventSourceDefs:e.eventSourceDefs||[],cmdFormatter:e.cmdFormatter,recurringTypes:e.recurringTypes||[],namedTimeZonedImpl:e.namedTimeZonedImpl,initialView:e.initialView||"",elementDraggingImpl:e.elementDraggingImpl,optionChangeHandlers:e.optionChangeHandlers||{},scrollGridImpl:e.scrollGridImpl||null,listenerRefiners:e.listenerRefiners||{},optionRefiners:e.optionRefiners||{},propSetHandlers:e.propSetHandlers||{}}}function buildPluginHooks(e,t){let n={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function i(e){for(let t of e){const e=t.name,a=n[e];void 0===a?(n[e]=t.id,i(t.deps),r=combineHooks(r,t)):a!==t.id&&console.warn(`Duplicate plugin '${e}'`)}}return e&&i(e),i(t),r}function buildBuildPluginHooks(){let e,t=[],n=[];return(r,i)=>(e&&internalCommon.isArraysEqual(r,t)&&internalCommon.isArraysEqual(i,n)||(e=buildPluginHooks(r,i)),t=r,n=i,e)}function combineHooks(e,t){return{premiumReleaseDate:compareOptionalDates(e.premiumReleaseDate,t.premiumReleaseDate),reducers:e.reducers.concat(t.reducers),isLoadingFuncs:e.isLoadingFuncs.concat(t.isLoadingFuncs),contextInit:e.contextInit.concat(t.contextInit),eventRefiners:Object.assign(Object.assign({},e.eventRefiners),t.eventRefiners),eventDefMemberAdders:e.eventDefMemberAdders.concat(t.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},e.eventSourceRefiners),t.eventSourceRefiners),isDraggableTransformers:e.isDraggableTransformers.concat(t.isDraggableTransformers),eventDragMutationMassagers:e.eventDragMutationMassagers.concat(t.eventDragMutationMassagers),eventDefMutationAppliers:e.eventDefMutationAppliers.concat(t.eventDefMutationAppliers),dateSelectionTransformers:e.dateSelectionTransformers.concat(t.dateSelectionTransformers),datePointTransforms:e.datePointTransforms.concat(t.datePointTransforms),dateSpanTransforms:e.dateSpanTransforms.concat(t.dateSpanTransforms),views:Object.assign(Object.assign({},e.views),t.views),viewPropsTransformers:e.viewPropsTransformers.concat(t.viewPropsTransformers),isPropsValid:t.isPropsValid||e.isPropsValid,externalDefTransforms:e.externalDefTransforms.concat(t.externalDefTransforms),viewContainerAppends:e.viewContainerAppends.concat(t.viewContainerAppends),eventDropTransformers:e.eventDropTransformers.concat(t.eventDropTransformers),calendarInteractions:e.calendarInteractions.concat(t.calendarInteractions),componentInteractions:e.componentInteractions.concat(t.componentInteractions),themeClasses:Object.assign(Object.assign({},e.themeClasses),t.themeClasses),eventSourceDefs:e.eventSourceDefs.concat(t.eventSourceDefs),cmdFormatter:t.cmdFormatter||e.cmdFormatter,recurringTypes:e.recurringTypes.concat(t.recurringTypes),namedTimeZonedImpl:t.namedTimeZonedImpl||e.namedTimeZonedImpl,initialView:e.initialView||t.initialView,elementDraggingImpl:e.elementDraggingImpl||t.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},e.optionChangeHandlers),t.optionChangeHandlers),scrollGridImpl:t.scrollGridImpl||e.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},e.listenerRefiners),t.listenerRefiners),optionRefiners:Object.assign(Object.assign({},e.optionRefiners),t.optionRefiners),propSetHandlers:Object.assign(Object.assign({},e.propSetHandlers),t.propSetHandlers)}}function compareOptionalDates(e,t){return void 0===e?t:void 0===t?e:new Date(Math.max(e.valueOf(),t.valueOf()))}class StandardTheme extends internalCommon.Theme{}function compileViewDefs(e,t){let n,r={};for(n in e)ensureViewDef(n,r,e,t);for(n in t)ensureViewDef(n,r,e,t);return r}function ensureViewDef(e,t,n,r){if(t[e])return t[e];let i=buildViewDef(e,t,n,r);return i&&(t[e]=i),i}function buildViewDef(e,t,n,r){let i=n[e],a=r[e],o=e=>i&&null!==i[e]?i[e]:a&&null!==a[e]?a[e]:null,s=o("component"),l=o("superType"),c=null;if(l){if(l===e)throw new Error("Can't have a custom view type that references itself");c=ensureViewDef(l,t,n,r)}return!s&&c&&(s=c.component),s?{type:e,component:s,defaults:Object.assign(Object.assign({},c?c.defaults:{}),i?i.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),a?a.rawOptions:{})}:null}function parseViewConfigs(e){return internalCommon.mapHash(e,parseViewConfig)}function parseViewConfig(e){let t="function"==typeof e?{component:e}:e,{component:n}=t;return t.content?n=createViewHookComponent(t):!n||n.prototype instanceof internalCommon.BaseComponent||(n=createViewHookComponent(Object.assign(Object.assign({},t),{content:n}))),{superType:t.type,component:n,rawOptions:t}}function createViewHookComponent(e){return t=>preact.createElement(internalCommon.ViewContextType.Consumer,null,(n=>preact.createElement(internalCommon.ContentContainer,{elTag:"div",elClasses:internalCommon.buildViewClassNames(n.viewSpec),renderProps:Object.assign(Object.assign({},t),{nextDayThreshold:n.options.nextDayThreshold}),generatorName:void 0,customGenerator:e.content,classNameGenerator:e.classNames,didMount:e.didMount,willUnmount:e.willUnmount})))}function buildViewSpecs(e,t,n,r){let i=parseViewConfigs(e),a=parseViewConfigs(t.views),o=compileViewDefs(i,a);return internalCommon.mapHash(o,(e=>buildViewSpec(e,a,t,n,r)))}function buildViewSpec(e,t,n,r,i){let a=e.overrides.duration||e.defaults.duration||r.duration||n.duration,o=null,s="",l="",c={};if(a&&(o=createDurationCached(a),o)){let e=internalCommon.greatestDurationDenominator(o);s=e.unit,1===e.value&&(l=s,c=t[s]?t[s].rawOptions:{})}let u=t=>{let n=t.buttonText||{},r=e.defaults.buttonTextKey;return null!=r&&null!=n[r]?n[r]:null!=n[e.type]?n[e.type]:null!=n[l]?n[l]:null},d=t=>{let n=t.buttonHints||{},r=e.defaults.buttonTextKey;return null!=r&&null!=n[r]?n[r]:null!=n[e.type]?n[e.type]:null!=n[l]?n[l]:null};return{type:e.type,component:e.component,duration:o,durationUnit:s,singleUnit:l,optionDefaults:e.defaults,optionOverrides:Object.assign(Object.assign({},c),e.overrides),buttonTextOverride:u(r)||u(n)||e.overrides.buttonText,buttonTextDefault:u(i)||e.defaults.buttonText||u(internalCommon.BASE_OPTION_DEFAULTS)||e.type,buttonTitleOverride:d(r)||d(n)||e.overrides.buttonHint,buttonTitleDefault:d(i)||e.defaults.buttonHint||d(internalCommon.BASE_OPTION_DEFAULTS)}}StandardTheme.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"},StandardTheme.prototype.baseIconClass="fc-icon",StandardTheme.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"},StandardTheme.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"},StandardTheme.prototype.iconOverrideOption="buttonIcons",StandardTheme.prototype.iconOverrideCustomButtonOption="icon",StandardTheme.prototype.iconOverridePrefix="fc-icon-";let durationInputMap={};function createDurationCached(e){let t=JSON.stringify(e),n=durationInputMap[t];return void 0===n&&(n=internalCommon.createDuration(e),durationInputMap[t]=n),n}function reduceViewType(e,t){if("CHANGE_VIEW_TYPE"===t.type)e=t.viewType;return e}function reduceDynamicOptionOverrides(e,t){return"SET_OPTION"===t.type?Object.assign(Object.assign({},e),{[t.optionName]:t.rawOptionValue}):e}function reduceDateProfile(e,t,n,r){let i;switch(t.type){case"CHANGE_VIEW_TYPE":return r.build(t.dateMarker||n);case"CHANGE_DATE":return r.build(t.dateMarker);case"PREV":if(i=r.buildPrev(e,n),i.isValid)return i;break;case"NEXT":if(i=r.buildNext(e,n),i.isValid)return i}return e}function initEventSources(e,t,n){let r=t?t.activeRange:null;return addSources({},parseInitialSources(e,n),r,n)}function reduceEventSources(e,t,n,r){let i=n?n.activeRange:null;switch(t.type){case"ADD_EVENT_SOURCES":return addSources(e,t.sources,i,r);case"REMOVE_EVENT_SOURCE":return removeSource(e,t.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return n?fetchDirtySources(e,i,r):e;case"FETCH_EVENT_SOURCES":return fetchSourcesByIds(e,t.sourceIds?internalCommon.arrayToHash(t.sourceIds):excludeStaticSources(e,r),i,t.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return receiveResponse(e,t.sourceId,t.fetchId,t.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return e}}function reduceEventSourcesNewTimeZone(e,t,n){let r=t?t.activeRange:null;return fetchSourcesByIds(e,excludeStaticSources(e,n),r,!0,n)}function computeEventSourcesLoading(e){for(let t in e)if(e[t].isFetching)return!0;return!1}function addSources(e,t,n,r){let i={};for(let e of t)i[e.sourceId]=e;return n&&(i=fetchDirtySources(i,n,r)),Object.assign(Object.assign({},e),i)}function removeSource(e,t){return internalCommon.filterHash(e,(e=>e.sourceId!==t))}function fetchDirtySources(e,t,n){return fetchSourcesByIds(e,internalCommon.filterHash(e,(e=>isSourceDirty(e,t,n))),t,!1,n)}function isSourceDirty(e,t,n){return doesSourceNeedRange(e,n)?!n.options.lazyFetching||!e.fetchRange||e.isFetching||t.start<e.fetchRange.start||t.end>e.fetchRange.end:!e.latestFetchId}function fetchSourcesByIds(e,t,n,r,i){let a={};for(let o in e){let s=e[o];t[o]?a[o]=fetchSource(s,n,r,i):a[o]=s}return a}function fetchSource(e,t,n,r){let{options:i,calendarApi:a}=r,o=r.pluginHooks.eventSourceDefs[e.sourceDefId],s=internalCommon.guid();return o.fetch({eventSource:e,range:t,isRefetch:n,context:r},(n=>{let{rawEvents:o}=n;i.eventSourceSuccess&&(o=i.eventSourceSuccess.call(a,o,n.response)||o),e.success&&(o=e.success.call(a,o,n.response)||o),r.dispatch({type:"RECEIVE_EVENTS",sourceId:e.sourceId,fetchId:s,fetchRange:t,rawEvents:o})}),(n=>{let o=!1;i.eventSourceFailure&&(i.eventSourceFailure.call(a,n),o=!0),e.failure&&(e.failure(n),o=!0),o||console.warn(n.message,n),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:e.sourceId,fetchId:s,fetchRange:t,error:n})})),Object.assign(Object.assign({},e),{isFetching:!0,latestFetchId:s})}function receiveResponse(e,t,n,r){let i=e[t];return i&&n===i.latestFetchId?Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},i),{isFetching:!1,fetchRange:r})}):e}function excludeStaticSources(e,t){return internalCommon.filterHash(e,(e=>doesSourceNeedRange(e,t)))}function parseInitialSources(e,t){let n=internalCommon.buildEventSourceRefiners(t),r=[].concat(e.eventSources||[]),i=[];e.initialEvents&&r.unshift(e.initialEvents),e.events&&r.unshift(e.events);for(let e of r){let r=internalCommon.parseEventSource(e,t,n);r&&i.push(r)}return i}function doesSourceNeedRange(e,t){return!t.pluginHooks.eventSourceDefs[e.sourceDefId].ignoreRange}function reduceDateSelection(e,t){switch(t.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return t.selection;default:return e}}function reduceSelectedEvent(e,t){switch(t.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return t.eventInstanceId;default:return e}}function reduceEventDrag(e,t){let n;switch(t.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return n=t.state,{affectedEvents:n.affectedEvents,mutatedEvents:n.mutatedEvents,isEvent:n.isEvent};default:return e}}function reduceEventResize(e,t){let n;switch(t.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return n=t.state,{affectedEvents:n.affectedEvents,mutatedEvents:n.mutatedEvents,isEvent:n.isEvent};default:return e}}function parseToolbars(e,t,n,r,i){return{header:e.headerToolbar?parseToolbar(e.headerToolbar,e,t,n,r,i):null,footer:e.footerToolbar?parseToolbar(e.footerToolbar,e,t,n,r,i):null}}function parseToolbar(e,t,n,r,i,a){let o={},s=[],l=!1;for(let c in e){let u=parseSection(e[c],t,n,r,i,a);o[c]=u.widgets,s.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:o,viewsWithButtons:s,hasTitle:l}}function parseSection(e,t,n,r,i,a){let o="rtl"===t.direction,s=t.customButtons||{},l=n.buttonText||{},c=t.buttonText||{},u=n.buttonHints||{},d=t.buttonHints||{},m=e?e.split(" "):[],p=[],h=!1;return{widgets:m.map((e=>e.split(",").map((e=>{if("title"===e)return h=!0,{buttonName:e};let n,m,f,g,v,E;if(n=s[e])f=e=>{n.click&&n.click.call(e.target,e,e.target)},(g=r.getCustomButtonIconClass(n))||(g=r.getIconClass(e,o))||(v=n.text),E=n.hint||n.text;else if(m=i[e]){p.push(e),f=()=>{a.changeView(e)},(v=m.buttonTextOverride)||(g=r.getIconClass(e,o))||(v=m.buttonTextDefault);let n=m.buttonTextOverride||m.buttonTextDefault;E=internalCommon.formatWithOrdinals(m.buttonTitleOverride||m.buttonTitleDefault||t.viewHint,[n,e],n)}else if(a[e])if(f=()=>{a[e]()},(v=l[e])||(g=r.getIconClass(e,o))||(v=c[e]),"prevYear"===e||"nextYear"===e){let t="prevYear"===e?"prev":"next";E=internalCommon.formatWithOrdinals(u[t]||d[t],[c.year||"year","year"],c[e])}else E=t=>internalCommon.formatWithOrdinals(u[e]||d[e],[c[t]||t,t],c[e]);return{buttonName:e,buttonClick:f,buttonIcon:g,buttonText:v,buttonHint:E}})))),viewsWithButtons:p,hasTitle:h}}class ViewImpl{constructor(e,t,n){this.type=e,this.getCurrentData=t,this.dateEnv=n}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}}let eventSourceDef$2={ignoreRange:!0,parseMeta:e=>Array.isArray(e.events)?e.events:null,fetch(e,t){t({rawEvents:e.eventSource.meta})}};const arrayEventSourcePlugin=createPlugin({name:"array-event-source",eventSourceDefs:[eventSourceDef$2]});let eventSourceDef$1={parseMeta:e=>"function"==typeof e.events?e.events:null,fetch(e,t,n){const{dateEnv:r}=e.context,i=e.eventSource.meta;internalCommon.unpromisify(i.bind(null,internalCommon.buildRangeApiWithTimeZone(e.range,r)),(e=>t({rawEvents:e})),n)}};const funcEventSourcePlugin=createPlugin({name:"func-event-source",eventSourceDefs:[eventSourceDef$1]}),JSON_FEED_EVENT_SOURCE_REFINERS={method:String,extraParams:internalCommon.identity,startParam:String,endParam:String,timeZoneParam:String};let eventSourceDef={parseMeta:e=>!e.url||"json"!==e.format&&e.format?null:{url:e.url,format:"json",method:(e.method||"GET").toUpperCase(),extraParams:e.extraParams,startParam:e.startParam,endParam:e.endParam,timeZoneParam:e.timeZoneParam},fetch(e,t,n){const{meta:r}=e.eventSource,i=buildRequestParams(r,e.range,e.context);internalCommon.requestJson(r.method,r.url,i).then((([e,n])=>{t({rawEvents:e,response:n})}),n)}};const jsonFeedEventSourcePlugin=createPlugin({name:"json-event-source",eventSourceRefiners:JSON_FEED_EVENT_SOURCE_REFINERS,eventSourceDefs:[eventSourceDef]});function buildRequestParams(e,t,n){let r,i,a,o,{dateEnv:s,options:l}=n,c={};return r=e.startParam,null==r&&(r=l.startParam),i=e.endParam,null==i&&(i=l.endParam),a=e.timeZoneParam,null==a&&(a=l.timeZoneParam),o="function"==typeof e.extraParams?e.extraParams():e.extraParams||{},Object.assign(c,o),c[r]=s.formatIso(t.start),c[i]=s.formatIso(t.end),"local"!==s.timeZone&&(c[a]=s.timeZone),c}const SIMPLE_RECURRING_REFINERS={daysOfWeek:internalCommon.identity,startTime:internalCommon.createDuration,endTime:internalCommon.createDuration,duration:internalCommon.createDuration,startRecur:internalCommon.identity,endRecur:internalCommon.identity};let recurring={parse(e,t){if(e.daysOfWeek||e.startTime||e.endTime||e.startRecur||e.endRecur){let n,r={daysOfWeek:e.daysOfWeek||null,startTime:e.startTime||null,endTime:e.endTime||null,startRecur:e.startRecur?t.createMarker(e.startRecur):null,endRecur:e.endRecur?t.createMarker(e.endRecur):null};return e.duration&&(n=e.duration),!n&&e.startTime&&e.endTime&&(n=internalCommon.subtractDurations(e.endTime,e.startTime)),{allDayGuess:Boolean(!e.startTime&&!e.endTime),duration:n,typeData:r}}return null},expand(e,t,n){let r=internalCommon.intersectRanges(t,{start:e.startRecur,end:e.endRecur});return r?expandRanges(e.daysOfWeek,e.startTime,r,n):[]}};const simpleRecurringEventsPlugin=createPlugin({name:"simple-recurring-event",recurringTypes:[recurring],eventRefiners:SIMPLE_RECURRING_REFINERS});function expandRanges(e,t,n,r){let i=e?internalCommon.arrayToHash(e):null,a=internalCommon.startOfDay(n.start),o=n.end,s=[];for(;a<o;){let e;i&&!i[a.getUTCDay()]||(e=t?r.add(a,t):a,s.push(e)),a=internalCommon.addDays(a,1)}return s}const changeHandlerPlugin=createPlugin({name:"change-handler",optionChangeHandlers:{events(e,t){handleEventSources([e],t)},eventSources:handleEventSources}});function handleEventSources(e,t){let n=internalCommon.hashValuesToArray(t.getCurrentData().eventSources);if(1===n.length&&1===e.length&&Array.isArray(n[0]._raw)&&Array.isArray(e[0]))return void t.dispatch({type:"RESET_RAW_EVENTS",sourceId:n[0].sourceId,rawEvents:e[0]});let r=[];for(let t of e){let e=!1;for(let r=0;r<n.length;r+=1)if(n[r]._raw===t){n.splice(r,1),e=!0;break}e||r.push(t)}for(let e of n)t.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:e.sourceId});for(let e of r)t.calendarApi.addEventSource(e)}function handleDateProfile(e,t){t.emitter.trigger("datesSet",Object.assign(Object.assign({},internalCommon.buildRangeApiWithTimeZone(e.activeRange,t.dateEnv)),{view:t.viewApi}))}function handleEventStore(e,t){let{emitter:n}=t;n.hasHandlers("eventsSet")&&n.trigger("eventsSet",internalCommon.buildEventApis(e,t))}const globalPlugins=[arrayEventSourcePlugin,funcEventSourcePlugin,jsonFeedEventSourcePlugin,simpleRecurringEventsPlugin,changeHandlerPlugin,createPlugin({name:"misc",isLoadingFuncs:[e=>computeEventSourcesLoading(e.eventSources)],propSetHandlers:{dateProfile:handleDateProfile,eventStore:handleEventStore}})];class TaskRunner{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new internalCommon.DelayedRunner(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t,n=[];for(;t=e.shift();)this.runTask(t),n.push(t);this.drained(n)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}}function buildTitle(e,t,n){let r;return r=/^(year|month)$/.test(e.currentRangeUnit)?e.currentRange:e.activeRange,n.formatRange(r.start,r.end,internalCommon.createFormatter(t.titleFormat||buildTitleFormat(e)),{isEndExclusive:e.isRangeAllDay,defaultSeparator:t.titleRangeSeparator})}function buildTitleFormat(e){let{currentRangeUnit:t}=e;if("year"===t)return{year:"numeric"};if("month"===t)return{year:"numeric",month:"long"};let n=internalCommon.diffWholeDays(e.currentRange.start,e.currentRange.end);return null!==n&&n>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}class CalendarDataManager{constructor(e){this.computeCurrentViewData=internalCommon.memoize(this._computeCurrentViewData),this.organizeRawLocales=internalCommon.memoize(organizeRawLocales),this.buildLocale=internalCommon.memoize(buildLocale),this.buildPluginHooks=buildBuildPluginHooks(),this.buildDateEnv=internalCommon.memoize(buildDateEnv$1),this.buildTheme=internalCommon.memoize(buildTheme),this.parseToolbars=internalCommon.memoize(parseToolbars),this.buildViewSpecs=internalCommon.memoize(buildViewSpecs),this.buildDateProfileGenerator=internalCommon.memoizeObjArg(buildDateProfileGenerator),this.buildViewApi=internalCommon.memoize(buildViewApi),this.buildViewUiProps=internalCommon.memoizeObjArg(buildViewUiProps),this.buildEventUiBySource=internalCommon.memoize(buildEventUiBySource,internalCommon.isPropsEqual),this.buildEventUiBases=internalCommon.memoize(buildEventUiBases),this.parseContextBusinessHours=internalCommon.memoizeObjArg(parseContextBusinessHours),this.buildTitle=internalCommon.memoize(buildTitle),this.emitter=new internalCommon.Emitter,this.actionRunner=new TaskRunner(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=e=>{this.actionRunner.request(e)},this.props=e,this.actionRunner.pause();let t={},n=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),r=n.calendarOptions.initialView||n.pluginHooks.initialView,i=this.computeCurrentViewData(r,n,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(i.options);let a=internalCommon.getInitialDate(n.calendarOptions,n.dateEnv),o=i.dateProfileGenerator.build(a);internalCommon.rangeContainsMarker(o.activeRange,a)||(a=o.currentRange.start);let s={dateEnv:n.dateEnv,options:n.calendarOptions,pluginHooks:n.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData};for(let e of n.pluginHooks.contextInit)e(s);let l=initEventSources(n.calendarOptions,o,s),c={dynamicOptionOverrides:t,currentViewType:r,currentDate:a,dateProfile:o,businessHours:this.parseContextBusinessHours(s),eventSources:l,eventUiBases:{},eventStore:internalCommon.createEmptyEventStore(),renderableEventStore:internalCommon.createEmptyEventStore(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(s).selectionConfig},u=Object.assign(Object.assign({},s),c);for(let e of n.pluginHooks.reducers)Object.assign(c,e(null,null,u));computeIsLoading(c,s)&&this.emitter.trigger("loading",!0),this.state=c,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:n}=this;void 0===t?n.optionOverrides=e:(n.optionOverrides=Object.assign(Object.assign({},n.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(void 0===t||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:n,emitter:r}=this,i=reduceDynamicOptionOverrides(n.dynamicOptionOverrides,e),a=this.computeOptionsData(t.optionOverrides,i,t.calendarApi),o=reduceViewType(n.currentViewType,e),s=this.computeCurrentViewData(o,a,t.optionOverrides,i);t.calendarApi.currentDataManager=this,r.setThisContext(t.calendarApi),r.setOptions(s.options);let l={dateEnv:a.dateEnv,options:a.calendarOptions,pluginHooks:a.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:r,getCurrentData:this.getCurrentData},{currentDate:c,dateProfile:u}=n;this.data&&this.data.dateProfileGenerator!==s.dateProfileGenerator&&(u=s.dateProfileGenerator.build(c)),c=internalCommon.reduceCurrentDate(c,e),u=reduceDateProfile(u,e,c,s.dateProfileGenerator),"PREV"!==e.type&&"NEXT"!==e.type&&internalCommon.rangeContainsMarker(u.currentRange,c)||(c=u.currentRange.start);let d=reduceEventSources(n.eventSources,e,u,l),m=internalCommon.reduceEventStore(n.eventStore,e,d,u,l),p=computeEventSourcesLoading(d)&&!s.options.progressiveEventRendering&&n.renderableEventStore||m,{eventUiSingleBase:h,selectionConfig:f}=this.buildViewUiProps(l),g=this.buildEventUiBySource(d),v={dynamicOptionOverrides:i,currentViewType:o,currentDate:c,dateProfile:u,eventSources:d,eventStore:m,renderableEventStore:p,selectionConfig:f,eventUiBases:this.buildEventUiBases(p.defs,h,g),businessHours:this.parseContextBusinessHours(l),dateSelection:reduceDateSelection(n.dateSelection,e),eventSelection:reduceSelectedEvent(n.eventSelection,e),eventDrag:reduceEventDrag(n.eventDrag,e),eventResize:reduceEventResize(n.eventResize,e)},E=Object.assign(Object.assign({},l),v);for(let t of a.pluginHooks.reducers)Object.assign(v,t(n,e,E));let C=computeIsLoading(n,l),b=computeIsLoading(v,l);!C&&b?r.trigger("loading",!0):C&&!b&&r.trigger("loading",!1),this.state=v,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,n=this.data,r=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),i=this.computeCurrentViewData(t.currentViewType,r,e.optionOverrides,t.dynamicOptionOverrides),a=this.data=Object.assign(Object.assign(Object.assign({viewTitle:this.buildTitle(t.dateProfile,i.options,r.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},r),i),t),o=r.pluginHooks.optionChangeHandlers,s=n&&n.calendarOptions,l=r.calendarOptions;if(s&&s!==l){s.timeZone!==l.timeZone&&(t.eventSources=a.eventSources=reduceEventSourcesNewTimeZone(a.eventSources,t.dateProfile,a),t.eventStore=a.eventStore=internalCommon.rezoneEventStoreDates(a.eventStore,n.dateEnv,a.dateEnv),t.renderableEventStore=a.renderableEventStore=internalCommon.rezoneEventStoreDates(a.renderableEventStore,n.dateEnv,a.dateEnv));for(let e in o)-1===this.optionsForHandling.indexOf(e)&&s[e]===l[e]||o[e](l[e],a)}this.optionsForHandling=[],e.onData&&e.onData(a)}computeOptionsData(e,t,n){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:r,pluginHooks:i,localeDefaults:a,availableLocaleData:o,extra:s}=this.processRawCalendarOptions(e,t);warnUnknownOptions(s);let l=this.buildDateEnv(r.timeZone,r.locale,r.weekNumberCalculation,r.firstDay,r.weekText,i,o,r.defaultRangeSeparator),c=this.buildViewSpecs(i.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,a),u=this.buildTheme(r,i),d=this.parseToolbars(r,this.stableOptionOverrides,u,c,n);return this.stableCalendarOptionsData={calendarOptions:r,pluginHooks:i,dateEnv:l,viewSpecs:c,theme:u,toolbarConfig:d,localeDefaults:a,availableRawLocales:o.map}}processRawCalendarOptions(e,t){let{locales:n,locale:r}=internalCommon.mergeRawOptions([internalCommon.BASE_OPTION_DEFAULTS,e,t]),i=this.organizeRawLocales(n),a=i.map,o=this.buildLocale(r||i.defaultCode,a).options,s=this.buildPluginHooks(e.plugins||[],globalPlugins),l=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},internalCommon.BASE_OPTION_REFINERS),internalCommon.CALENDAR_LISTENER_REFINERS),internalCommon.CALENDAR_OPTION_REFINERS),s.listenerRefiners),s.optionRefiners),c={},u=internalCommon.mergeRawOptions([internalCommon.BASE_OPTION_DEFAULTS,o,e,t]),d={},m=this.currentCalendarOptionsInput,p=this.currentCalendarOptionsRefined,h=!1;for(let e in u)-1===this.optionsForRefining.indexOf(e)&&(u[e]===m[e]||internalCommon.COMPLEX_OPTION_COMPARATORS[e]&&e in m&&internalCommon.COMPLEX_OPTION_COMPARATORS[e](m[e],u[e]))?d[e]=p[e]:l[e]?(d[e]=l[e](u[e]),h=!0):c[e]=m[e];return h&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=d,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:s,availableLocaleData:i,localeDefaults:o,extra:c}}_computeCurrentViewData(e,t,n,r){let i=t.viewSpecs[e];if(!i)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:a,extra:o}=this.processRawViewOptions(i,t.pluginHooks,t.localeDefaults,n,r);return warnUnknownOptions(o),{viewSpec:i,options:a,dateProfileGenerator:this.buildDateProfileGenerator({dateProfileGeneratorClass:i.optionDefaults.dateProfileGeneratorClass,duration:i.duration,durationUnit:i.durationUnit,usesMinMaxTime:i.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:a.slotMinTime,slotMaxTime:a.slotMaxTime,showNonCurrentDates:a.showNonCurrentDates,dayCount:a.dayCount,dateAlignment:a.dateAlignment,dateIncrement:a.dateIncrement,hiddenDays:a.hiddenDays,weekends:a.weekends,nowInput:a.now,validRangeInput:a.validRange,visibleRangeInput:a.visibleRange,fixedWeekCount:a.fixedWeekCount}),viewApi:this.buildViewApi(e,this.getCurrentData,t.dateEnv)}}processRawViewOptions(e,t,n,r,i){let a=internalCommon.mergeRawOptions([internalCommon.BASE_OPTION_DEFAULTS,e.optionDefaults,n,r,e.optionOverrides,i]),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},internalCommon.BASE_OPTION_REFINERS),internalCommon.CALENDAR_LISTENER_REFINERS),internalCommon.CALENDAR_OPTION_REFINERS),internalCommon.VIEW_OPTION_REFINERS),t.listenerRefiners),t.optionRefiners),s={},l=this.currentViewOptionsInput,c=this.currentViewOptionsRefined,u=!1,d={};for(let e in a)a[e]===l[e]||internalCommon.COMPLEX_OPTION_COMPARATORS[e]&&internalCommon.COMPLEX_OPTION_COMPARATORS[e](a[e],l[e])?s[e]=c[e]:(a[e]===this.currentCalendarOptionsInput[e]||internalCommon.COMPLEX_OPTION_COMPARATORS[e]&&internalCommon.COMPLEX_OPTION_COMPARATORS[e](a[e],this.currentCalendarOptionsInput[e])?e in this.currentCalendarOptionsRefined&&(s[e]=this.currentCalendarOptionsRefined[e]):o[e]?s[e]=o[e](a[e]):d[e]=a[e],u=!0);return u&&(this.currentViewOptionsInput=a,this.currentViewOptionsRefined=s),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:d}}}function buildDateEnv$1(e,t,n,r,i,a,o,s){let l=buildLocale(t||o.defaultCode,o.map);return new internalCommon.DateEnv({calendarSystem:"gregory",timeZone:e,namedTimeZoneImpl:a.namedTimeZonedImpl,locale:l,weekNumberCalculation:n,firstDay:r,weekText:i,cmdFormatter:a.cmdFormatter,defaultSeparator:s})}function buildTheme(e,t){return new(t.themeClasses[e.themeSystem]||StandardTheme)(e)}function buildDateProfileGenerator(e){return new(e.dateProfileGeneratorClass||internalCommon.DateProfileGenerator)(e)}function buildViewApi(e,t,n){return new ViewImpl(e,t,n)}function buildEventUiBySource(e){return internalCommon.mapHash(e,(e=>e.ui))}function buildEventUiBases(e,t,n){let r={"":t};for(let t in e){let i=e[t];i.sourceId&&n[i.sourceId]&&(r[t]=n[i.sourceId])}return r}function buildViewUiProps(e){let{options:t}=e;return{eventUiSingleBase:internalCommon.createEventUi({display:t.eventDisplay,editable:t.editable,startEditable:t.eventStartEditable,durationEditable:t.eventDurationEditable,constraint:t.eventConstraint,overlap:"boolean"==typeof t.eventOverlap?t.eventOverlap:void 0,allow:t.eventAllow,backgroundColor:t.eventBackgroundColor,borderColor:t.eventBorderColor,textColor:t.eventTextColor,color:t.eventColor},e),selectionConfig:internalCommon.createEventUi({constraint:t.selectConstraint,overlap:"boolean"==typeof t.selectOverlap?t.selectOverlap:void 0,allow:t.selectAllow},e)}}function computeIsLoading(e,t){for(let n of t.pluginHooks.isLoadingFuncs)if(n(e))return!0;return!1}function parseContextBusinessHours(e){return internalCommon.parseBusinessHours(e.options.businessHours,e)}function warnUnknownOptions(e,t){for(let n in e)console.warn(`Unknown option '${n}'`+(t?` for view '${t}'`:""))}class ToolbarSection extends internalCommon.BaseComponent{render(){let e=this.props.widgetGroups.map((e=>this.renderWidgetGroup(e)));return preact.createElement("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:n}=this.context,r=[],i=!0;for(let a of e){let{buttonName:e,buttonClick:o,buttonText:s,buttonIcon:l,buttonHint:c}=a;if("title"===e)i=!1,r.push(preact.createElement("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let i=e===t.activeButton,a=!t.isTodayEnabled&&"today"===e||!t.isPrevEnabled&&"prev"===e||!t.isNextEnabled&&"next"===e,u=[`fc-${e}-button`,n.getClass("button")];i&&u.push(n.getClass("buttonActive")),r.push(preact.createElement("button",{type:"button",title:"function"==typeof c?c(t.navUnit):c,disabled:a,"aria-pressed":i,className:u.join(" "),onClick:o},s||(l?preact.createElement("span",{className:l,role:"img"}):"")))}}if(r.length>1){let e=i&&n.getClass("buttonGroup")||"";return preact.createElement("div",{className:e},...r)}return r[0]}}class Toolbar extends internalCommon.BaseComponent{render(){let e,t,{model:n,extraClassName:r}=this.props,i=!1,a=n.sectionWidgets,o=a.center;a.left?(i=!0,e=a.left):e=a.start,a.right?(i=!0,t=a.right):t=a.end;let s=[r||"","fc-toolbar",i?"fc-toolbar-ltr":""];return preact.createElement("div",{className:s.join(" ")},this.renderSection("start",e||[]),this.renderSection("center",o||[]),this.renderSection("end",t||[]))}renderSection(e,t){let{props:n}=this;return preact.createElement(ToolbarSection,{key:e,widgetGroups:t,title:n.title,navUnit:n.navUnit,activeButton:n.activeButton,isTodayEnabled:n.isTodayEnabled,isPrevEnabled:n.isPrevEnabled,isNextEnabled:n.isNextEnabled,titleId:n.titleId})}}class ViewHarness extends internalCommon.BaseComponent{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,internalCommon.setRef(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:n}=e,r=["fc-view-harness",n||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],i="",a="";return n?null!==t.availableWidth?i=t.availableWidth/n:a=1/n*100+"%":i=e.height||"",preact.createElement("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:r.join(" "),style:{height:i,paddingBottom:a}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}}class EventClicking extends internalCommon.Interaction{constructor(e){super(e),this.handleSegClick=(e,t)=>{let{component:n}=this,{context:r}=n,i=internalCommon.getElSeg(t);if(i&&n.isValidSegDownEl(e.target)){let a=internalCommon.elementClosest(e.target,".fc-event-forced-url"),o=a?a.querySelector("a[href]").href:"";r.emitter.trigger("eventClick",{el:t,event:new internalCommon.EventImpl(n.context,i.eventRange.def,i.eventRange.instance),jsEvent:e,view:r.viewApi}),o&&!e.defaultPrevented&&(window.location.href=o)}},this.destroy=internalCommon.listenBySelector(e.el,"click",".fc-event",this.handleSegClick)}}class EventHovering extends internalCommon.Interaction{constructor(e){super(e),this.handleEventElRemove=e=>{e===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(e,t)=>{internalCommon.getElSeg(t)&&(this.currentSegEl=t,this.triggerEvent("eventMouseEnter",e,t))},this.handleSegLeave=(e,t)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",e,t))},this.removeHoverListeners=internalCommon.listenToHoverBySelector(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,n){let{component:r}=this,{context:i}=r,a=internalCommon.getElSeg(n);t&&!r.isValidSegDownEl(t.target)||i.emitter.trigger(e,{el:n,event:new internalCommon.EventImpl(i,a.eventRange.def,a.eventRange.instance),jsEvent:t,view:i.viewApi})}}class CalendarContent extends internalCommon.PureComponent{constructor(){super(...arguments),this.buildViewContext=internalCommon.memoize(internalCommon.buildViewContext),this.buildViewPropTransformers=internalCommon.memoize(buildViewPropTransformers),this.buildToolbarProps=internalCommon.memoize(buildToolbarProps),this.headerRef=preact.createRef(),this.footerRef=preact.createRef(),this.interactionsStore={},this.state={viewLabelId:internalCommon.getUniqueDomId()},this.registerInteractiveComponent=(e,t)=>{let n=internalCommon.parseInteractionSettings(e,t),r=[EventClicking,EventHovering].concat(this.props.pluginHooks.componentInteractions).map((e=>new e(n)));this.interactionsStore[e.uid]=r,internalCommon.interactionSettingsStore[e.uid]=n},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let e of t)e.destroy();delete this.interactionsStore[e.uid]}delete internalCommon.interactionSettingsStore[e.uid]},this.resizeRunner=new internalCommon.DelayedRunner((()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})})),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let e,{props:t}=this,{toolbarConfig:n,options:r}=t,i=this.buildToolbarProps(t.viewSpec,t.dateProfile,t.dateProfileGenerator,t.currentDate,internalCommon.getNow(t.options.now,t.dateEnv),t.viewTitle),a=!1,o="";t.isHeightAuto||t.forPrint?o="":null!=r.height?a=!0:null!=r.contentHeight?o=r.contentHeight:e=Math.max(r.aspectRatio,.5);let s=this.buildViewContext(t.viewSpec,t.viewApi,t.options,t.dateProfileGenerator,t.dateEnv,t.theme,t.pluginHooks,t.dispatch,t.getCurrentData,t.emitter,t.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=n.header&&n.header.hasTitle?this.state.viewLabelId:void 0;return preact.createElement(internalCommon.ViewContextType.Provider,{value:s},n.header&&preact.createElement(Toolbar,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:n.header,titleId:l},i)),preact.createElement(ViewHarness,{liquid:a,height:o,aspectRatio:e,labeledById:l},this.renderView(t),this.buildAppendContent()),n.footer&&preact.createElement(Toolbar,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:n.footer,titleId:""},i)))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map((t=>new t(e))),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let n in t)t[n](e[n],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:n}=t.pluginHooks;for(let r in n)t[r]!==e[r]&&n[r](t[r],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map((t=>t(e)));return preact.createElement(preact.Fragment,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:n}=e,r={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},i=this.buildViewPropTransformers(t.viewPropsTransformers);for(let t of i)Object.assign(r,t.transform(r,e));let a=n.component;return preact.createElement(a,Object.assign({},r))}}function buildToolbarProps(e,t,n,r,i,a){let o=n.build(i,void 0,!1),s=n.buildPrev(t,r,!1),l=n.buildNext(t,r,!1);return{title:a,activeButton:e.type,navUnit:e.singleUnit,isTodayEnabled:o.isValid&&!internalCommon.rangeContainsMarker(t.currentRange,i),isPrevEnabled:s.isValid,isNextEnabled:l.isValid}}function buildViewPropTransformers(e){return e.map((e=>new e))}class Calendar extends internalCommon.CalendarImpl{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=e=>{switch(e.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=e=>{this.currentData=e,this.renderRunner.request(e.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:e}=this;internalCommon.flushSync((()=>{preact.render(preact.createElement(internalCommon.CalendarRoot,{options:e.calendarOptions,theme:e.theme,emitter:e.emitter},((t,n,r,i)=>(this.setClassNames(t),this.setHeight(n),preact.createElement(internalCommon.RenderId.Provider,{value:this.customContentRenderId},preact.createElement(CalendarContent,Object.assign({isHeightAuto:r,forPrint:i},e)))))),this.el)}))}else this.isRendered&&(this.isRendered=!1,preact.render(null,this.el),this.setClassNames([]),this.setHeight(""))},internalCommon.ensureElHasStyles(e),this.el=e,this.renderRunner=new internalCommon.DelayedRunner(this.handleRenderRequest),new CalendarDataManager({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){internalCommon.flushSync((()=>{super.updateSize()}))}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!internalCommon.isArraysEqual(e,this.currentClassNames)){let{classList:t}=this.el;for(let e of this.currentClassNames)t.remove(e);for(let n of e)t.add(n);this.currentClassNames=e}}setHeight(e){internalCommon.applyStyleProp(this.el,"height",e)}}function formatDate(e,t={}){let n=buildDateEnv(t),r=internalCommon.createFormatter(t),i=n.createMarkerMeta(e);return i?n.format(i.marker,r,{forcedTzo:i.forcedTzo}):""}function formatRange(e,t,n){let r=buildDateEnv("object"==typeof n&&n?n:{}),i=internalCommon.createFormatter(n),a=r.createMarkerMeta(e),o=r.createMarkerMeta(t);return a&&o?r.formatRange(a.marker,o.marker,i,{forcedStartTzo:a.forcedTzo,forcedEndTzo:o.forcedTzo,isEndExclusive:n.isEndExclusive,defaultSeparator:internalCommon.BASE_OPTION_DEFAULTS.defaultRangeSeparator}):""}function buildDateEnv(e){let t=buildLocale(e.locale||"en",organizeRawLocales([]).map);return new internalCommon.DateEnv(Object.assign(Object.assign({timeZone:internalCommon.BASE_OPTION_DEFAULTS.timeZone,calendarSystem:"gregory"},e),{locale:t}))}function sliceEvents(e,t){return internalCommon.sliceEventStore(e.eventStore,e.eventUiBases,e.dateProfile.activeRange,t?e.nextDayThreshold:null).fg}const version="6.1.14";exports.JsonRequestError=internalCommon.JsonRequestError,exports.Calendar=Calendar,exports.createPlugin=createPlugin,exports.formatDate=formatDate,exports.formatRange=formatRange,exports.globalLocales=globalLocales,exports.globalPlugins=globalPlugins,exports.sliceEvents=sliceEvents,exports.version=version;