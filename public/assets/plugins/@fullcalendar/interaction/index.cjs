"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var index_cjs=require("@fullcalendar/core/index.cjs"),internal_cjs=require("@fullcalendar/core/internal.cjs");internal_cjs.config.touchMouseIgnoreWait=500;let ignoreMouseDepth=0,listenerCnt=0,isWindowTouchMoveCancelled=!1;class PointerDragging{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=e=>{if(!this.shouldIgnoreMouse()&&isPrimaryMouseButton(e)&&this.tryStart(e)){let t=this.createEventFromMouse(e,!0);this.emitter.trigger("pointerdown",t),this.initScrollWatch(t),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=e=>{let t=this.createEventFromMouse(e);this.recordCoords(t),this.emitter.trigger("pointermove",t)},this.handleMouseUp=e=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(e)),this.cleanup()},this.handleTouchStart=e=>{if(this.tryStart(e)){this.isTouchDragging=!0;let t=this.createEventFromTouch(e,!0);this.emitter.trigger("pointerdown",t),this.initScrollWatch(t);let i=e.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove),i.addEventListener("touchend",this.handleTouchEnd),i.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=e=>{let t=this.createEventFromTouch(e);this.recordCoords(t),this.emitter.trigger("pointermove",t)},this.handleTouchEnd=e=>{if(this.isDragging){let t=e.target;t.removeEventListener("touchmove",this.handleTouchMove),t.removeEventListener("touchend",this.handleTouchEnd),t.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(e)),this.cleanup(),this.isTouchDragging=!1,startIgnoringMouse()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=e=>{if(!this.shouldIgnoreMove){let t=window.scrollX-this.prevScrollX+this.prevPageX,i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:e,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:t,pageY:i,deltaX:t-this.origPageX,deltaY:i-this.origPageY})}},this.containerEl=e,this.emitter=new internal_cjs.Emitter,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),listenerCreated()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),listenerDestroyed()}tryStart(e){let t=this.querySubjectEl(e),i=e.target;return!(!t||this.handleSelector&&!internal_cjs.elementClosest(i,this.handleSelector))&&(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0)}cleanup(){isWindowTouchMoveCancelled=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?internal_cjs.elementClosest(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return ignoreMouseDepth||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(isWindowTouchMoveCancelled=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let i=0,n=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(i=e.pageX-this.origPageX,n=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:i,deltaY:n}}createEventFromTouch(e,t){let i,n,r=e.touches,s=0,l=0;return r&&r.length?(i=r[0].pageX,n=r[0].pageY):(i=e.pageX,n=e.pageY),t?(this.origPageX=i,this.origPageY=n):(s=i-this.origPageX,l=n-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:i,pageY:n,deltaX:s,deltaY:l}}}function isPrimaryMouseButton(e){return 0===e.button&&!e.ctrlKey}function startIgnoringMouse(){ignoreMouseDepth+=1,setTimeout((()=>{ignoreMouseDepth-=1}),internal_cjs.config.touchMouseIgnoreWait)}function listenerCreated(){listenerCnt+=1,1===listenerCnt&&window.addEventListener("touchmove",onWindowTouchMove,{passive:!1})}function listenerDestroyed(){listenerCnt-=1,listenerCnt||window.removeEventListener("touchmove",onWindowTouchMove,{passive:!1})}function onWindowTouchMove(e){isWindowTouchMoveCancelled&&e.preventDefault()}class ElementMirror{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,i){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=i-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let i=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(i,this.revertDuration):setTimeout(i,0)}doRevertAnimation(e,t){let i=this.mirrorEl,n=this.sourceEl.getBoundingClientRect();i.style.transition="top "+t+"ms,left "+t+"ms",internal_cjs.applyStyle(i,{left:n.left,top:n.top}),internal_cjs.whenTransitionDone(i,(()=>{i.style.transition="",e()}))}cleanup(){this.mirrorEl&&(internal_cjs.removeElement(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&internal_cjs.applyStyle(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),internal_cjs.applyStyle(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}}class ScrollGeomCache extends internal_cjs.ScrollController{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}}class ElementScrollGeomCache extends ScrollGeomCache{constructor(e,t){super(new internal_cjs.ElementScrollController(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return internal_cjs.computeInnerRect(this.scrollController.el)}}class WindowScrollGeomCache extends ScrollGeomCache{constructor(e){super(new internal_cjs.WindowScrollController,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}}const getTime="function"==typeof performance?performance.now:Date.now;class AutoScroller{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=getTime();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,i){this.isEnabled&&(this.scrollCaches=this.buildCaches(i),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let i=e-window.scrollX,n=t-window.scrollY,r=null===this.pointerScreenY?0:n-this.pointerScreenY,s=null===this.pointerScreenX?0:i-this.pointerScreenX;r<0?this.everMovedUp=!0:r>0&&(this.everMovedDown=!0),s<0?this.everMovedLeft=!0:s>0&&(this.everMovedRight=!0),this.pointerScreenX=i,this.pointerScreenY=n,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(getTime()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:i}=e,{edgeThreshold:n}=this,r=n-e.distance,s=r*r/(n*n)*this.maxVelocity*t,l=1;switch(e.name){case"left":l=-1;case"right":i.setScrollLeft(i.getScrollLeft()+s*l);break;case"top":l=-1;case"bottom":i.setScrollTop(i.getScrollTop()+s*l)}}computeBestEdge(e,t){let{edgeThreshold:i}=this,n=null,r=this.scrollCaches||[];for(let s of r){let r=s.clientRect,l=e-r.left,o=r.right-e,a=t-r.top,c=r.bottom-t;l>=0&&o>=0&&a>=0&&c>=0&&(a<=i&&this.everMovedUp&&s.canScrollUp()&&(!n||n.distance>a)&&(n={scrollCache:s,name:"top",distance:a}),c<=i&&this.everMovedDown&&s.canScrollDown()&&(!n||n.distance>c)&&(n={scrollCache:s,name:"bottom",distance:c}),l<=i&&this.everMovedLeft&&s.canScrollLeft()&&(!n||n.distance>l)&&(n={scrollCache:s,name:"left",distance:l}),o<=i&&this.everMovedRight&&s.canScrollRight()&&(!n||n.distance>o)&&(n={scrollCache:s,name:"right",distance:o}))}return n}buildCaches(e){return this.queryScrollEls(e).map((e=>e===window?new WindowScrollGeomCache(!1):new ElementScrollGeomCache(e,!1)))}queryScrollEls(e){let t=[];for(let i of this.scrollQuery)"object"==typeof i?t.push(i):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(i)));return t}}class FeaturefulElementDragging extends internal_cjs.ElementDragging{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=e=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,internal_cjs.preventSelection(document.body),internal_cjs.preventContextMenu(document.body),e.isTouch||e.origEvent.preventDefault(),this.emitter.trigger("pointerdown",e),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(e.subjectEl,e.pageX,e.pageY),this.startDelay(e),this.minDistance||this.handleDistanceSurpassed(e)))},this.onPointerMove=e=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",e),!this.isDistanceSurpassed){let t,i=this.minDistance,{deltaX:n,deltaY:r}=e;t=n*n+r*r,t>=i*i&&this.handleDistanceSurpassed(e)}this.isDragging&&("scroll"!==e.origEvent.type&&(this.mirror.handleMove(e.pageX,e.pageY),this.autoScroller.handleMove(e.pageX,e.pageY)),this.emitter.trigger("dragmove",e))}},this.onPointerUp=e=>{this.isInteracting&&(this.isInteracting=!1,internal_cjs.allowSelection(document.body),internal_cjs.allowContextMenu(document.body),this.emitter.trigger("pointerup",e),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(e)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let i=this.pointer=new PointerDragging(e);i.emitter.on("pointerdown",this.onPointerDown),i.emitter.on("pointermove",this.onPointerMove),i.emitter.on("pointerup",this.onPointerUp),t&&(i.selector=t),this.mirror=new ElementMirror,this.autoScroller=new AutoScroller}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){"number"==typeof this.delay?this.delayTimeoutId=setTimeout((()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)}),this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(this.pointer.wasTouchScroll&&!this.touchScrollAllowed||(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),!1===this.touchScrollAllowed&&this.pointer.cancelTouchScroll()))}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}}class OffsetTracker{constructor(e){this.el=e,this.origRect=internal_cjs.computeRect(e),this.scrollCaches=internal_cjs.getClippingParents(e).map((e=>new ElementScrollGeomCache(e,!0)))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let i={left:e,top:t};for(let e of this.scrollCaches)if(!isIgnoredClipping(e.getEventTarget())&&!internal_cjs.pointInsideRect(i,e.clientRect))return!1;return!0}}function isIgnoredClipping(e){let t=e.tagName;return"HTML"===t||"BODY"===t}class HitDragging{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=e=>{let{dragging:t}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(e),this.initialHit||!this.requireInitial?(t.setIgnoreMove(!1),this.emitter.trigger("pointerdown",e)):t.setIgnoreMove(!0)},this.handleDragStart=e=>{this.emitter.trigger("dragstart",e),this.handleMove(e,!0)},this.handleDragMove=e=>{this.emitter.trigger("dragmove",e),this.handleMove(e)},this.handlePointerUp=e=>{this.releaseHits(),this.emitter.trigger("pointerup",e)},this.handleDragEnd=e=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,e),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",e)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new internal_cjs.Emitter}processFirstCoord(e){let t,i={left:e.pageX,top:e.pageY},n=i,r=e.subjectEl;r instanceof HTMLElement&&(t=internal_cjs.computeRect(r),n=internal_cjs.constrainPoint(n,t));let s=this.initialHit=this.queryHitForOffset(n.left,n.top);if(s){if(this.useSubjectCenter&&t){let e=internal_cjs.intersectRects(t,s.rect);e&&(n=internal_cjs.getRectCenter(e))}this.coordAdjust=internal_cjs.diffPoints(n,i)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let i=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);!t&&isHitsEqual(this.movingHit,i)||(this.movingHit=i,this.emitter.trigger("hitupdate",i,!1,e))}prepareHits(){this.offsetTrackers=internal_cjs.mapHash(this.droppableStore,(e=>(e.component.prepareHits(),new OffsetTracker(e.el))))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:i,offsetTrackers:n}=this,r=null;for(let s in i){let l=i[s].component,o=n[s];if(o&&o.isWithinClipping(e,t)){let i=o.computeLeft(),n=o.computeTop(),a=e-i,c=t-n,{origRect:h}=o,g=h.right-h.left,d=h.bottom-h.top;if(a>=0&&a<g&&c>=0&&c<d){let e=l.queryHit(a,c,g,d);e&&internal_cjs.rangeContainsRange(e.dateProfile.activeRange,e.dateSpan.range)&&(this.disablePointCheck||o.el.contains(document.elementFromPoint(a+i-window.scrollX,c+n-window.scrollY)))&&(!r||e.layer>r.layer)&&(e.componentId=s,e.context=l.context,e.rect.left+=i,e.rect.right+=i,e.rect.top+=n,e.rect.bottom+=n,r=e)}}}return r}}function isHitsEqual(e,t){return!e&&!t||Boolean(e)===Boolean(t)&&internal_cjs.isDateSpansEqual(e.dateSpan,t.dateSpan)}function buildDatePointApiWithContext(e,t){let i={};for(let n of t.pluginHooks.datePointTransforms)Object.assign(i,n(e,t));return Object.assign(i,buildDatePointApi(e,t.dateEnv)),i}function buildDatePointApi(e,t){return{date:t.toDate(e.range.start),dateStr:t.formatIso(e.range.start,{omitTime:e.allDay}),allDay:e.allDay}}class DateClicking extends internal_cjs.Interaction{constructor(e){super(e),this.handlePointerDown=e=>{let{dragging:t}=this,i=e.origEvent.target;t.setIgnoreMove(!this.component.isValidDateDownEl(i))},this.handleDragEnd=e=>{let{component:t}=this,{pointer:i}=this.dragging;if(!i.wasTouchScroll){let{initialHit:i,finalHit:n}=this.hitDragging;if(i&&n&&isHitsEqual(i,n)){let{context:n}=t,r=Object.assign(Object.assign({},buildDatePointApiWithContext(i.dateSpan,n)),{dayEl:i.dayEl,jsEvent:e.origEvent,view:n.viewApi||n.calendarApi.view});n.emitter.trigger("dateClick",r)}}},this.dragging=new FeaturefulElementDragging(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new HitDragging(this.dragging,internal_cjs.interactionSettingsToStore(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}}class DateSelecting extends internal_cjs.Interaction{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=e=>{let{component:t,dragging:i}=this,{options:n}=t.context,r=n.selectable&&t.isValidDateDownEl(e.origEvent.target);i.setIgnoreMove(!r),i.delay=e.isTouch?getComponentTouchDelay$1(t):null},this.handleDragStart=e=>{this.component.context.calendarApi.unselect(e)},this.handleHitUpdate=(e,t)=>{let{context:i}=this.component,n=null,r=!1;if(e){let t=this.hitDragging.initialHit;e.componentId===t.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(t,e)||(n=joinHitsIntoSelection(t,e,i.pluginHooks.dateSelectionTransformers)),n&&internal_cjs.isDateSelectionValid(n,e.dateProfile,i)||(r=!0,n=null)}n?i.dispatch({type:"SELECT_DATES",selection:n}):t||i.dispatch({type:"UNSELECT_DATES"}),r?internal_cjs.disableCursor():internal_cjs.enableCursor(),t||(this.dragSelection=n)},this.handlePointerUp=e=>{this.dragSelection&&(internal_cjs.triggerDateSelect(this.dragSelection,e,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:i}=t.context,n=this.dragging=new FeaturefulElementDragging(e.el);n.touchScrollAllowed=!1,n.minDistance=i.selectMinDistance||0,n.autoScroller.isEnabled=i.dragScroll;let r=this.hitDragging=new HitDragging(this.dragging,internal_cjs.interactionSettingsToStore(e));r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}}function getComponentTouchDelay$1(e){let{options:t}=e.context,i=t.selectLongPressDelay;return null==i&&(i=t.longPressDelay),i}function joinHitsIntoSelection(e,t,i){let n=e.dateSpan,r=t.dateSpan,s=[n.range.start,n.range.end,r.range.start,r.range.end];s.sort(internal_cjs.compareNumbers);let l={};for(let n of i){let i=n(e,t);if(!1===i)return null;i&&Object.assign(l,i)}return l.range={start:s[0],end:s[3]},l.allDay=n.allDay,l}class EventDragging extends internal_cjs.Interaction{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=e=>{let t=e.origEvent.target,{component:i,dragging:n}=this,{mirror:r}=n,{options:s}=i.context,l=i.context;this.subjectEl=e.subjectEl;let o=this.subjectSeg=internal_cjs.getElSeg(e.subjectEl),a=(this.eventRange=o.eventRange).instance.instanceId;this.relevantEvents=internal_cjs.getRelevantEvents(l.getCurrentData().eventStore,a),n.minDistance=e.isTouch?0:s.eventDragMinDistance,n.delay=e.isTouch&&a!==i.props.eventSelection?getComponentTouchDelay(i):null,s.fixedMirrorParent?r.parentNode=s.fixedMirrorParent:r.parentNode=internal_cjs.elementClosest(t,".fc"),r.revertDuration=s.dragRevertDuration;let c=i.isValidSegDownEl(t)&&!internal_cjs.elementClosest(t,".fc-event-resizer");n.setIgnoreMove(!c),this.isDragging=c&&e.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=e=>{let t=this.component.context,i=this.eventRange,n=i.instance.instanceId;e.isTouch?n!==this.component.props.eventSelection&&t.dispatch({type:"SELECT_EVENT",eventInstanceId:n}):t.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(t.calendarApi.unselect(e),t.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new internal_cjs.EventImpl(t,i.def,i.instance),jsEvent:e.origEvent,view:t.viewApi}))},this.handleHitUpdate=(e,t)=>{if(!this.isDragging)return;let i=this.relevantEvents,n=this.hitDragging.initialHit,r=this.component.context,s=null,l=null,o=null,a=!1,c={affectedEvents:i,mutatedEvents:internal_cjs.createEmptyEventStore(),isEvent:!0};if(e){s=e.context;let t=s.options;r===s||t.editable&&t.droppable?(l=computeEventMutation(n,e,this.eventRange.instance.range.start,s.getCurrentData().pluginHooks.eventDragMutationMassagers),l&&(o=internal_cjs.applyMutationToEventStore(i,s.getCurrentData().eventUiBases,l,s),c.mutatedEvents=o,internal_cjs.isInteractionValid(c,e.dateProfile,s)||(a=!0,l=null,o=null,c.mutatedEvents=internal_cjs.createEmptyEventStore()))):s=null}this.displayDrag(s,c),a?internal_cjs.disableCursor():internal_cjs.enableCursor(),t||(r===s&&isHitsEqual(n,e)&&(l=null),this.dragging.setMirrorNeedsRevert(!l),this.dragging.setMirrorIsVisible(!e||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=s,this.validMutation=l,this.mutatedRelevantEvents=o)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=e=>{if(this.isDragging){let t=this.component.context,i=t.viewApi,{receivingContext:n,validMutation:r}=this,s=this.eventRange.def,l=this.eventRange.instance,o=new internal_cjs.EventImpl(t,s,l),a=this.relevantEvents,c=this.mutatedRelevantEvents,{finalHit:h}=this.hitDragging;if(this.clearDrag(),t.emitter.trigger("eventDragStop",{el:this.subjectEl,event:o,jsEvent:e.origEvent,view:i}),r){if(n===t){let n=new internal_cjs.EventImpl(t,c.defs[s.defId],l?c.instances[l.instanceId]:null);t.dispatch({type:"MERGE_EVENTS",eventStore:c});let h={oldEvent:o,event:n,relatedEvents:internal_cjs.buildEventApis(c,t,l),revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:a})}},g={};for(let e of t.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(g,e(r,t));t.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},h),g),{el:e.subjectEl,delta:r.datesDelta,jsEvent:e.origEvent,view:i})),t.emitter.trigger("eventChange",h)}else if(n){let r={event:o,relatedEvents:internal_cjs.buildEventApis(a,t,l),revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:a})}};t.emitter.trigger("eventLeave",Object.assign(Object.assign({},r),{draggedEl:e.subjectEl,view:i})),t.dispatch({type:"REMOVE_EVENTS",eventStore:a}),t.emitter.trigger("eventRemove",r);let g=c.defs[s.defId],d=c.instances[l.instanceId],u=new internal_cjs.EventImpl(n,g,d);n.dispatch({type:"MERGE_EVENTS",eventStore:c});let p={event:u,relatedEvents:internal_cjs.buildEventApis(c,n,d),revert(){n.dispatch({type:"REMOVE_EVENTS",eventStore:c})}};n.emitter.trigger("eventAdd",p),e.isTouch&&n.dispatch({type:"SELECT_EVENT",eventInstanceId:l.instanceId}),n.emitter.trigger("drop",Object.assign(Object.assign({},buildDatePointApiWithContext(h.dateSpan,n)),{draggedEl:e.subjectEl,jsEvent:e.origEvent,view:h.context.viewApi})),n.emitter.trigger("eventReceive",Object.assign(Object.assign({},p),{draggedEl:e.subjectEl,view:h.context.viewApi}))}}else t.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:i}=t.context,n=this.dragging=new FeaturefulElementDragging(e.el);n.pointer.selector=EventDragging.SELECTOR,n.touchScrollAllowed=!1,n.autoScroller.isEnabled=i.dragScroll;let r=this.hitDragging=new HitDragging(this.dragging,internal_cjs.interactionSettingsStore);r.useSubjectCenter=e.useEventCenter,r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("pointerup",this.handlePointerUp),r.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let i=this.component.context,n=this.receivingContext;n&&n!==e&&(n===i?n.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:internal_cjs.createEmptyEventStore(),isEvent:!0}}):n.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}}function computeEventMutation(e,t,i,n){let r=e.dateSpan,s=t.dateSpan,l=r.range.start,o=s.range.start,a={};r.allDay!==s.allDay&&(a.allDay=s.allDay,a.hasEnd=t.context.options.allDayMaintainDuration,l=s.allDay?internal_cjs.startOfDay(i):i);let c=internal_cjs.diffDates(l,o,e.context.dateEnv,e.componentId===t.componentId?e.largeUnit:null);c.milliseconds&&(a.allDay=!1);let h={datesDelta:c,standardProps:a};for(let i of n)i(h,e,t);return h}function getComponentTouchDelay(e){let{options:t}=e.context,i=t.eventLongPressDelay;return null==i&&(i=t.longPressDelay),i}EventDragging.SELECTOR=".fc-event-draggable, .fc-event-resizable";class EventResizing extends internal_cjs.Interaction{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=e=>{let{component:t}=this,i=this.querySegEl(e),n=internal_cjs.getElSeg(i),r=this.eventRange=n.eventRange;this.dragging.minDistance=t.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(e.origEvent.target)||e.isTouch&&this.component.props.eventSelection!==r.instance.instanceId)},this.handleDragStart=e=>{let{context:t}=this.component,i=this.eventRange;this.relevantEvents=internal_cjs.getRelevantEvents(t.getCurrentData().eventStore,this.eventRange.instance.instanceId);let n=this.querySegEl(e);this.draggingSegEl=n,this.draggingSeg=internal_cjs.getElSeg(n),t.calendarApi.unselect(),t.emitter.trigger("eventResizeStart",{el:n,event:new internal_cjs.EventImpl(t,i.def,i.instance),jsEvent:e.origEvent,view:t.viewApi})},this.handleHitUpdate=(e,t,i)=>{let{context:n}=this.component,r=this.relevantEvents,s=this.hitDragging.initialHit,l=this.eventRange.instance,o=null,a=null,c=!1,h={affectedEvents:r,mutatedEvents:internal_cjs.createEmptyEventStore(),isEvent:!0};if(e){e.componentId===s.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(s,e)||(o=computeMutation(s,e,i.subjectEl.classList.contains("fc-event-resizer-start"),l.range))}o&&(a=internal_cjs.applyMutationToEventStore(r,n.getCurrentData().eventUiBases,o,n),h.mutatedEvents=a,internal_cjs.isInteractionValid(h,e.dateProfile,n)||(c=!0,o=null,a=null,h.mutatedEvents=null)),a?n.dispatch({type:"SET_EVENT_RESIZE",state:h}):n.dispatch({type:"UNSET_EVENT_RESIZE"}),c?internal_cjs.disableCursor():internal_cjs.enableCursor(),t||(o&&isHitsEqual(s,e)&&(o=null),this.validMutation=o,this.mutatedRelevantEvents=a)},this.handleDragEnd=e=>{let{context:t}=this.component,i=this.eventRange.def,n=this.eventRange.instance,r=new internal_cjs.EventImpl(t,i,n),s=this.relevantEvents,l=this.mutatedRelevantEvents;if(t.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:r,jsEvent:e.origEvent,view:t.viewApi}),this.validMutation){let o=new internal_cjs.EventImpl(t,l.defs[i.defId],n?l.instances[n.instanceId]:null);t.dispatch({type:"MERGE_EVENTS",eventStore:l});let a={oldEvent:r,event:o,relatedEvents:internal_cjs.buildEventApis(l,t,n),revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:s})}};t.emitter.trigger("eventResize",Object.assign(Object.assign({},a),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||internal_cjs.createDuration(0),endDelta:this.validMutation.endDelta||internal_cjs.createDuration(0),jsEvent:e.origEvent,view:t.viewApi})),t.emitter.trigger("eventChange",a)}else t.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,i=this.dragging=new FeaturefulElementDragging(e.el);i.pointer.selector=".fc-event-resizer",i.touchScrollAllowed=!1,i.autoScroller.isEnabled=t.context.options.dragScroll;let n=this.hitDragging=new HitDragging(this.dragging,internal_cjs.interactionSettingsToStore(e));n.emitter.on("pointerdown",this.handlePointerDown),n.emitter.on("dragstart",this.handleDragStart),n.emitter.on("hitupdate",this.handleHitUpdate),n.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return internal_cjs.elementClosest(e.subjectEl,".fc-event")}}function computeMutation(e,t,i,n){let r=e.context.dateEnv,s=e.dateSpan.range.start,l=t.dateSpan.range.start,o=internal_cjs.diffDates(s,l,r,e.largeUnit);if(i){if(r.add(n.start,o)<n.end)return{startDelta:o}}else if(r.add(n.end,o)>n.start)return{endDelta:o};return null}class UnselectAuto{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=e=>{e.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=e=>{let t=this.context.options.unselectCancel,i=internal_cjs.getEventTargetViaRoot(e.origEvent);this.matchesCancel=!!internal_cjs.elementClosest(i,t),this.matchesEvent=!!internal_cjs.elementClosest(i,EventDragging.SELECTOR)},this.onDocumentPointerUp=e=>{let{context:t}=this,{documentPointer:i}=this,n=t.getCurrentData();if(!i.wasTouchScroll){if(n.dateSelection&&!this.isRecentPointerDateSelect){let i=t.options.unselectAuto;!i||i&&this.matchesCancel||t.calendarApi.unselect(e)}n.eventSelection&&!this.matchesEvent&&t.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new PointerDragging(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}}const OPTION_REFINERS={fixedMirrorParent:internal_cjs.identity},LISTENER_REFINERS={dateClick:internal_cjs.identity,eventDragStart:internal_cjs.identity,eventDragStop:internal_cjs.identity,eventDrop:internal_cjs.identity,eventResizeStart:internal_cjs.identity,eventResizeStop:internal_cjs.identity,eventResize:internal_cjs.identity,drop:internal_cjs.identity,eventReceive:internal_cjs.identity,eventLeave:internal_cjs.identity};class ExternalElementDragging{constructor(e,t){this.receivingContext=null,this.droppableEvent=null,this.suppliedDragMeta=null,this.dragMeta=null,this.handleDragStart=e=>{this.dragMeta=this.buildDragMeta(e.subjectEl)},this.handleHitUpdate=(e,t,i)=>{let{dragging:n}=this.hitDragging,r=null,s=null,l=!1,o={affectedEvents:internal_cjs.createEmptyEventStore(),mutatedEvents:internal_cjs.createEmptyEventStore(),isEvent:this.dragMeta.create};e&&(r=e.context,this.canDropElOnCalendar(i.subjectEl,r)&&(s=computeEventForDateSpan(e.dateSpan,this.dragMeta,r),o.mutatedEvents=internal_cjs.eventTupleToStore(s),l=!internal_cjs.isInteractionValid(o,e.dateProfile,r),l&&(o.mutatedEvents=internal_cjs.createEmptyEventStore(),s=null))),this.displayDrag(r,o),n.setMirrorIsVisible(t||!s||!document.querySelector(".fc-event-mirror")),l?internal_cjs.disableCursor():internal_cjs.enableCursor(),t||(n.setMirrorNeedsRevert(!s),this.receivingContext=r,this.droppableEvent=s)},this.handleDragEnd=e=>{let{receivingContext:t,droppableEvent:i}=this;if(this.clearDrag(),t&&i){let n=this.hitDragging.finalHit,r=n.context.viewApi,s=this.dragMeta;if(t.emitter.trigger("drop",Object.assign(Object.assign({},buildDatePointApiWithContext(n.dateSpan,t)),{draggedEl:e.subjectEl,jsEvent:e.origEvent,view:r})),s.create){let n=internal_cjs.eventTupleToStore(i);t.dispatch({type:"MERGE_EVENTS",eventStore:n}),e.isTouch&&t.dispatch({type:"SELECT_EVENT",eventInstanceId:i.instance.instanceId}),t.emitter.trigger("eventReceive",{event:new internal_cjs.EventImpl(t,i.def,i.instance),relatedEvents:[],revert(){t.dispatch({type:"REMOVE_EVENTS",eventStore:n})},draggedEl:e.subjectEl,view:r})}}this.receivingContext=null,this.droppableEvent=null};let i=this.hitDragging=new HitDragging(e,internal_cjs.interactionSettingsStore);i.requireInitial=!1,i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("dragend",this.handleDragEnd),this.suppliedDragMeta=t}buildDragMeta(e){return"object"==typeof this.suppliedDragMeta?internal_cjs.parseDragMeta(this.suppliedDragMeta):"function"==typeof this.suppliedDragMeta?internal_cjs.parseDragMeta(this.suppliedDragMeta(e)):getDragMetaFromEl(e)}displayDrag(e,t){let i=this.receivingContext;i&&i!==e&&i.dispatch({type:"UNSET_EVENT_DRAG"}),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){this.receivingContext&&this.receivingContext.dispatch({type:"UNSET_EVENT_DRAG"})}canDropElOnCalendar(e,t){let i=t.options.dropAccept;return"function"==typeof i?i.call(t.calendarApi,e):"string"!=typeof i||!i||Boolean(internal_cjs.elementMatches(e,i))}}function computeEventForDateSpan(e,t,i){let n=Object.assign({},t.leftoverProps);for(let r of i.pluginHooks.externalDefTransforms)Object.assign(n,r(e,t));let{refined:r,extra:s}=internal_cjs.refineEventDef(n,i),l=internal_cjs.parseEventDef(r,s,t.sourceId,e.allDay,i.options.forceEventDuration||Boolean(t.duration),i),o=e.range.start;e.allDay&&t.startTime&&(o=i.dateEnv.add(o,t.startTime));let a=t.duration?i.dateEnv.add(o,t.duration):internal_cjs.getDefaultEventEnd(e.allDay,o,i);return{def:l,instance:internal_cjs.createEventInstance(l.defId,{start:o,end:a})}}function getDragMetaFromEl(e){let t=getEmbeddedElData(e,"event"),i=t?JSON.parse(t):{create:!1};return internal_cjs.parseDragMeta(i)}function getEmbeddedElData(e,t){let i=internal_cjs.config.dataAttrPrefix,n=(i?i+"-":"")+t;return e.getAttribute("data-"+n)||""}internal_cjs.config.dataAttrPrefix="";class ExternalDraggable{constructor(e,t={}){this.handlePointerDown=e=>{let{dragging:t}=this,{minDistance:i,longPressDelay:n}=this.settings;t.minDistance=null!=i?i:e.isTouch?0:internal_cjs.BASE_OPTION_DEFAULTS.eventDragMinDistance,t.delay=e.isTouch?null!=n?n:internal_cjs.BASE_OPTION_DEFAULTS.longPressDelay:0},this.handleDragStart=e=>{e.isTouch&&this.dragging.delay&&e.subjectEl.classList.contains("fc-event")&&this.dragging.mirror.getMirrorEl().classList.add("fc-event-selected")},this.settings=t;let i=this.dragging=new FeaturefulElementDragging(e);i.touchScrollAllowed=!1,null!=t.itemSelector&&(i.pointer.selector=t.itemSelector),null!=t.appendTo&&(i.mirror.parentNode=t.appendTo),i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),new ExternalElementDragging(i,t.eventData)}destroy(){this.dragging.destroy()}}class InferredElementDragging extends internal_cjs.ElementDragging{constructor(e){super(e),this.shouldIgnoreMove=!1,this.mirrorSelector="",this.currentMirrorEl=null,this.handlePointerDown=e=>{this.emitter.trigger("pointerdown",e),this.shouldIgnoreMove||this.emitter.trigger("dragstart",e)},this.handlePointerMove=e=>{this.shouldIgnoreMove||this.emitter.trigger("dragmove",e)},this.handlePointerUp=e=>{this.emitter.trigger("pointerup",e),this.shouldIgnoreMove||this.emitter.trigger("dragend",e)};let t=this.pointer=new PointerDragging(e);t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("pointermove",this.handlePointerMove),t.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.pointer.destroy()}setIgnoreMove(e){this.shouldIgnoreMove=e}setMirrorIsVisible(e){if(e)this.currentMirrorEl&&(this.currentMirrorEl.style.visibility="",this.currentMirrorEl=null);else{let e=this.mirrorSelector?document.querySelector(this.mirrorSelector):null;e&&(this.currentMirrorEl=e,e.style.visibility="hidden")}}}class ThirdPartyDraggable{constructor(e,t){let i=document;e===document||e instanceof Element?(i=e,t=t||{}):t=e||{};let n=this.dragging=new InferredElementDragging(i);"string"==typeof t.itemSelector?n.pointer.selector=t.itemSelector:i===document&&(n.pointer.selector="[data-event]"),"string"==typeof t.mirrorSelector&&(n.mirrorSelector=t.mirrorSelector),new ExternalElementDragging(n,t.eventData).hitDragging.disablePointCheck=!0}destroy(){this.dragging.destroy()}}var index=index_cjs.createPlugin({name:"@fullcalendar/interaction",componentInteractions:[DateClicking,DateSelecting,EventDragging,EventResizing],calendarInteractions:[UnselectAuto],elementDraggingImpl:FeaturefulElementDragging,optionRefiners:OPTION_REFINERS,listenerRefiners:LISTENER_REFINERS});exports.Draggable=ExternalDraggable,exports.ThirdPartyDraggable=ThirdPartyDraggable,exports.default=index;