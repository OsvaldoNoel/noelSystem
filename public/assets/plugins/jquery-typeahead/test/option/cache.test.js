const $=require("jquery"),LZString=require("lz-string"),Typeahead=require("../../src/jquery.typeahead");window.LZString=LZString,describe("Typeahead cache option Tests",(()=>{"use strict";let e;function t(){var e={};return{setItem:function(t,o){e[t]=o||""},getItem:function(t){return t in e?e[t]:null},removeItem:function(t){delete e[t]},get length(){return Object.keys(e).length},key:function(t){return Object.keys(e)[t]||null},clear:function(){e={}}}}beforeAll((()=>{window.localStorage=t(),window.sessionStorage=t()})),describe("Typeahead cache option Tests - Global configuration",(()=>{let o=0,r=0,n=0;beforeAll((()=>{window.localStorage=t(),window.sessionStorage=t(),document.body.innerHTML='<input class="js-typeahead">',e=$.typeahead({input:".js-typeahead",minLength:0,generateOnLoad:!0,cache:!0,source:{group1:{data:function(){return o++,["group1-item1","group1-item2","group1-item3"]}},group2:{dynamic:!0,data:function(){return r++,["group2-item1","group2-item2","group2-item3"]}},group3:{cache:!1,dynamic:!0,data:function(){return n++,["group3-item1","group3-item2","group3-item3"]}}}})})),it("Should store in cache the configured groups",(t=>{expect(o).toEqual(1),expect(r).toEqual(1),expect(n).toEqual(1),expect(window.localStorage.getItem("TYPEAHEAD_"+e.selector+":group1")).not.toBe(null),expect(window.localStorage.getItem("TYPEAHEAD_"+e.selector+":group2")).not.toBe(null),expect(window.localStorage.getItem("TYPEAHEAD_"+e.selector+":group3")).toBe(null),e.node.val("group").triggerHandler("input").done((function(e){expect(o).toEqual(1),expect(r).toEqual(1),expect(n).toEqual(2),t()}))})),afterAll((()=>{window.localStorage.clear()}))})),describe("Typeahead cache option Tests - Group configuration",(()=>{beforeAll((()=>{document.body.innerHTML='<input class="js-typeahead">',e=$.typeahead({input:".js-typeahead",minLength:0,generateOnLoad:!0,source:{group1:{cache:!0,compression:!0,data:function(){return["group1-item1","group1-item2","group1-item3"]}},group2:{cache:"sessionStorage",data:function(){return["group2-item1","group2-item2","group2-item3"]}},group3:{data:function(){return["group3-item1","group3-item2","group3-item3"]}}}})})),it("Should store in cache the configured groups",(()=>{expect(window.localStorage.getItem("TYPEAHEAD_"+e.selector+":group1")).not.toBe(null),expect(window.sessionStorage.getItem("TYPEAHEAD_"+e.selector+":group2")).not.toBe(null),expect(window.sessionStorage.getItem("TYPEAHEAD_"+e.selector+":group3")).toBe(null)})),afterAll((()=>{window.localStorage.clear(),window.sessionStorage.clear()}))}))}));