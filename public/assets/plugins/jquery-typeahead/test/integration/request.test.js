const $=require("jquery"),Typeahead=require("../../src/jquery.typeahead");describe("Typeahead request Tests",(()=>{"use strict";let e,t=!1,n=!1,a=!1,r=!1,o=!1,u=!1;describe("$ajax.request as an Object",(()=>{beforeAll((function(){document.body.innerHTML='<input class="js-typeahead">',e=$.typeahead({input:".js-typeahead",minLength:0,dynamic:!0,source:{ajax:{url:"http://test.com/category.json",path:"data",beforeSend:function(e,n){t=!0},complete:()=>{n=!0},callback:{done:function(e){return a=!0,"sp"==this.query&&(e.data[0].newKey="newKey"),e},fail:()=>{r=!0},then:()=>{o=!0},always:()=>{u=!0}}}}})})),it("should merge Typeahead $.ajax object",(d=>{e.node.triggerHandler("input").done((function(){setTimeout((()=>{expect(e.source.group.length).toBeGreaterThan(10),expect(t).toBeTruthy(),expect(n).toBeTruthy(),expect(a).toBeTruthy(),expect(r).toBeFalsy(),expect(o).toBeTruthy(),expect(u).toBeTruthy(),expect(!!~e.requests.group.request.beforeSend.toString().indexOf("scope.xhr[group]")).toBeTruthy(),d()}),10)}))})),it("should have modified the data object `from callback.done` if query == sp",(t=>{e.node.triggerHandler("input").done((function(){expect(e.result[0].newKey).toBeUndefined(),e.node.val("sp"),e.node.triggerHandler("input").done((function(){expect(e.result[0].newKey).toBeDefined(),expect(e.result[0].invalidKey).toBeUndefined(),t()}))}))}))})),describe("$ajax.request as an Array",(()=>{beforeAll((function(){t=!1,n=!1,a=!1,r=!1,o=!1,u=!1,document.body.innerHTML='<input class="js-typeahead">',e=$.typeahead({input:".js-typeahead",minLength:0,source:{ajax:function(e){return{url:`http://test.com/tag.json?q=${e}`,path:"data",beforeSend:function(e,n){t=!0},complete:()=>{n=!0},callback:{done:function(e){return a=!0,e},fail:()=>{r=!0},then:()=>{o=!0},always:()=>{u=!0}}}}}})})),it("should merge Typeahead Array into $.ajax object",(d=>{e.node.val("test"),e.node.triggerHandler("input").done((function(){setTimeout((()=>{expect(!!~e.requests.group.request.url.indexOf("?q=test")).toBeTruthy(),expect(e.source.group.length).toBeGreaterThan(10),expect(t&&n&&a&&o&&u).toBeTruthy(),expect(n).toBeTruthy(),expect(a).toBeTruthy(),expect(r).toBeFalsy(),expect(o).toBeTruthy(),expect(u).toBeTruthy(),expect(!!~e.requests.group.request.beforeSend.toString().indexOf("scope.xhr[group]")).toBeTruthy(),d()}),10)}))}))})),describe("$ajax.request should have variable GET data",(()=>{beforeAll((()=>{document.body.innerHTML='<input class="js-typeahead">',e=$.typeahead({input:".js-typeahead",minLength:0,dynamic:!0,source:{ajax:function(e){var t={hi:1,hello:2};return"q"==e&&(t.hey=3),{url:`http://test.com/tag.json?q=${e}`,data:t,path:"data"}}}})})),it("should merge Typeahead $.ajax.data dynamically when ajax is a function",(t=>{e.node.val("test"),e.node.triggerHandler("input").done((function(){expect(Object.keys(e.requests.group.request.data).length).toEqual(2),e.node.val("q"),e.node.triggerHandler("input").done((function(){expect(Object.keys(e.requests.group.request.data).length).toEqual(3),e.node.val("test"),e.node.triggerHandler("input").done((function(){expect(Object.keys(e.requests.group.request.data).length).toEqual(2),t()}))}))}))}))}))}));