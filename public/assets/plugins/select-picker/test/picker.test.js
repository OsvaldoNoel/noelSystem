"use strict";jasmine.getFixtures().fixturesPath="base/test/fixtures";var fillOptions=function(t,e){for(var i=t instanceof jQuery?t:$(t),n=0;n<e;n++)i.append($("<option value='"+n+"'>"+n+"</option>"))},createRandomArray=function(t,e,i,n){for(var c=[];c.length<t;){for(var r=Math.floor(Math.random()*(i-e+1))+e,a=!1,o=0;o<c.length;o++)if(c[o]==r){a=!0;break}a||(c[c.length]=n?r+"":r)}return c};describe("Single Picker - ",(function(){beforeEach((function(){loadFixtures("single.fixture.html")})),it("Standard init",(function(){var t=$("#test");fillOptions(t,5);var e=$(".container");t.picker({texts:{trigger:"aaa",noResult:"bbb",search:"ccc"}}),expect(t).toBeHidden(),expect(e).toContainElement("div.picker"),expect(e).toContainElement("span.pc-select"),expect(e).toContainElement("span.pc-list"),expect(e).toContainElement("span.pc-element.pc-trigger"),expect(e.find(".picker > .pc-select > .pc-list > ul > li")).toHaveLength(5),expect(e.find(".pc-element")).toContainText(t.find("option:eq(0)").text())})),it("No options init",(function(){var t=$("#test"),e=$(".container");t.picker(),expect(t).toBeVisible(),expect(e).not.toContainElement("div.picker")})),it("Big number of choices init",(function(){var t=$("#test");fillOptions(t,1e3);var e=$(".container");t.picker(),expect(t).toBeHidden(),expect(e).toContainElement("div.picker"),expect(e.find(".picker > .pc-select > .pc-list > ul > li")).toHaveLength(1e3)})),it("List building",(function(){var t=$("#test");fillOptions(t,5);var e=$(".container");t.picker();var i=e.find(".picker > .pc-select > .pc-list > ul > li");expect(i).toHaveLength(5),i.each((function(){var e=t.find("option[value='"+$(this).data("id")+"']").text();expect($(this)).toContainText(e)}))})),it("Select option",(function(){var t=$("#test");fillOptions(t,5);var e=$(".container");t.picker(),e.find(".picker > .pc-select > .pc-list > ul > li").each((function(){$(this).click(),expect(e.find(".pc-element")).toContainText($(this).text()),expect(t.find("option[value='"+$(this).data("id")+"']")).toHaveAttr("selected")}))})),it("Hidden attribute",(function(){var t=$("#test");t.append($("<option value='' disabled hidden>hidden</option>")),fillOptions(t,5);var e=$(".container");t.picker(),expect(e.find(".picker > .pc-select > .pc-list > ul > li")).toHaveLength(5),expect(e).not.toContainElement(".pc-list li:contains('Placeholder')")}))})),describe("Multi-selection Picker - ",(function(){beforeEach((function(){loadFixtures("multiple.fixture.html")})),it("Init",(function(){var t=$("#test");fillOptions(t,5);var e=$(".container");t.picker({texts:{trigger:"Random"}}),expect(t).toBeHidden(),expect(e).toContainElement("div.picker"),expect(e).toContainElement("span.pc-select"),expect(e).toContainElement("span.pc-list"),expect(e).toContainElement("span.pc-element.pc-trigger"),expect(e.find(".picker > .pc-select > .pc-list > ul > li")).toHaveLength(5),expect(e.find(".pc-trigger")).toHaveText(t.find("option:eq(0)").text())})),it("Auto init",(function(){var t=$("#test");t.attr("multiple","multiple"),fillOptions(t,5);var e=$(".container");t.picker(),e.find(".pc-list li").first().click(),expect(e).toContainElement(".pc-element:not(.pc-trigger)")})),it("Select one value",(function(){var t=$("#test");fillOptions(t,5);var e=$(".container");t.picker();var i=e.find(".picker > .pc-select > .pc-list > ul > li").first();i.click(),expect(t.find("option[value='"+i.data("id")+"']")).toHaveAttr("selected"),expect(i[0]).not.toBeInDOM(),expect(e.find(".picker li[data-id='"+i.data("id")+"']")).not.toExist();var n=e.find(".pc-element[data-id='"+i.data("id")+"']");expect(n[0]).toExist(),n.find(".pc-close").click(),expect(e.find(".pc-element[data-id='"+i.data("id")+"']")).not.toExist(),expect(t.find("option[value='"+i.data("id")+"']")).not.toHaveAttr("selected"),expect(e.find(".picker li[data-id='"+i.data("id")+"']")).toExist()})),it("Selecting all values",(function(){var t=$("#test");fillOptions(t,5);var e=$(".container");t.picker(),e.find(".picker > .pc-select > .pc-list > ul > li").each((function(){var i=$(this);i.click(),expect(t.find("option[value='"+i.data("id")+"']")).toHaveAttr("selected"),expect(this).not.toBeInDOM(),expect(e.find(".picker li[data-id='"+i.data("id")+"']")).not.toExist()})),expect(e.find(".pc-trigger")).toBeHidden();var i=e.find(".pc-element:not(.pc-trigger)").first();i.find(".pc-close").click(),expect(e.find(".pc-element[data-id='"+i.data("id")+"']")).not.toExist(),expect(t.find("option[value='"+i.data("id")+"']")).not.toHaveAttr("selected"),expect(e.find(".picker li[data-id='"+i.data("id")+"']")).toExist(),expect(e.find(".pc-trigger")).toBeVisible(),e.find(".pc-element:not(.pc-trigger)").each((function(){var i=$(this);i.find(".pc-close").click(),expect(e.find(".pc-element[data-id='"+i.data("id")+"']")).not.toExist(),expect(t.find("option[value='"+i.data("id")+"']")).not.toHaveAttr("selected"),expect(e.find(".picker li[data-id='"+i.data("id")+"']")).toExist()}))})),it("Respecting original order of options",(function(){var t=100,e=$("#test");fillOptions(e,t);var i=$(".container");e.picker();for(var n=function(t){for(var e,i,n=t.length;n;e=Math.floor(Math.random()*n),i=t[--n],t[n]=t[e],t[e]=i);return t},c=function(){var t=i.find(".pc-list li");if(1!=t.length)for(var e,n,c,r=1;r<t.length-1;r++){if(e=parseInt($(t[r]).data("id")),r==t.length-1&&e<parseInt($(t[r-1]).data("id")))return void fail("Order is not matching!");n=parseInt($(t[r-1]).data("id")),c=parseInt($(t[r+1]).data("id")),(e<n||e>c)&&fail("Order is not matching!")}},r=n(Array.apply(null,{length:t}).map(Number.call,Number)),a=0;a<t;a++)i.find(".pc-list li[data-id='"+r[a]+"']").click();expect(i.find(".pc-trigger")).toBeHidden();var o=n(r);for(a=0;a<t;a++)i.find(".pc-element[data-id='"+o[a]+"'] .pc-close").click(),c()})),it("Data loading",(function(){var t=$("#test");fillOptions(t,50);var e=$(".container"),i=createRandomArray(20,0,49);i.forEach((function(t){e.find("option[value='"+t+"']").attr("selected","selected")})),t.picker(),i.forEach((function(t){expect(e).toContainElement(".pc-element[data-id='"+t+"']")}))})),it("Limited options",(function(){var t=$("#test");fillOptions(t,50);var e=$(".container");t.picker({limit:10}),createRandomArray(10,0,49).forEach((function(t){e.find(".pc-list ul li[data-id='"+t+"']").click()})),expect(e.find(".pc-trigger")).toBeHidden(),e.find(".pc-element:not(.pc-trigger) .pc-close").first().click(),expect(e.find(".pc-trigger")).toBeVisible()}))})),describe("Picker configuration - ",(function(){beforeEach((function(){loadFixtures("single.fixture.html")})),it("container class",(function(){var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker({containerClass:"testClass"}),expect(e).toContainElement(".testClass.picker")})),it("container width",(function(){var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker({containerWidth:100}),expect(e.find(".picker").width()).toEqual(100),expect(e.find(".picker")).toHaveAttr("style")})),it("list width",(function(){var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker({width:100}),expect(e.find(".picker .pc-list").attr("style")).toMatch("width:100px;")})),it("texts",(function(){var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker({search:!0,texts:{trigger:"aaa",noResult:"bbb",search:"ccc"}});var i=e.find(".pc-list input[type='search']");expect(e.find(".pc-trigger")).toContainText(t.find("option:eq(0)").text()),expect(i.attr("placeholder")).toBe("ccc"),i.val("asd"),i.trigger("input"),expect(e.find("li.not-found")).toContainText("bbb")}))})),describe("Picker API - ",(function(){it("destroy",(function(){loadFixtures("single.fixture.html");var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker(),expect(e).toContainElement(".picker"),t.picker("destroy"),expect(e).not.toContainElement(".picker")})),it("get (single)",(function(){loadFixtures("single.fixture.html");var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker();var i=$(e.find(".pc-list li")[3]);i.click(),setTimeout((function(){expect(t.picker("get")).toBe(i.data("id")+"")}),200)})),it("get (multiple) - one item",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker();var i=$(e.find(".pc-list li")[3]);i.click(),expect(t.picker("get")).toEqual([i.data("id")+""])})),it("get (multiple) - several items",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker();var i=e.find(".pc-list li"),n=createRandomArray(4,0,9);n.forEach((function(t){$(i[t]).click()})),n.sort(),expect(t.picker("get")).toEqual(n.map((function(t){return t+""})))})),it("set (single)",(function(){loadFixtures("single.fixture.html");var t=$("#test");fillOptions(t,10),t.picker(),t.picker("set",4),setTimeout((function(){expect(t.picker("get")).toBe("4")}),200)})),it("set (multiple)",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10),t.picker(),t.picker("set",2),t.picker("set",4),t.picker("set",6),expect(t.picker("get")).toEqual(["2","4","6"])})),it("remove - after natural click",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10);var e=$(".container");t.picker();var i=e.find(".pc-list li"),n=[2,4,7,8,9];n.forEach((function(t){$(i[t]).click()})),n.sort(),expect(t.picker("get")).toEqual(n.map((function(t){return t+""}))),t.picker("remove",8),expect(t.picker("get")).toEqual(["2","4","7","9"])})),it("remove - after using 'set'",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10),t.picker(),t.picker("set",2),t.picker("set",4),t.picker("set",6),expect(t.picker("get")).toEqual(["2","4","6"]),t.picker("remove",6),expect(t.picker("get")).toEqual(["2","4"])}))})),describe("Picker Events - ",(function(){it("sp-change event - single mode",(function(){loadFixtures("single.fixture.html");var t=$("#test");fillOptions(t,10),t.picker();var e=spyOnEvent("#test","sp-change");$(".container").find(".picker > .pc-select > .pc-list > ul > li").first().click(),expect(e).toHaveBeenTriggered()})),it("sp-change event - multiple mode",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10),t.picker();var e=$(".container"),i=spyOnEvent("#test","sp-change");e.find(".picker > .pc-select > .pc-list > ul > li").each((function(){$(this).click(),expect(i).toHaveBeenTriggered(),i.reset()})),e.find(".pc-element:not(.pc-trigger)").each((function(){$(this).find(".pc-close").click(),expect(i).toHaveBeenTriggered(),i.reset()}))})),it("sp-change event - API set/remove",(function(){loadFixtures("multiple.fixture.html");var t=$("#test");fillOptions(t,10),t.picker();var e=spyOnEvent("#test","sp-change");t.picker("set",1),expect(e).toHaveBeenTriggered(),e.reset(),t.picker("remove",1),expect(e).toHaveBeenTriggered()})),it("sp-open/sp-close event",(function(){loadFixtures("single.fixture.html");var t=$("#test");fillOptions(t,10),t.picker();var e=spyOnEvent("#test","sp-open"),i=spyOnEvent("#test","sp-close"),n=$(".container .pc-element.pc-trigger");n.click(),expect(e).toHaveBeenTriggered(),n.click(),expect(i).toHaveBeenTriggered()}))}));