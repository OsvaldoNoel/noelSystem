import Eventable from"./eventable.js";import{getElementsFromOption}from"../util/util.js";import Content from"../slide/content.js";import{lazyLoadData}from"../slide/loader.js";class PhotoSwipeBase extends Eventable{getNumItems(){let t=0;const e=this.options?.dataSource;e&&"length"in e?t=e.length:e&&"gallery"in e&&(e.items||(e.items=this._getGalleryDOMElements(e.gallery)),e.items&&(t=e.items.length));const s=this.dispatch("numItems",{dataSource:e,numItems:t});return this.applyFilters("numItems",s.numItems,e)}createContentFromData(t,e){return new Content(t,this,e)}getItemData(t){const e=this.options?.dataSource;let s={};Array.isArray(e)?s=e[t]:e&&"gallery"in e&&(e.items||(e.items=this._getGalleryDOMElements(e.gallery)),s=e.items[t]);let a=s;a instanceof Element&&(a=this._domElementToItemData(a));const i=this.dispatch("itemData",{itemData:a||{},index:t});return this.applyFilters("itemData",i.itemData,t)}_getGalleryDOMElements(t){return this.options?.children||this.options?.childSelector?getElementsFromOption(this.options.children,this.options.childSelector,t)||[]:[t]}_domElementToItemData(t){const e={element:t},s="A"===t.tagName?t:t.querySelector("a");if(s){e.src=s.dataset.pswpSrc||s.href,s.dataset.pswpSrcset&&(e.srcset=s.dataset.pswpSrcset),e.width=s.dataset.pswpWidth?parseInt(s.dataset.pswpWidth,10):0,e.height=s.dataset.pswpHeight?parseInt(s.dataset.pswpHeight,10):0,e.w=e.width,e.h=e.height,s.dataset.pswpType&&(e.type=s.dataset.pswpType);const a=t.querySelector("img");a&&(e.msrc=a.currentSrc||a.src,e.alt=a.getAttribute("alt")??""),(s.dataset.pswpCropped||s.dataset.cropped)&&(e.thumbCropped=!0)}return this.applyFilters("domItemData",e,t,s)}lazyLoadData(t,e){return lazyLoadData(t,this,e)}}export default PhotoSwipeBase;