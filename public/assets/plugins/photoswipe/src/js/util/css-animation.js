import{setTransitionStyle,removeTransitionStyle}from"./util.js";const DEFAULT_EASING="cubic-bezier(.4,0,.22,1)";class CSSAnimation{constructor(i){this.props=i;const{target:t,onComplete:n,transform:e,onFinish:s=(()=>{}),duration:o=333,easing:r=DEFAULT_EASING}=i;this.onFinish=s;const a=e?"transform":"opacity",h=i[a]??"";this._target=t,this._onComplete=n,this._finished=!1,this._onTransitionEnd=this._onTransitionEnd.bind(this),this._helperTimeout=setTimeout((()=>{setTransitionStyle(t,a,o,r),this._helperTimeout=setTimeout((()=>{t.addEventListener("transitionend",this._onTransitionEnd,!1),t.addEventListener("transitioncancel",this._onTransitionEnd,!1),this._helperTimeout=setTimeout((()=>{this._finalizeAnimation()}),o+500),t.style[a]=h}),30)}),0)}_onTransitionEnd(i){i.target===this._target&&this._finalizeAnimation()}_finalizeAnimation(){this._finished||(this._finished=!0,this.onFinish(),this._onComplete&&this._onComplete())}destroy(){this._helperTimeout&&clearTimeout(this._helperTimeout),removeTransitionStyle(this._target),this._target.removeEventListener("transitionend",this._onTransitionEnd,!1),this._target.removeEventListener("transitioncancel",this._onTransitionEnd,!1),this._finished||this._finalizeAnimation()}}export default CSSAnimation;