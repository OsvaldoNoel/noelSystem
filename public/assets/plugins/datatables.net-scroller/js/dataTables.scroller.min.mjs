/*! For license information please see dataTables.scroller.min.mjs.LICENSE.txt */
import t from"jquery";import s from"datatables.net";let o=t;var e=function(t,s){this instanceof e?(void 0===s&&(s={}),t=o.fn.dataTable.Api(t),this.s={dt:t.settings()[0],dtApi:t,tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,autoHeight:!0,viewportRows:0,stateTO:null,stateSaveThrottle:function(){},drawTO:null,heights:{jump:null,page:null,virtual:null,scroll:null,row:null,viewport:null,labelHeight:0,xbar:0},topRowFloat:0,scrollDrawDiff:null,loaderVisible:!1,forceReposition:!1,baseRowTop:0,baseScrollTop:0,mousedown:!1,lastScrollTop:0},this.s=o.extend(this.s,e.oDefaults,s),this.s.heights.row=this.s.rowHeight,this.dom={force:document.createElement("div"),label:o('<div class="dts_label">0</div>'),scroller:null,table:null,loader:null},this.s.dt.oScroller||(this.s.dt.oScroller=this).construct()):alert("Scroller warning: Scroller must be initialised with the 'new' keyword.")},i=(o.extend(e.prototype,{measure:function(t){this.s.autoHeight&&this._calcRowHeight();var s=this.s.heights,e=(s.row&&(s.viewport=this._parseHeight(o(this.dom.scroller).css("max-height")),this.s.viewportRows=parseInt(s.viewport/s.row,10)+1,this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer),this.dom.label.outerHeight());s.xbar=this.dom.scroller.offsetHeight-this.dom.scroller.clientHeight,s.labelHeight=e,void 0!==t&&!t||this.s.dtApi.draw(!1)},pageInfo:function(){var t=this.s.dt,s=this.dom.scroller.scrollTop,o=(t=t.fnRecordsDisplay(),Math.ceil(this.pixelsToRow(s+this.s.heights.viewport,!1,this.s.ani)));return{start:Math.floor(this.pixelsToRow(s,!1,this.s.ani)),end:t<o?t-1:o-1}},pixelsToRow:function(t,s,o){return t-=this.s.baseScrollTop,o=o?(this._domain("physicalToVirtual",this.s.baseScrollTop)+t)/this.s.heights.row:t/this.s.heights.row+this.s.baseRowTop,s||void 0===s?parseInt(o,10):o},rowToPixels:function(t,s,o){return t-=this.s.baseRowTop,o=o?this._domain("virtualToPhysical",this.s.baseScrollTop):this.s.baseScrollTop,o+=t*this.s.heights.row,s||void 0===s?parseInt(o,10):o},scrollToRow:function(t,s){var e=this,i=!1,r=this.rowToPixels(t),l=t-(this.s.displayBuffer-1)/2*this.s.viewportRows;l<0&&(l=0),void 0===(s=(r>this.s.redrawBottom||r<this.s.redrawTop)&&this.s.dt._iDisplayStart!==l&&(i=!0,r=this._domain("virtualToPhysical",t*this.s.heights.row),this.s.redrawTop<r)&&r<this.s.redrawBottom?!(this.s.forceReposition=!0):s)||s?(this.s.ani=i,o(this.dom.scroller).animate({scrollTop:r},(function(){setTimeout((function(){e.s.ani=!1}),250)}))):o(this.dom.scroller).scrollTop(r)},construct:function(){var t=this,e=this.s.dtApi;if(!this.s.dt.oFeatures.bPaginate)throw new Error("Pagination must be enabled for Scroller to operate");this.dom.force.style.position="relative",this.dom.force.style.top="0px",this.dom.force.style.left="0px",this.dom.force.style.width="1px",this.dom.scroller=e.table().node().parentNode,this.dom.scroller.appendChild(this.dom.force),this.dom.scroller.style.position="relative",this.dom.table=o(">table",this.dom.scroller)[0],this.dom.table.style.position="absolute",this.dom.table.style.top="0px",this.dom.table.style.left="0px",o(e.table().container()).addClass("dts DTS"),this.dom.label.appendTo(this.dom.scroller),this.s.heights.row&&"auto"!=this.s.heights.row&&(this.s.autoHeight=!1),this.s.ingnoreScroll=!0,o(this.dom.scroller).on("scroll.dt-scroller",(function(s){t._scroll.call(t)})),o(this.dom.scroller).on("touchstart.dt-scroller",(function(){t._scroll.call(t)})),o(this.dom.scroller).on("mousedown.dt-scroller",(function(){t.s.mousedown=!0})).on("mouseup.dt-scroller",(function(){t.s.labelVisible=!1,t.s.mousedown=!1,t.dom.label.css("display","none")})),o(window).on("resize.dt-scroller",(function(){t.measure(!1),t._info()}));var i=!0,r=e.state.loaded();e.on("stateSaveParams.scroller",(function(s,o,e){i&&r?(e.scroller=r.scroller,i=!1,e.scroller&&(t.s.lastScrollTop=e.scroller.scrollTop)):e.scroller={topRow:t.s.topRowFloat,baseRowTop:t.s.baseRowTop}})),e.on("stateLoadParams.scroller",(function(s,o,e){void 0!==e.scroller&&t.scrollToRow(e.scroller.topRow)})),this.measure(!1),r&&r.scroller&&(this.s.topRowFloat=r.scroller.topRow,this.s.baseRowTop=r.scroller.baseRowTop,this.s.baseScrollTop=this.s.baseRowTop*this.s.heights.row,r.scroller.scrollTop=this._domain("physicalToVirtual",this.s.topRowFloat*this.s.heights.row)),t.s.stateSaveThrottle=s.util.throttle((function(){t.s.dtApi.state.save()}),500),e.on("init.scroller",(function(){t.measure(!1),t.s.scrollType="jump",t._draw(),e.on("draw.scroller",(function(){t._draw()}))})),e.on("preDraw.dt.scroller",(function(){t._scrollForce()})),e.on("destroy.scroller",(function(){o(window).off("resize.dt-scroller"),o(t.dom.scroller).off(".dt-scroller"),o(t.s.dt.nTable).off(".scroller"),o(t.s.dt.nTableWrapper).removeClass("DTS"),o("div.DTS_Loading",t.dom.scroller.parentNode).remove(),t.dom.table.style.position="",t.dom.table.style.top="",t.dom.table.style.left=""}))},_calcRowHeight:function(){var t=(r=this.s.dt).nTable,e=t.cloneNode(!1),i=o("<tbody/>").appendTo(e),r=r.oClasses,l=(r=s.versionCheck("2")?{container:r.container,scroller:r.scrolling.container,body:r.scrolling.body}:{container:r.sWrapper,scroller:r.sScrollWrapper,body:r.sScrollBody},o('<div class="'+r.container+' DTS"><div class="'+r.scroller+'"><div class="'+r.body+'"></div></div></div>')),a=(o("tbody tr:lt(4)",t).clone().appendTo(i),o("tr",i).length);if(1===a)i.prepend("<tr><td>&#160;</td></tr>"),i.append("<tr><td>&#160;</td></tr>");else for(;a<3;a++)i.append("<tr><td>&#160;</td></tr>");o("div."+r.body,l).append(e),r=this.s.dt.nHolding||t.parentNode,o(r).is(":visible")||(r="body"),l.find("input").removeAttr("name"),l.appendTo(r),this.s.heights.row=o("tr",i).eq(1).outerHeight(),l.remove()},_draw:function(){var t=this,s=this.s.heights,e=this.dom.scroller.scrollTop,i=o(this.s.dt.nTable).height(),r=this.s.dt._iDisplayStart,l=this.s.dt._iDisplayLength,a=this.s.dt.fnRecordsDisplay(),h=e+s.viewport,n=(this.s.skip=!0,!this.s.dt.bSorted&&!this.s.dt.bFiltered||0!==r||this.s.dt._drawHold||(this.s.topRowFloat=0),e="jump"===this.s.scrollType?this._domain("virtualToPhysical",this.s.topRowFloat*s.row):e,this.s.baseScrollTop=e,this.s.baseRowTop=this.s.topRowFloat,e-(this.s.topRowFloat-r)*s.row);0===r?n=0:a<=r+l?n=s.scroll-i:n+i<h&&(this.s.baseScrollTop+=(a=h-i)-n+1,n=a),this.dom.table.style.top=n+"px",this.s.tableTop=n,this.s.tableBottom=i+this.s.tableTop,r=(e-this.s.tableTop)*this.s.boundaryScale;this.s.redrawTop=e-r,this.s.redrawBottom=e+r>s.scroll-s.viewport-s.row?s.scroll-s.viewport-s.row:e+r,this.s.skip=!1,t.s.ingnoreScroll&&(this.s.dt.oFeatures.bStateSave&&null!==this.s.dt.oLoadedState&&void 0!==this.s.dt.oLoadedState.scroller?((l=!(!this.s.dt.sAjaxSource&&!t.s.dt.ajax||this.s.dt.oFeatures.bServerSide))&&2<=this.s.dt.iDraw||!l&&1<=this.s.dt.iDraw)&&setTimeout((function(){o(t.dom.scroller).scrollTop(t.s.dt.oLoadedState.scroller.scrollTop),setTimeout((function(){t.s.ingnoreScroll=!1}),0)}),0):t.s.ingnoreScroll=!1),this.s.dt.oFeatures.bInfo&&setTimeout((function(){t._info.call(t)}),0),o(this.s.dt.nTable).triggerHandler("position.dts.dt",n)},_domain:function(t,s){var o,e=this.s.heights,i=1e4;return e.virtual===e.scroll||s<i?s:"virtualToPhysical"===t&&s>=e.virtual-i?(o=e.virtual-s,e.scroll-o):"physicalToVirtual"===t&&s>=e.scroll-i?(o=e.scroll-s,e.virtual-o):(e=i-(o=(e.virtual-i-i)/(e.scroll-i-i))*i,"virtualToPhysical"===t?(s-e)/o:o*s+e)},_info:function(){if(this.s.dt.oFeatures.bInfo){var t=this.s.dt,s=this.s.dtApi,e=t.oLanguage,i=(r=s.page.info()).recordsDisplay,r=r.recordsTotal,l=(this.s.lastScrollTop-this.s.baseScrollTop)/this.s.heights.row,a=(l=Math.floor(this.s.baseRowTop+l)+1,i<(a=(l="jump"===this.s.scrollType?Math.floor(this.s.topRowFloat)+1:l)+Math.floor(this.s.heights.viewport/this.s.heights.row))?i:a),h=0===i&&i==r?e.sInfoEmpty+e.sInfoPostFix:0===i?e.sInfoEmpty+" "+e.sInfoFiltered+e.sInfoPostFix:i==r?e.sInfo+e.sInfoPostFix:e.sInfo+" "+e.sInfoFiltered+e.sInfoPostFix,n=((e=(h=this._macros(h,l,a,r,i),e.fnInfoCallback))&&(h=e.call(t.oInstance,t,l,a,r,i,h)),t.aanFeatures.i);if(void 0!==n){for(var c=0,d=n.length;c<d;c++)o(n[c]).html(h);o(t.nTable).triggerHandler("info.dt")}o("div.dt-info",s.table().container()).each((function(){o(this).html(h),s.trigger("info",[s.settings()[0],this,h])}))}},_macros:function(t,s,o,e,i){var r=this.s.dtApi,l=this.s.dt,a=l.fnFormatNumber;return t.replace(/_START_/g,a.call(l,s)).replace(/_END_/g,a.call(l,o)).replace(/_MAX_/g,a.call(l,e)).replace(/_TOTAL_/g,a.call(l,i)).replace(/_ENTRIES_/g,r.i18n("entries","")).replace(/_ENTRIES-MAX_/g,r.i18n("entries","",e)).replace(/_ENTRIES-TOTAL_/g,r.i18n("entries","",i))},_parseHeight:function(t){var s,e;return null!==(t=/^([+-]?(?:\d+(?:\.\d+)?|\.\d+))(px|em|rem|vh)$/.exec(t))&&(e=parseFloat(t[1]),"px"===(t=t[2])?s=e:"vh"===t?s=e/100*o(window).height():"rem"===t?s=e*parseFloat(o(":root").css("font-size")):"em"===t&&(s=e*parseFloat(o("body").css("font-size"))),s)||0},_scroll:function(){var t,e=this,i=this.s.heights,r=this.dom.scroller.scrollTop;this.s.skip||this.s.ingnoreScroll||r!==this.s.lastScrollTop&&(this.s.dt.bFiltered||this.s.dt.bSorted?this.s.lastScrollTop=0:(clearTimeout(this.s.stateTO),this.s.stateTO=setTimeout((function(){e.s.dtApi.state.save(),e._info()}),250),this.s.scrollType=Math.abs(r-this.s.lastScrollTop)>i.viewport?"jump":"cont",this.s.topRowFloat="cont"===this.s.scrollType?this.pixelsToRow(r,!1,!1):this._domain("physicalToVirtual",r)/i.row,this.s.topRowFloat<0&&(this.s.topRowFloat=0),this.s.forceReposition||r<this.s.redrawTop||r>this.s.redrawBottom?(t=Math.ceil((this.s.displayBuffer-1)/2*this.s.viewportRows),t=parseInt(this.s.topRowFloat,10)-t,this.s.forceReposition=!1,t<=0?t=0:t+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()?(t=this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength)<0&&(t=0):t%2!=0&&t++,(this.s.targetTop=t)!=this.s.dt._iDisplayStart&&(this.s.tableTop=o(this.s.dt.nTable).offset().top,this.s.tableBottom=o(this.s.dt.nTable).height()+this.s.tableTop,t=function(){e.s.dt._iDisplayStart=e.s.targetTop,e.s.dtApi.draw("page")},this.s.dt.oFeatures.bServerSide?(this.s.forceReposition=!0,o(this.s.dt.nTable).triggerHandler("scroller-will-draw.dt"),s.versionCheck("2")?e.s.dtApi.processing(!0):this.s.dt.oApi._fnProcessingDisplay(this.s.dt,!0),clearTimeout(this.s.drawTO),this.s.drawTO=setTimeout(t,this.s.serverWait)):t())):this.s.topRowFloat=this.pixelsToRow(r,!1,!0),this._info(),this.s.lastScrollTop=r,this.s.stateSaveThrottle(),"jump"===this.s.scrollType&&this.s.mousedown&&(this.s.labelVisible=!0),this.s.labelVisible&&(t=(i.viewport-i.labelHeight-i.xbar)/i.scroll,this.dom.label.html(this.s.dt.fnFormatNumber(parseInt(this.s.topRowFloat,10)+1)).css("top",r+r*t).css("display","block"))))},_scrollForce:function(){var t=this.s.heights;t.virtual=t.row*this.s.dt.fnRecordsDisplay(),t.scroll=t.virtual,1e6<t.scroll&&(t.scroll=1e6),this.dom.force.style.height=t.scroll>this.s.heights.row?t.scroll+"px":this.s.heights.row+"px"}}),e.defaults={boundaryScale:.5,displayBuffer:9,rowHeight:"auto",serverWait:200},e.oDefaults=e.defaults,e.version="2.4.3",o(document).on("preInit.dt.dtscroller",(function(t,i){var r,l;"dt"===t.namespace&&(t=i.oInit.scroller,r=s.defaults.scroller,t||r)&&(l=o.extend({},t,r),!1!==t)&&new e(i,l)})),o.fn.dataTable.Scroller=e,o.fn.DataTable.Scroller=e,o.fn.dataTable.Api);i.register("scroller()",(function(){return this})),i.register("scroller().rowToPixels()",(function(t,s,o){var e=this.context;if(e.length&&e[0].oScroller)return e[0].oScroller.rowToPixels(t,s,o)})),i.register("scroller().pixelsToRow()",(function(t,s,o){var e=this.context;if(e.length&&e[0].oScroller)return e[0].oScroller.pixelsToRow(t,s,o)})),i.register(["scroller().scrollToRow()","scroller.toPosition()"],(function(t,s){return this.iterator("table",(function(o){o.oScroller&&o.oScroller.scrollToRow(t,s)})),this})),i.register("row().scrollTo()",(function(t){var s=this;return this.iterator("row",(function(o,e){o.oScroller&&(e=s.rows({order:"applied",search:"applied"}).indexes().indexOf(e),o.oScroller.scrollToRow(e,t))})),this})),i.register("scroller.measure()",(function(t){return this.iterator("table",(function(s){s.oScroller&&s.oScroller.measure(t)})),this})),i.register("scroller.page()",(function(){var t=this.context;if(t.length&&t[0].oScroller)return t[0].oScroller.pageInfo()}));export default s;